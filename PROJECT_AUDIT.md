# 项目深度审计报告：智能商户号申诉助手

## 1. 核心 AI 逻辑问题 ("伪智能")
目前项目的核心问题在于 **`server/ai.js`**。
- **现象**：大量使用硬编码的 `if-else` 逻辑（如 `if (industry === '餐饮')`）来拼接 System Prompt。
- **本质**：这是一个披着 AI 外衣的**规则引擎**。
- **后果**：
  - **维护成本极高**：每支持一个新行业或新违规类型，都需要修改后端代码。
  - **缺乏推理能力**：模型只是在填充预设的模板，而非根据具体案情进行推理。
  - **Token 浪费**：`BASE_SYSTEM_PROMPT` 过于庞大，包含了大量无关行业的案例，导致每次对话成本高昂且容易分散模型注意力。
- **建议**：重构为 **RAG (检索增强生成)** 架构。将行业知识、成功案例存入向量数据库，根据用户输入动态检索相关上下文。

## 2. 后端架构问题 ("上帝对象")
- **现象**：**`server/db.js`** 文件超过 2700 行。
- **问题**：它混合了数据库连接池管理、所有业务实体（用户、会话、订单、商品）的 CRUD 操作，甚至包含部分业务逻辑。
- **后果**：代码耦合度极高，极难维护、测试和多人协作。
- **建议**：实施 MVC 分层，将数据访问层拆分为独立的 Models（如 `models/User.js`, `models/Case.js`）。

## 3. 安全隐患
- **现象**：
  - 代码中保留了默认管理员账号 `admin` / `admin123`。
  - 存在 fallback 的 `JWT_SECRET`。
  - 敏感配置（API Key）与普通配置混合存储。
- **后果**：生产环境部署时若忘记配置环境变量，系统将面临极高安全风险。
- **建议**：移除默认凭证，强制要求通过环境变量配置密钥，实施严格的密钥管理策略。

## 4. 数据存储瓶颈
- **现象**：大量的非结构化数据（对话日志、AI 分析报告、中间状态）存储在 MySQL 的 `JSON` 字段中。
- **后果**：
  - 查询性能差：难以进行复杂的分析查询（如"查找所有餐饮行业的失败案例"）。
  - 扩展性低：MySQL 不适合存储海量日志数据。
- **建议**：引入 **MongoDB** 或专门的日志系统/向量数据库来存储非结构化数据。

## 5. 平台与功能局限
- **现象**：虽然声称是"全平台"助手，但 `knowledgeBase.js` 和 `localAI.js` 中的核心逻辑高度绑定 **微信支付** 的业务规则。
- **后果**：难以快速扩展到支付宝、抖音等平台。
- **建议**：抽象出通用的申诉框架，将特定平台的规则作为插件或配置加载。

## 总结
这是一个**完成度很高的演示级 (Demo) 项目**，跑通了商业闭环。但如果要作为**生产级 SaaS** 长期运营，必须进行架构解耦和 AI 核心重构，从"规则驱动"转向"数据驱动"。
