// ========== æœ¬åœ°è§„åˆ™å¼•æ“ï¼šä¿¡æ¯æ”¶é›† + æ™ºèƒ½ç­”ç–‘ï¼ˆä¸æ¶ˆè€— DeepSeekï¼‰ ==========

import { BUILT_IN_CASES, VIOLATION_KNOWLEDGE, matchViolation, matchBuiltInCases, assessRisk, generateMaterialChecklist } from './knowledgeBase.js'

// ä¿¡æ¯æ”¶é›†å­—æ®µå®šä¹‰ï¼ˆé¡ºåºå¾ˆé‡è¦ï¼šå…ˆäº†è§£ä¸šåŠ¡ â†’ å†äº†è§£é—®é¢˜ â†’ å†æ”¶é›†è¯¦ç»†ä¿¡æ¯ï¼‰
const INFO_FIELDS = [
  // ===== ç¬¬ä¸€é˜¶æ®µï¼šäº†è§£å®¢æˆ·ä¸šåŠ¡ =====
  { key: 'industry', label: 'ä¸šåŠ¡ç±»å‹', group: 'ä¸šåŠ¡äº†è§£', icon: 'ğŸ’¼',
    question: 'ğŸ’¼ æ‚¨æ˜¯åšä»€ä¹ˆç”Ÿæ„çš„ï¼Ÿ\n\næ¯”å¦‚ï¼šå–è¡£æœã€åšé¤é¥®ã€ææ¸¸æˆã€åšé™ªç©ã€å–è¯¾ç¨‹ã€å¼€è¶…å¸‚â€¦â€¦\n\néšä¾¿è¯´å°±è¡Œï¼Œæˆ‘èƒ½å¬æ‡‚~',
    why: 'ä¸åŒè¡Œä¸šç”³è¯‰æ–¹æ³•ä¸ä¸€æ ·ï¼Œæˆ‘å…ˆäº†è§£æ‚¨åšä»€ä¹ˆï¼Œæ‰èƒ½å¸®æ‚¨é€‰æœ€åˆé€‚çš„æ–¹æ¡ˆã€‚' },
  { key: 'business_model', label: 'ç»è¥æ¨¡å¼', group: 'ä¸šåŠ¡äº†è§£', icon: 'ğŸ’¼',
    question: 'ğŸ›’ æ‚¨ä¸»è¦åœ¨å“ªé‡Œåšç”Ÿæ„ã€æ€ä¹ˆæ”¶é’±çš„ï¼Ÿ\n\nâ‘  ç½‘ä¸Šï¼ˆå°ç¨‹åº/å…¬ä¼—å·/ç½‘åº—ï¼‰\nâ‘¡ å®ä½“åº—\nâ‘¢ ç½‘ä¸Š+å®ä½“åº—éƒ½æœ‰\n\nç®€å•è¯´ä¸€ä¸‹å°±è¡Œ~',
    why: 'ç½‘ä¸Šå’Œå®ä½“åº—çš„ç”³è¯‰ææ–™ä¸ä¸€æ ·ï¼Œæˆ‘éœ€è¦çŸ¥é“æ‚¨çš„æ”¶é’±æ–¹å¼ã€‚' },

  // ===== ç¬¬äºŒé˜¶æ®µï¼šäº†è§£é‡åˆ°çš„é—®é¢˜ =====
  { key: 'problem_type', label: 'å¤„ç½šç±»å‹', group: 'é—®é¢˜ä¿¡æ¯', icon: 'âš ï¸',
    question: 'âš ï¸ æ‚¨çš„å•†æˆ·å·ç°åœ¨æ€ä¹ˆäº†ï¼Ÿ\n\nâ‘  é¡¾å®¢ä»˜æ¬¾ä»˜ä¸äº†ï¼ˆäº¤æ˜“æ‹¦æˆªï¼‰\nâ‘¡ æ”¶æ¬¾æœ‰é™é¢äº†\nâ‘¢ ä¸èƒ½æ”¶æ¬¾äº†ï¼ˆæ”¯ä»˜å…³é—­ï¼‰\nâ‘£ é’±è¢«å†»ä½å–ä¸å‡ºæ¥\nâ‘¤ æ•´ä¸ªå•†æˆ·å·è¢«å°äº†\n\nè¯´æ•°å­—æˆ–è€…ç”¨è‡ªå·±çš„è¯è¯´éƒ½è¡Œ~',
    why: 'ä¸åŒé—®é¢˜è§£å†³åŠæ³•ä¸ä¸€æ ·ï¼Œæˆ‘å…ˆå¼„æ¸…æ¥šæ‚¨é‡åˆ°çš„æ˜¯å“ªç§æƒ…å†µã€‚' },
  { key: 'violation_reason', label: 'è¿è§„åŸå› ', group: 'é—®é¢˜ä¿¡æ¯', icon: 'ğŸ“‹',
    question: 'ğŸ“‹ å¾®ä¿¡è¯´æ‚¨è¿è§„çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ\n\næ‰“å¼€ã€Œå¾®ä¿¡æ”¯ä»˜å•†å®¶åŠ©æ‰‹ã€å°ç¨‹åºï¼Œæ‰¾åˆ°"åŠŸèƒ½é™åˆ¶è®°å½•"ï¼ŒæŠŠä¸Šé¢å†™çš„åŸå› å‘Šè¯‰æˆ‘å°±è¡Œã€‚\n\nä¸çŸ¥é“åœ¨å“ªçœ‹çš„è¯ï¼Œç›´æ¥å‘Šè¯‰æˆ‘å¾®ä¿¡ç»™æ‚¨å‘çš„é€šçŸ¥é‡Œå†™äº†ä»€ä¹ˆ~',
    why: 'è¿™ä¸ªå¾ˆå…³é”®ï¼Œç”³è¯‰å°±æ˜¯è¦é’ˆå¯¹è¿™ä¸ªåŸå› æ¥å†™ææ–™ã€‚' },

  // ===== ç¬¬ä¸‰é˜¶æ®µï¼šå•†æˆ·åŸºæœ¬ä¿¡æ¯ =====
  { key: 'merchant_id', label: 'å•†æˆ·å·', group: 'å•†æˆ·å·ä¿¡æ¯', icon: 'ğŸª',
    question: 'ğŸ  æ‚¨çš„å¾®ä¿¡å•†æˆ·å·æ˜¯å¤šå°‘ï¼Ÿå°±æ˜¯ä¸€ä¸²10ä½å·¦å³çš„æ•°å­—ã€‚\n\nä¸çŸ¥é“åœ¨å“ªçœ‹ï¼Ÿæ‰“å¼€ã€Œå•†å®¶åŠ©æ‰‹ã€å°ç¨‹åºé¦–é¡µå°±èƒ½çœ‹åˆ°~',
    why: 'å•†æˆ·å·å°±æ˜¯æ‚¨çš„è´¦å·IDï¼Œç”³è¯‰çš„æ—¶å€™å¿…é¡»å¡«å¯¹ã€‚' },
  { key: 'merchant_name', label: 'å•†æˆ·åç§°', group: 'å•†æˆ·å·ä¿¡æ¯', icon: 'ğŸª',
    question: 'ğŸ·ï¸ æ‚¨çš„å•†æˆ·åç§°å«ä»€ä¹ˆï¼Ÿå°±æ˜¯å½“åˆæ³¨å†Œå¾®ä¿¡æ”¯ä»˜æ—¶å¡«çš„é‚£ä¸ªåå­—~',
    why: 'å¾®ä¿¡ä¼šæ ¸å¯¹è¿™ä¸ªåå­—ï¼Œå¾—å’Œæ‚¨æ³¨å†Œæ—¶å¡«çš„ä¸€æ ·ã€‚' },

  // ===== ç¬¬å››é˜¶æ®µï¼šä¼ä¸šå’Œæ³•äººä¿¡æ¯ =====
  { key: 'company_name', label: 'å…¬å¸å…¨ç§°', group: 'ä¼ä¸šä¿¡æ¯', icon: 'ğŸ¢',
    question: 'ğŸ¢ æ‚¨è¥ä¸šæ‰§ç…§ä¸Šçš„å…¬å¸åå­—æ˜¯ä»€ä¹ˆï¼Ÿå†™å…¨ç§°å°±è¡Œ~\n\nä¸ªä½“æˆ·çš„è¯å°±å†™ä¸ªä½“æˆ·çš„åç§°~',
    why: 'å¾®ä¿¡ä¼šæŸ¥æ‚¨çš„å…¬å¸ä¿¡æ¯ï¼Œå¾—å’Œè¥ä¸šæ‰§ç…§ä¸Šå†™çš„ä¸€æ¨¡ä¸€æ ·ã€‚' },
  { key: 'license_no', label: 'ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ', group: 'ä¼ä¸šä¿¡æ¯', icon: 'ğŸ¢',
    question: 'ğŸ“„ è¥ä¸šæ‰§ç…§ä¸Šæœ‰ä¸€ä¸²18ä½çš„ç¼–ç ï¼Œå«"ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç "ï¼Œèƒ½å‘Šè¯‰æˆ‘å—ï¼Ÿ\n\nå°±åœ¨è¥ä¸šæ‰§ç…§å³ä¸Šè§’é‚£ä¸²å­—æ¯+æ•°å­—ï¼Œä¸çŸ¥é“çš„è¯è¯´"ä¸çŸ¥é“"ä¹Ÿè¡Œ~',
    why: 'è¿™æ˜¯æ‚¨å…¬å¸çš„"èº«ä»½è¯å·"ï¼Œç”³è¯‰æ—¶å¯èƒ½ç”¨åˆ°ã€‚' },
  { key: 'legal_name', label: 'æ³•äººå§“å', group: 'æ³•äººä¿¡æ¯', icon: 'ğŸ‘¤',
    question: 'ğŸ‘¤ è¥ä¸šæ‰§ç…§ä¸Šçš„æ³•äººå«ä»€ä¹ˆåå­—ï¼Ÿ',
    why: 'å¾®ä¿¡è¦ç¡®è®¤æ˜¯æœ¬äººåœ¨ç”³è¯‰ï¼Œæ‰€ä»¥éœ€è¦æ³•äººçš„åå­—ã€‚' },
  { key: 'legal_id_last4', label: 'èº«ä»½è¯åå››ä½', group: 'æ³•äººä¿¡æ¯', icon: 'ğŸ‘¤',
    question: 'ğŸ” æ³•äººèº«ä»½è¯å·çš„æœ€å4ä½æ˜¯å¤šå°‘ï¼Ÿ\n\næ”¾å¿ƒï¼Œåªè¦å4ä½å°±è¡Œï¼Œä¸ä¼šæ³„éœ²éšç§ã€‚æ‰“95017å‚¬å®¡çš„æ—¶å€™ä¹Ÿä¼šé—®è¿™ä¸ª~',
    why: 'è¿™æ˜¯éªŒè¯èº«ä»½ç”¨çš„ï¼Œåªæ”¶å4ä½ï¼Œä¿æŠ¤æ‚¨çš„éšç§ã€‚' },

  // ===== ç¬¬äº”é˜¶æ®µï¼šæŠ•è¯‰ä¸å”®å =====
  { key: 'complaint_status', label: 'æŠ•è¯‰æƒ…å†µ', group: 'æŠ•è¯‰ä¸å”®å', icon: 'ğŸ“',
    question: 'ğŸ“¢ æœ‰æ²¡æœ‰é¡¾å®¢æŠ•è¯‰è¿˜æ²¡å¤„ç†å®Œçš„ï¼Ÿå¤§æ¦‚æœ‰å‡ ä¸ªï¼Ÿ\n\næ²¡æœ‰çš„è¯ç›´æ¥è¯´"æ²¡æœ‰"å°±è¡Œ~',
    why: 'æŠ•è¯‰å¤„ç†å¥½äº†å¯¹ç”³è¯‰æœ‰å¸®åŠ©ï¼Œæˆ‘éœ€è¦äº†è§£æ‚¨çš„æŠ•è¯‰æƒ…å†µã€‚' },
  { key: 'refund_policy', label: 'é€€æ¬¾æ”¿ç­–', group: 'æŠ•è¯‰ä¸å”®å', icon: 'ğŸ“',
    question: 'ğŸ”„ é¡¾å®¢è¦é€€æ¬¾çš„è¯ï¼Œæ‚¨ä¸€èˆ¬æ€ä¹ˆå¤„ç†çš„ï¼Ÿ\n\næ¯”å¦‚å‡ å¤©å†…å¯ä»¥é€€ã€æ€ä¹ˆé€€ã€‚è¿˜æ²¡æœ‰é€€æ¬¾è§„åˆ™ä¹Ÿæ²¡å…³ç³»ï¼Œè¯´"æ²¡æœ‰"å°±è¡Œï¼Œæˆ‘å¸®æ‚¨å†™ä¸€ä¸ª~',
    why: 'å¾®ä¿¡ä¼šçœ‹æ‚¨æœ‰æ²¡æœ‰é€€æ¬¾è§„åˆ™ï¼Œæœ‰çš„è¯ç”³è¯‰æ›´å®¹æ˜“é€šè¿‡ã€‚' },

  // ===== ç¬¬å…­é˜¶æ®µï¼šç»“ç®—å’Œè”ç³»ä¿¡æ¯ =====
  { key: 'bank_name', label: 'å¼€æˆ·é“¶è¡Œ', group: 'ç»“ç®—è´¦æˆ·', icon: 'ğŸ¦',
    question: 'ğŸ¦ æ‚¨æ”¶æ¬¾ç”¨çš„æ˜¯å“ªä¸ªé“¶è¡Œï¼Ÿæ¯”å¦‚å·¥å•†é“¶è¡Œã€æ‹›å•†é“¶è¡Œ~',
    why: 'æ‰“95017å‚¬å®¡çš„æ—¶å€™ä¼šé—®åˆ°ï¼Œèµ„é‡‘å†»ç»“çš„æƒ…å†µæ›´éœ€è¦è¿™ä¸ªä¿¡æ¯ã€‚' },
  { key: 'bank_account_last4', label: 'ç»“ç®—è´¦æˆ·åå››ä½', group: 'ç»“ç®—è´¦æˆ·', icon: 'ğŸ¦',
    question: 'ğŸ’³ æ”¶æ¬¾é“¶è¡Œå¡å·çš„æœ€å4ä½æ˜¯å¤šå°‘ï¼Ÿ\n\nä¹Ÿæ˜¯åªè¦å4ä½å°±è¡Œï¼Œä¸æ¶‰åŠéšç§~',
    why: 'æ‰“95017å‚¬å®¡æ—¶è¦éªŒè¯èº«ä»½ç”¨çš„ã€‚' },
  { key: 'contact_phone', label: 'è”ç³»ç”µè¯', group: 'è”ç³»æ–¹å¼', icon: 'ğŸ“±',
    question: 'ğŸ“± ç•™ä¸€ä¸ªæ‚¨çš„æ‰‹æœºå·ï¼Œå¾®ä¿¡å®¡æ ¸çš„æ—¶å€™å¯èƒ½ä¼šæ‰“ç”µè¯ç»™æ‚¨~',
    why: 'å¾®ä¿¡å¯èƒ½ä¼šæ‰“ç”µè¯ç¡®è®¤ï¼Œæ¥ä¸åˆ°ç”µè¯çš„è¯ç”³è¯‰å¯èƒ½ç›´æ¥ä¸é€šè¿‡ã€‚' },
  { key: 'appeal_history', label: 'ç”³è¯‰å†å²', group: 'ç”³è¯‰å†å²', icon: 'ğŸ“',
    question: 'ğŸ“ ä¹‹å‰ç”³è¯‰è¿‡å—ï¼Ÿç»“æœæ€ä¹ˆæ ·ï¼Ÿ\n\nç¬¬ä¸€æ¬¡ç”³è¯‰å°±è¯´"æ²¡æœ‰"~',
    why: 'ç”³è¯‰è¿‡çš„è¯æˆ‘éœ€è¦æ¢ä¸ªç­–ç•¥ï¼Œé¿å…é‡å¤è¢«é©³å›ã€‚' },
]

const TOTAL_STEPS = INFO_FIELDS.length

// æœŸæœ›æ•°å­—è¾“å…¥çš„å­—æ®µï¼ˆä¸èƒ½æŠŠçº¯æ•°å­—å½“åƒåœ¾è¾“å…¥ï¼‰
const NUMERIC_FIELDS = new Set(['merchant_id', 'legal_id_last4', 'bank_account_last4', 'contact_phone'])

// æ¬¢è¿æ¶ˆæ¯ï¼ˆå…ˆäº†è§£ä¸šåŠ¡ï¼Œä¸è¦ä¸€ä¸Šæ¥å°±é—®å¤„ç½šï¼‰
const LOCAL_WELCOME = `æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å¾®ä¿¡å•†æˆ·å·ç”³è¯‰é¡¾é—®~

å•†æˆ·å·å‡ºé—®é¢˜äº†åˆ«ç€æ€¥ï¼Œæˆ‘æ¥å¸®æ‚¨æå®šã€‚å…ˆç®€å•èŠå‡ å¥ï¼Œäº†è§£ä¸€ä¸‹æ‚¨çš„æƒ…å†µï¼Œç„¶åå¸®æ‚¨å†™ç”³è¯‰ææ–™ã€‚

ğŸ’¼ æ‚¨æ˜¯åšä»€ä¹ˆç”Ÿæ„çš„ï¼Ÿ

æ¯”å¦‚ï¼šå–è¡£æœã€åšé¤é¥®ã€ææ¸¸æˆã€åšé™ªç©ã€å–è¯¾ç¨‹ã€å¼€è¶…å¸‚â€¦â€¦éšä¾¿è¯´å°±è¡Œï¼Œæˆ‘èƒ½å¬æ‡‚~

ğŸ’¡ å³è¾¹é¢æ¿ä¼šå®æ—¶æ˜¾ç¤ºæ‚¨æä¾›çš„ä¿¡æ¯ï¼Œéšæ—¶èƒ½çœ‹èƒ½æ”¹ã€‚
ğŸ’¡ æœ‰é—®é¢˜éšæ—¶é—®æˆ‘ï¼Œæ¯”å¦‚"ä¸ºä»€ä¹ˆè¦è¿™ä¸ª"ã€‚
ğŸ”’ æ‚¨çš„ä¿¡æ¯åªç”¨äºæœ¬æ¬¡å’¨è¯¢ï¼Œä¸ä¼šæ³„éœ²ã€‚`

// "ä¸ºä»€ä¹ˆ"é—®é¢˜æ£€æµ‹
const WHY_PATTERNS = [
  /ä¸ºä»€ä¹ˆ/, /ä¸ºå•¥/, /å¹²å˜›/, /æœ‰ä»€ä¹ˆç”¨/, /ä¸ºä½•/,
  /ä»€ä¹ˆç›®çš„/, /ä»€ä¹ˆæ„ä¹‰/, /æœ‰å¿…è¦/, /ä¸æƒ³å¡«/, /ä¸æ–¹ä¾¿/,
  /éšç§/, /å®‰å…¨å—/, /æ³„éœ²/, /èƒ½ä¸å¡«/, /å¯ä»¥è·³è¿‡/,
  /è¿™ä¸ªä¿¡æ¯/, /è¿™äº›ä¿¡æ¯/, /ç”¨æ¥å¹²/, /æ‹¿æ¥å¹²/,
]

// è¡Œä¸šçŸ¥è¯†åº“ï¼šæ¯ä¸ªè¡Œä¸šçš„å¸¸è§è¿è§„åŸå› ã€ç”³è¯‰è¦ç‚¹ã€ä¸šåŠ¡æ¨¡å¼æè¿°æ¨¡æ¿
const INDUSTRY_KNOWLEDGE = {
  'é¤é¥®': { aliases: ['é¤é¥®', 'å¤–å–', 'é¥­åº—', 'é¤å…', 'å°åƒ', 'çƒ§çƒ¤', 'ç«é”…', 'å¥¶èŒ¶', 'å’–å•¡', 'é¢é¦†', 'å¿«é¤', 'ä¾¿å½“', 'ç”œå“'],
    commonViolations: ['è™šå‡äº¤æ˜“', 'äº¤æ˜“å¼‚å¸¸', 'æŠ•è¯‰ç‡è¿‡é«˜', 'é€€æ¬¾ç‡è¿‡é«˜'],
    appealTips: 'é¤é¥®è¡Œä¸šéœ€çªå‡ºé£Ÿå“å®‰å…¨è®¸å¯è¯ã€å«ç”Ÿè®¸å¯ã€é—¨åº—å®æ™¯ç…§ç‰‡ã€ç¾å›¢/é¥¿äº†ä¹ˆåº—é“ºæˆªå›¾ã€é¡¾å®¢å¥½è¯„è®°å½•ã€‚å¼ºè°ƒ"å·²ä¼˜åŒ–å‡ºé¤æµç¨‹ã€åŠ å¼ºé£Ÿå“è´¨é‡ç®¡æ§"ã€‚',
    businessModel: 'é€šè¿‡çº¿ä¸‹é—¨åº—å ‚é£Ÿå’Œçº¿ä¸Šå¤–å–å¹³å°ï¼ˆç¾å›¢/é¥¿äº†ä¹ˆ/å°ç¨‹åºç‚¹é¤ï¼‰å‘æ¶ˆè´¹è€…æä¾›é¤é¥®æœåŠ¡ã€‚é¡¾å®¢é€šè¿‡å¾®ä¿¡æ‰«ç ç‚¹é¤æˆ–å¤–å–å¹³å°ä¸‹å•ï¼Œå¾®ä¿¡æ”¯ä»˜ä¸ºä¸»è¦æ”¶æ¬¾æ–¹å¼ã€‚' },
  'é›¶å”®': { aliases: ['é›¶å”®', 'æœè£…', 'é‹', 'åŒ…', 'é¥°å“', 'ç™¾è´§', 'è¶…å¸‚', 'ä¾¿åˆ©åº—', 'æ—¥ç”¨', 'å®¶å±…', 'æ¯å©´', 'åŒ–å¦†å“', 'ç¾å¦†', 'æŠ¤è‚¤'],
    commonViolations: ['å”®å‡æŠ•è¯‰', 'è™šå‡å®£ä¼ ', 'é€€æ¬¾çº çº·', 'å‘è´§å»¶è¿ŸæŠ•è¯‰'],
    appealTips: 'é›¶å”®è¡Œä¸šéœ€æä¾›æ­£å“è¿›è´§å‡­è¯ã€å“ç‰Œæˆæƒä¹¦ã€äº§å“è´¨æ£€æŠ¥å‘Šã€ä»“åº“å®æ‹ã€ç‰©æµåˆä½œåˆåŒã€‚å¼ºè°ƒ"å·²å®Œå–„é€€æ¢è´§æµç¨‹ã€åŠ å¼ºå•†å“è´¨é‡å®¡æ ¸"ã€‚',
    businessModel: 'é€šè¿‡çº¿ä¸‹å®ä½“é—¨åº—å’Œçº¿ä¸Šå°ç¨‹åºå•†åŸå‘æ¶ˆè´¹è€…é”€å”®æ­£è§„æ¸ é“é‡‡è´­çš„å•†å“ã€‚æ‰€æœ‰å•†å“å‡æœ‰æ­£è§„è¿›è´§æ¸ é“å’Œè´¨æ£€æŠ¥å‘Šï¼Œæ”¯æŒ7å¤©æ— ç†ç”±é€€æ¢è´§ã€‚' },
  'æ•™è‚²': { aliases: ['æ•™è‚²', 'åŸ¹è®­', 'è¯¾ç¨‹', 'æ•™å­¦', 'è¾…å¯¼', 'ç½‘è¯¾', 'çŸ¥è¯†ä»˜è´¹', 'è€ƒè¯•', 'å­¦ä¹ ', 'æŠ€èƒ½'],
    commonViolations: ['é¢„ä»˜è´¹æŠ•è¯‰', 'æœåŠ¡æœªå…‘ç°', 'é€€è´¹çº çº·', 'è™šå‡å®£ä¼ '],
    appealTips: 'æ•™è‚²åŸ¹è®­éœ€æä¾›åŠå­¦è®¸å¯è¯/å¤‡æ¡ˆè¯æ˜ã€è¯¾ç¨‹å¤§çº²ã€å¸ˆèµ„è¯æ˜ã€å­¦å‘˜å¥½è¯„æˆªå›¾ã€é€€è´¹æ”¿ç­–ã€‚å¼ºè°ƒ"å·²å®Œå–„è¯¾ç¨‹æœåŠ¡ä½“ç³»ã€å»ºç«‹é€€è´¹ç»¿è‰²é€šé“"ã€‚',
    businessModel: 'ä¸ºå­¦å‘˜æä¾›ä¸“ä¸šçš„æ•™è‚²åŸ¹è®­æœåŠ¡ï¼ŒåŒ…å«çº¿ä¸‹é¢æˆå’Œçº¿ä¸Šç›´æ’­/å½•æ’­è¯¾ç¨‹ã€‚æ”¶è´¹æ¨¡å¼é€æ˜ï¼Œè¯¾ç¨‹å†…å®¹ä¸å®£ä¼ ä¸€è‡´ï¼Œæä¾›å®Œå–„çš„é€€è´¹æ”¿ç­–ã€‚' },
  'ç”µå•†': { aliases: ['ç”µå•†', 'ç½‘åº—', 'æ·˜å®', 'æ‹¼å¤šå¤š', 'ç›´æ’­å¸¦è´§', 'å¾®å•†', 'ä»£è´­', 'è·¨å¢ƒ', 'æ‰¹å‘', 'åˆ†é”€'],
    commonViolations: ['è™šå‡äº¤æ˜“', 'åˆ·å•', 'å‘è´§å»¶è¿Ÿ', 'å•†å“è´¨é‡æŠ•è¯‰', 'äº¤æ˜“å¼‚å¸¸'],
    appealTips: 'ç”µå•†éœ€æä¾›åº—é“ºåå°æ•°æ®æˆªå›¾ã€ç‰©æµå‘è´§è®°å½•ã€å¥½è¯„æˆªå›¾ã€è¿›è´§åˆåŒ/å‘ç¥¨ã€å”®åèŠå¤©è®°å½•ã€‚å¼ºè°ƒ"å·²ä¼˜åŒ–ä¾›åº”é“¾ã€ç¼©çŸ­å‘è´§å‘¨æœŸã€åŠ å¼ºå”®åå“åº”"ã€‚',
    businessModel: 'é€šè¿‡è‡ªæœ‰å¾®ä¿¡å°ç¨‹åºå•†åŸ/å…¬ä¼—å·å‘æ¶ˆè´¹è€…é”€å”®å•†å“ï¼Œæ‰€æœ‰å•†å“å‡ä¸ºæ­£è§„æ¸ é“é‡‡è´­ï¼Œæä¾›å®Œæ•´çš„å”®å‰å’¨è¯¢ã€ç‰©æµè¿½è¸ªå’Œå”®åæœåŠ¡ä½“ç³»ã€‚' },
  'ç¾å®¹': { aliases: ['ç¾å®¹', 'ç¾å‘', 'ç¾ç”²', 'çº¹çœ‰', 'åŒ»ç¾', 'æ•´å½¢', 'spa', 'å…»ç”Ÿ', 'æŒ‰æ‘©', 'æ¨æ‹¿', 'è¶³æµ´'],
    commonViolations: ['é¢„ä»˜è´¹æŠ•è¯‰', 'æœåŠ¡æ•ˆæœäº‰è®®', 'è¯±å¯¼æ¶ˆè´¹æŠ•è¯‰', 'èµ„è´¨é—®é¢˜'],
    appealTips: 'ç¾å®¹è¡Œä¸šéœ€æä¾›å«ç”Ÿè®¸å¯è¯ã€ä»ä¸šäººå‘˜èµ„è´¨è¯ä¹¦ã€é—¨åº—å®æ™¯ã€å®¢æˆ·æ»¡æ„åº¦è®°å½•ã€æœåŠ¡ä»·æ ¼å…¬ç¤ºã€‚å¼ºè°ƒ"å·²è§„èŒƒæœåŠ¡æµç¨‹ã€æœç»å¼ºåˆ¶æ¶ˆè´¹ã€å®Œå–„å”®åä¿éšœ"ã€‚',
    businessModel: 'é€šè¿‡çº¿ä¸‹å®ä½“é—¨åº—ä¸ºæ¶ˆè´¹è€…æä¾›ä¸“ä¸šç¾å®¹/ç¾å‘/å…»ç”ŸæœåŠ¡ï¼Œæ‰€æœ‰ä»ä¸šäººå‘˜æŒè¯ä¸Šå²—ï¼Œä»·æ ¼å…¬å¼€é€æ˜ï¼ŒæœåŠ¡é¡¹ç›®æ˜ç æ ‡ä»·ã€‚' },
  'ç”Ÿæ´»æœåŠ¡': { aliases: ['ç»´ä¿®', 'å®¶æ”¿', 'æ¬å®¶', 'ä¿æ´', 'è£…ä¿®', 'æ´—è¡£', 'å¹²æ´—', 'å® ç‰©', 'æ‘„å½±', 'å©šåº†', 'å®¶ç”µ', 'å›æ”¶'],
    commonViolations: ['æœåŠ¡æœªå®ŒæˆæŠ•è¯‰', 'ä»·æ ¼äº‰è®®', 'æœåŠ¡è´¨é‡æŠ•è¯‰'],
    appealTips: 'ç”Ÿæ´»æœåŠ¡éœ€æä¾›æœåŠ¡äººå‘˜èµ„è´¨ã€æœåŠ¡åˆåŒæ¨¡æ¿ã€å®¢æˆ·è¯„ä»·ã€è¥ä¸šåœºæ‰€ç…§ç‰‡ã€‚å¼ºè°ƒ"å·²æ ‡å‡†åŒ–æœåŠ¡æµç¨‹ã€æ˜ç¡®æœåŠ¡æ ‡å‡†å’ŒéªŒæ”¶æ¡ä»¶"ã€‚',
    businessModel: 'é¢å‘æœ¬åœ°å±…æ°‘æä¾›ä¸“ä¸šçš„ç”Ÿæ´»æœåŠ¡ï¼ŒåŒ…å«ä¸Šé—¨æœåŠ¡å’Œåˆ°åº—æœåŠ¡ã€‚æœåŠ¡å‰æ˜ç¡®æ²Ÿé€šæœåŠ¡å†…å®¹å’Œè´¹ç”¨ï¼ŒæœåŠ¡åå®¢æˆ·ç¡®è®¤æ»¡æ„å†å®Œæˆæ”¯ä»˜ã€‚' },
  'æ—…æ¸¸': { aliases: ['æ—…æ¸¸', 'æ—…è¡Œ', 'é…’åº—', 'æ°‘å®¿', 'é—¨ç¥¨', 'æ™¯åŒº', 'æœºç¥¨', 'ç­¾è¯'],
    commonViolations: ['è¡Œç¨‹å–æ¶ˆé€€æ¬¾', 'æœåŠ¡ä¸ç¬¦æŠ•è¯‰', 'é¢„ä»˜è´¹çº çº·'],
    appealTips: 'æ—…æ¸¸è¡Œä¸šéœ€æä¾›æ—…è¡Œç¤¾èµ„è´¨ã€æ—…æ¸¸ä¿é™©è¯æ˜ã€è¡Œç¨‹åˆåŒæ¨¡æ¿ã€å®¢æˆ·å¥½è¯„ã€åˆä½œæ™¯åŒº/é…’åº—åè®®ã€‚å¼ºè°ƒ"å·²å®Œå–„é€€æ”¹æ”¿ç­–ã€è´­ä¹°æ—…æ¸¸æ„å¤–é™©ã€å»ºç«‹åº”æ€¥å¤„ç†æœºåˆ¶"ã€‚',
    businessModel: 'ä¸ºæ¶ˆè´¹è€…æä¾›æ—…æ¸¸å‡ºè¡ŒæœåŠ¡ï¼ŒåŒ…å«çº¿è·¯è§„åˆ’ã€é…’åº—é¢„è®¢ã€é—¨ç¥¨ä»£è´­ç­‰ã€‚æ‰€æœ‰è¡Œç¨‹å‡ç­¾è®¢æ­£å¼æ—…æ¸¸åˆåŒï¼Œè´­ä¹°æ—…æ¸¸æ„å¤–ä¿é™©ï¼Œæä¾›7Ã—24å°æ—¶å®¢æœã€‚' },
  'å¥åº·': { aliases: ['å¥åº·', 'åŒ»ç–—', 'è¯å“', 'è¯åº—', 'è¯Šæ‰€', 'ä½“æ£€', 'ä¿å¥', 'å¥èº«', 'ç‘œä¼½', 'ä¸­åŒ»', 'ç†ç–—'],
    commonViolations: ['å¤¸å¤§å®£ä¼ ', 'èµ„è´¨é—®é¢˜', 'æ•ˆæœäº‰è®®æŠ•è¯‰', 'é€€è´¹çº çº·'],
    appealTips: 'å¥åº·è¡Œä¸šéœ€æä¾›åŒ»ç–—æœºæ„æ‰§ä¸šè®¸å¯/è¯å“ç»è¥è®¸å¯ã€ä»ä¸šäººå‘˜èµ„è´¨ã€äº§å“æ£€æµ‹æŠ¥å‘Šã€‚å¼ºè°ƒ"å·²è§„èŒƒå®£ä¼ ç”¨è¯­ã€æœç»å¤¸å¤§æ•ˆæœã€ä¸¥æ ¼éµå®ˆå¹¿å‘Šæ³•"ã€‚',
    businessModel: 'é€šè¿‡å®ä½“é—¨åº—/è¯Šæ‰€ä¸ºæ¶ˆè´¹è€…æä¾›ä¸“ä¸šçš„å¥åº·æœåŠ¡/äº§å“ï¼Œæ‰€æœ‰ä»ä¸šäººå‘˜æŒè¯ä¸Šå²—ï¼Œäº§å“å‡æœ‰åˆæ³•èµ„è´¨å’Œæ£€éªŒæŠ¥å‘Šã€‚' },
  'ç§‘æŠ€': { aliases: ['ç§‘æŠ€', 'è½¯ä»¶', 'saas', 'app', 'å°ç¨‹åºå¼€å‘', 'ç½‘ç«™', 'äº’è”ç½‘', 'it', 'æŠ€æœ¯æœåŠ¡', 'ç³»ç»Ÿå¼€å‘', 'å¹³å°', 'å·¥å…·'],
    commonViolations: ['æœåŠ¡æœªäº¤ä»˜', 'åŠŸèƒ½ä¸ç¬¦æŠ•è¯‰', 'ç»­è´¹çº çº·'],
    appealTips: 'ç§‘æŠ€å…¬å¸éœ€æä¾›è½¯ä»¶è‘—ä½œæƒã€å…¬å¸æŠ€æœ¯å›¢é˜Ÿä»‹ç»ã€æœåŠ¡åˆåŒæ¨¡æ¿ã€å®¢æˆ·éªŒæ”¶æŠ¥å‘Šã€‚å¼ºè°ƒ"å·²å®Œå–„é¡¹ç›®äº¤ä»˜æµç¨‹ã€å»ºç«‹é‡Œç¨‹ç¢‘éªŒæ”¶æœºåˆ¶"ã€‚',
    businessModel: 'ä¸ºä¼ä¸šå®¢æˆ·æä¾›ä¸“ä¸šçš„æŠ€æœ¯æœåŠ¡/è½¯ä»¶äº§å“ï¼Œé‡‡ç”¨é¡¹ç›®åˆ¶æˆ–è®¢é˜…åˆ¶æ”¶è´¹ï¼Œæä¾›å®Œå–„çš„å”®å‰å’¨è¯¢ã€å¼€å‘äº¤ä»˜å’Œå”®åæŠ€æœ¯æ”¯æŒã€‚' },
  'è´¢ç¨æœåŠ¡': { aliases: ['å¹´æŠ¥', 'è´¢ç¨', 'è®°è´¦', 'æŠ¥ç¨', 'è´¢åŠ¡', 'ä¼šè®¡', 'ç¨åŠ¡', 'å®¡è®¡', 'ä»£è´¦', 'å·¥å•†æ³¨å†Œ', 'å·¥å•†ä»£åŠ', 'ä¼ä¸šæœåŠ¡', 'ä»£ç†è®°è´¦'],
    commonViolations: ['æœåŠ¡æœªå…‘ç°æŠ•è¯‰', 'é€€è´¹çº çº·', 'èµ„è´¨é—®é¢˜'],
    appealTips: 'è´¢ç¨æœåŠ¡éœ€æä¾›ä»£ç†è®°è´¦è®¸å¯è¯ã€æœåŠ¡åˆåŒæ¨¡æ¿ã€å®¢æˆ·æœåŠ¡è®°å½•ã€å…¬å¸èµ„è´¨ã€‚å¼ºè°ƒ"å·²è§„èŒƒæœåŠ¡æµç¨‹ã€æä¾›æ ‡å‡†åŒ–æœåŠ¡åè®®ã€å®¢æˆ·å¯éšæ—¶æŸ¥çœ‹æœåŠ¡è¿›åº¦"ã€‚',
    businessModel: 'ä¸ºä¸­å°ä¼ä¸šæä¾›ä¸“ä¸šçš„è´¢ç¨ä»£ç†æœåŠ¡ï¼ŒåŒ…å«å¹´æŠ¥ç”³æŠ¥ã€ä»£ç†è®°è´¦ã€ç¨åŠ¡ç”³æŠ¥ã€å·¥å•†å˜æ›´ç­‰ã€‚é€šè¿‡è‡ªæœ‰å°ç¨‹åº/å¹³å°æ¥å•ï¼Œæä¾›æ ‡å‡†åŒ–çš„çº¿ä¸Š+çº¿ä¸‹æœåŠ¡æµç¨‹ã€‚' },
  'ç‰©æµ': { aliases: ['ç‰©æµ', 'å¿«é€’', 'é…é€', 'è´§è¿', 'è¿è¾“', 'ä»“å‚¨', 'åŒåŸé…é€', 'è·‘è…¿', 'é—ªé€'],
    commonViolations: ['æœåŠ¡å»¶è¿ŸæŠ•è¯‰', 'è´§ç‰©æŸåæŠ•è¯‰', 'è´¹ç”¨äº‰è®®'],
    appealTips: 'ç‰©æµè¡Œä¸šéœ€æä¾›è¿è¾“èµ„è´¨ã€è½¦è¾†ä¿¡æ¯ã€ä¿é™©å‡­è¯ã€æœåŠ¡åˆåŒã€‚å¼ºè°ƒ"å·²å®Œå–„è´§ç‰©è¿½è¸ªç³»ç»Ÿã€å»ºç«‹ç†èµ”å¿«é€Ÿé€šé“"ã€‚',
    businessModel: 'ä¸ºå•†å®¶å’Œä¸ªäººæä¾›ä¸“ä¸šçš„ç‰©æµé…é€æœåŠ¡ï¼Œæä¾›å®æ—¶è¿½è¸ªã€ç­¾æ”¶ç¡®è®¤ç­‰åŠŸèƒ½ï¼Œä¿éšœè´§ç‰©å®‰å…¨åŠæ—¶é€è¾¾ã€‚' },
  'å†œä¸š': { aliases: ['å†œä¸š', 'å†œäº§å“', 'æ°´æœ', 'è”¬èœ', 'ç”Ÿé²œ', 'èŒ¶å¶', 'ç‰¹äº§', 'å…»æ®–', 'ç§æ¤', 'å†œåœº'],
    commonViolations: ['å•†å“è´¨é‡æŠ•è¯‰', 'å‘è´§å»¶è¿Ÿ', 'é€€æ¬¾çº çº·'],
    appealTips: 'å†œä¸šéœ€æä¾›é£Ÿå“ç»è¥è®¸å¯è¯ã€äº§å“æ£€æµ‹æŠ¥å‘Šã€äº§åœ°è¯æ˜ã€å†·é“¾ç‰©æµåˆåŒã€‚å¼ºè°ƒ"å·²å»ºç«‹äº§å“è´¨é‡æº¯æºä½“ç³»ã€å®Œå–„å†·é“¾é…é€ä¿éšœ"ã€‚',
    businessModel: 'ç›´æ¥å¯¹æ¥äº§åœ°ï¼Œä¸ºæ¶ˆè´¹è€…æä¾›æ–°é²œä¼˜è´¨çš„å†œäº§å“/ç‰¹äº§ï¼Œé€šè¿‡å°ç¨‹åºçº¿ä¸Šä¸‹å•ã€å†·é“¾ç‰©æµé…é€åˆ°å®¶ã€‚' },
  'æ¸¸æˆ': { aliases: ['æ¸¸æˆ', 'æ‰‹æ¸¸', 'ç«¯æ¸¸', 'é¡µæ¸¸', 'å°æ¸¸æˆ', 'æ¸¸æˆä»£ç»ƒ', 'æ¸¸æˆè´¦å·', 'æ¸¸æˆäº¤æ˜“', 'ç‚¹åˆ¸', 'é’»çŸ³', 'çš®è‚¤'],
    commonViolations: ['è™šæ‹Ÿå•†å“æŠ•è¯‰', 'å……å€¼çº çº·', 'æœªæˆå¹´äººæ¶ˆè´¹æŠ•è¯‰', 'æ¶‰èµŒå«Œç–‘'],
    appealTips: 'æ¸¸æˆè¡Œä¸šéœ€æä¾›æ¸¸æˆç‰ˆå·/è½¯è‘—ã€é˜²æ²‰è¿·ç³»ç»Ÿæˆªå›¾ã€æœªæˆå¹´äººæ¶ˆè´¹é€€æ¬¾æœºåˆ¶ã€å®åè®¤è¯ç³»ç»Ÿè¯´æ˜ã€‚å¼ºè°ƒ"å·²å®Œå–„é˜²æ²‰è¿·æœºåˆ¶ã€æœªæˆå¹´äººå……å€¼100%å¯é€€ã€æ‰€æœ‰è™šæ‹Ÿå•†å“æ˜ç æ ‡ä»·"ã€‚',
    businessModel: 'ä¸ºç”¨æˆ·æä¾›æ­£è§„åˆæ³•çš„æ¸¸æˆå¨±ä¹æœåŠ¡/è™šæ‹Ÿå•†å“äº¤æ˜“ã€‚å·²å–å¾—ç›¸å…³èµ„è´¨ï¼Œå®è¡Œå®åè®¤è¯å’Œé˜²æ²‰è¿·ç³»ç»Ÿï¼Œä¿éšœç”¨æˆ·åˆæ³•æƒç›Šã€‚' },
  'é™ªç©ç¤¾äº¤': { aliases: ['é™ªç©', 'é™ªèŠ', 'è¯­éŸ³ç¤¾äº¤', 'è¯­éŸ³æˆ¿', 'ç›´æ’­', 'ä¸»æ’­', 'ç§€åœº', 'ç¤¾äº¤å¹³å°', 'äº¤å‹å¹³å°', 'å£°ä¼˜'],
    commonViolations: ['æ¶‰é»„å«Œç–‘', 'è¯±å¯¼æ¶ˆè´¹æŠ•è¯‰', 'è™šå‡å®£ä¼ ', 'é€€è´¹çº çº·'],
    appealTips: 'é™ªç©ç¤¾äº¤éœ€æä¾›ICPå¤‡æ¡ˆã€å†…å®¹å®¡æ ¸æœºåˆ¶è¯´æ˜ã€ä¸»æ’­/é™ªç©å®åè®¤è¯è®°å½•ã€ç”¨æˆ·æŠ•è¯‰å¤„ç†è®°å½•ã€‚å¼ºè°ƒ"å·²å»ºç«‹7Ã—24å°æ—¶å†…å®¹å®¡æ ¸å›¢é˜Ÿã€ä¸¥ç¦è¿è§„å†…å®¹ã€å®Œå–„é€€è´¹æœºåˆ¶"ã€‚',
    businessModel: 'ä¸ºç”¨æˆ·æä¾›åˆè§„çš„æ¸¸æˆé™ªç©/è¯­éŸ³ç¤¾äº¤æœåŠ¡ï¼Œæ‰€æœ‰é™ªç©äººå‘˜å‡ç»è¿‡å®åè®¤è¯å’ŒåŸ¹è®­ã€‚å¹³å°è®¾æœ‰å®Œå–„çš„å†…å®¹å®¡æ ¸æœºåˆ¶å’ŒæŠ•è¯‰å¤„ç†æµç¨‹ã€‚' },
  'ç›²ç›’æ½®ç©': { aliases: ['ç›²ç›’', 'æ½®ç©', 'æ‰‹åŠ', 'å…¬ä»”', 'æ‰­è›‹', 'æŠ½å¥–', 'ç¦è¢‹', 'æƒŠå–œç®±', 'å¡ç‰Œ', 'çƒæ˜Ÿå¡', 'é›†æ¢å¡'],
    commonViolations: ['æ¶‰èµŒå«Œç–‘', 'è™šå‡å®£ä¼ ', 'æ¦‚ç‡ä¸é€æ˜æŠ•è¯‰', 'é€€æ¬¾çº çº·'],
    appealTips: 'ç›²ç›’è¡Œä¸šéœ€æä¾›æ¦‚ç‡å…¬ç¤ºæˆªå›¾ã€äº§å“è´¨é‡æ£€æµ‹æŠ¥å‘Šã€è¿›è´§å‡­è¯ã€é€€æ¢æ”¿ç­–ã€‚å¼ºè°ƒ"å·²ä¸¥æ ¼å…¬ç¤ºæŠ½å–æ¦‚ç‡ã€å•æ¬¡æ¶ˆè´¹é™é¢ã€æä¾›ä¿åº•æœºåˆ¶ã€æ”¯æŒæ— ç†ç”±é€€æ¬¾"ã€‚',
    businessModel: 'ä¸ºæ¶ˆè´¹è€…æä¾›æ­£è§„çš„ç›²ç›’/æ½®ç©å•†å“é”€å”®æœåŠ¡ã€‚æ‰€æœ‰å•†å“å‡ä¸ºæ­£è§„æ¸ é“é‡‡è´­ï¼ŒæŠ½å–æ¦‚ç‡å…¬å¼€é€æ˜ï¼Œè®¾æœ‰å•æ¬¡æ¶ˆè´¹é™é¢å’Œä¿åº•æœºåˆ¶ï¼Œæ”¯æŒ7å¤©æ— ç†ç”±é€€æ¢ã€‚' },
  'æ±½è½¦': { aliases: ['æ±½è½¦', 'è½¦', 'äºŒæ‰‹è½¦', 'æ±½ä¿®', 'æ´—è½¦', 'ä¿å…»', 'è½¦é™©', 'é©¾æ ¡', 'ç§Ÿè½¦', 'ä»£é©¾', 'åŠ æ²¹', 'å……ç”µæ¡©', 'æ–°èƒ½æº'],
    commonViolations: ['æœåŠ¡çº çº·', 'ä»·æ ¼äº‰è®®', 'è™šå‡è½¦å†µæŠ•è¯‰'],
    appealTips: 'æ±½è½¦è¡Œä¸šéœ€æä¾›è¥ä¸šèµ„è´¨ã€ç»´ä¿®èµ„è´¨è¯ä¹¦ã€ä»·ç›®è¡¨å…¬ç¤ºã€æœåŠ¡åˆåŒæ¨¡æ¿ã€‚å¼ºè°ƒ"å·²è§„èŒƒæœåŠ¡ä»·æ ¼å…¬ç¤ºã€å»ºç«‹æœåŠ¡æ ‡å‡†åŒ–æµç¨‹ã€å®Œå–„å®¢æˆ·æŠ•è¯‰å¤„ç†æœºåˆ¶"ã€‚',
    businessModel: 'ä¸ºè½¦ä¸»æä¾›ä¸“ä¸šçš„æ±½è½¦ç›¸å…³æœåŠ¡ï¼Œæ‰€æœ‰æŠ€æœ¯äººå‘˜æŒè¯ä¸Šå²—ï¼Œä»·æ ¼é€æ˜å…¬ç¤ºï¼ŒæœåŠ¡å†…å®¹å’Œè´¹ç”¨æå‰å‘ŠçŸ¥ï¼Œç¡®ä¿æ¶ˆè´¹è€…çŸ¥æƒ…æƒã€‚' },
  'æˆ¿äº§ç§Ÿèµ': { aliases: ['æˆ¿äº§', 'æˆ¿åœ°äº§', 'ç§Ÿæˆ¿', 'ç§Ÿèµ', 'æ°‘å®¿', 'å…¬å¯“', 'é•¿ç§Ÿ', 'çŸ­ç§Ÿ', 'ä¸­ä»‹', 'æˆ¿å±‹', 'ç‰©ä¸š', 'å†™å­—æ¥¼'],
    commonViolations: ['æŠ¼é‡‘é€€è¿˜çº çº·', 'è™šå‡æˆ¿æºæŠ•è¯‰', 'æœåŠ¡è´¹äº‰è®®'],
    appealTips: 'æˆ¿äº§ç§Ÿèµéœ€æä¾›æˆ¿å±‹ç§Ÿèµå¤‡æ¡ˆã€è¥ä¸šèµ„è´¨ã€çœŸå®æˆ¿æºè¯æ˜ã€åˆåŒæ¨¡æ¿ã€é€€æ¬¾æ”¿ç­–ã€‚å¼ºè°ƒ"å·²ç¡®ä¿æ‰€æœ‰æˆ¿æºçœŸå®å¯é ã€ç­¾è®¢æ ‡å‡†ç§ŸèµåˆåŒã€é€€æ¬¾æµç¨‹é€æ˜"ã€‚',
    businessModel: 'ä¸ºç”¨æˆ·æä¾›çœŸå®å¯é çš„æˆ¿å±‹ç§Ÿèµ/ä¸­ä»‹æœåŠ¡ï¼Œæ‰€æœ‰æˆ¿æºç»è¿‡å®åœ°éªŒè¯ï¼Œç­¾è®¢æ ‡å‡†åˆåŒï¼ŒæŠ¼é‡‘é€€è¿˜æœ‰æ˜ç¡®æµç¨‹å’Œæ—¶é™ã€‚' },
  'çŸ¥è¯†ä»˜è´¹': { aliases: ['çŸ¥è¯†ä»˜è´¹', 'ä»˜è´¹è¯¾ç¨‹', 'ä¼šå‘˜', 'VIP', 'ä¸“æ ', 'ç”µå­ä¹¦', 'è¯»ä¹¦ä¼š', 'ç¤¾ç¾¤', 'è®­ç»ƒè¥', 'å’¨è¯¢', 'é—®ç­”'],
    commonViolations: ['å†…å®¹ä¸ç¬¦æŠ•è¯‰', 'é€€è´¹çº çº·', 'è™šå‡å®£ä¼ ', 'æ•ˆæœä¸è¾¾é¢„æœŸ'],
    appealTips: 'çŸ¥è¯†ä»˜è´¹éœ€æä¾›å†…å®¹åˆ›ä½œå›¢é˜Ÿä»‹ç»ã€è¯¾ç¨‹å¤§çº²ã€ç”¨æˆ·è¯„ä»·æˆªå›¾ã€é€€è´¹æ”¿ç­–ã€‚å¼ºè°ƒ"å·²å®Œå–„è¯¾ç¨‹è¯•çœ‹æœºåˆ¶ã€å»ºç«‹7å¤©é€€æ¬¾é€šé“ã€è¯¾ç¨‹å†…å®¹ä¸å®£ä¼ æè¿°ä¸€è‡´"ã€‚',
    businessModel: 'ä¸ºç”¨æˆ·æä¾›ä¸“ä¸šçš„çŸ¥è¯†å†…å®¹æœåŠ¡ï¼ŒåŒ…å«åœ¨çº¿è¯¾ç¨‹ã€ä¸“æ æ–‡ç« ã€ç¤¾ç¾¤æœåŠ¡ç­‰ã€‚æä¾›è¯¾ç¨‹è¯•çœ‹/è¯•è¯»åŠŸèƒ½ï¼Œæ”¯æŒä¸æ»¡æ„é€€æ¬¾ï¼Œå†…å®¹è´¨é‡æœ‰ä¿éšœã€‚' },
  'ç¥¨åŠ¡æ¼”å‡º': { aliases: ['ç¥¨åŠ¡', 'æ¼”å‡º', 'æ¼”å”±ä¼š', 'å±•è§ˆ', 'å±•ä¼š', 'é—¨ç¥¨', 'æ´»åŠ¨', 'èµ›äº‹', 'è¯å‰§', 'éŸ³ä¹èŠ‚', 'è„±å£ç§€'],
    commonViolations: ['é€€ç¥¨çº çº·', 'æ´»åŠ¨å–æ¶ˆæŠ•è¯‰', 'å‡ç¥¨æŠ•è¯‰', 'åº§ä½ä¸ç¬¦'],
    appealTips: 'ç¥¨åŠ¡è¡Œä¸šéœ€æä¾›æ¼”å‡ºç»è¥è®¸å¯ã€åˆä½œåœºé¦†åè®®ã€ç¥¨åŠ¡æ¥æºè¯æ˜ã€é€€ç¥¨æ”¿ç­–ã€‚å¼ºè°ƒ"å·²ä¸å®˜æ–¹åˆä½œç¡®ä¿ç¥¨æºçœŸå®ã€å»ºç«‹æ´»åŠ¨å–æ¶ˆå…¨é¢é€€æ¬¾æœºåˆ¶"ã€‚',
    businessModel: 'ä¸ºæ¶ˆè´¹è€…æä¾›æ­£è§„çš„ç¥¨åŠ¡ä»£ç†/æ´»åŠ¨ç»„ç»‡æœåŠ¡ï¼Œç¥¨æºå‡æ¥è‡ªå®˜æ–¹æ¸ é“æˆ–æˆæƒä»£ç†ï¼Œæä¾›ç”µå­ç¥¨éªŒè¯å’Œé€€æ”¹ç­¾æœåŠ¡ã€‚' },
  'äºŒæ‰‹äº¤æ˜“': { aliases: ['äºŒæ‰‹', 'é—²ç½®', 'å›æ”¶', 'è½¬è®©', 'æ—§è´§', 'ç¿»æ–°', 'ä»¥æ—§æ¢æ–°', 'å¯„å–', 'å…¸å½“'],
    commonViolations: ['å•†å“è´¨é‡æŠ•è¯‰', 'æè¿°ä¸ç¬¦', 'å”®åçº çº·', 'æ¶‰å«Œå”®å‡'],
    appealTips: 'äºŒæ‰‹äº¤æ˜“éœ€æä¾›éªŒè´§æµç¨‹è¯´æ˜ã€å•†å“è¯„ä¼°æ ‡å‡†ã€äº¤æ˜“åˆåŒæ¨¡æ¿ã€å”®åä¿éšœæ”¿ç­–ã€‚å¼ºè°ƒ"å·²å»ºç«‹ä¸“ä¸šéªŒè´§å›¢é˜Ÿã€å•†å“çœŸå®åˆ†çº§è¯„ä¼°ã€æä¾›é€€è´§ä¿éšœ"ã€‚',
    businessModel: 'ä¸ºç”¨æˆ·æä¾›äºŒæ‰‹å•†å“äº¤æ˜“/å›æ”¶æœåŠ¡ï¼Œæ‰€æœ‰å•†å“ç»è¿‡ä¸“ä¸šéªŒè´§è¯„ä¼°ï¼ŒçœŸå®æ ‡æ³¨å•†å“æˆè‰²ï¼Œæä¾›äº¤æ˜“ä¿éšœå’Œå”®åæœåŠ¡ã€‚' },
  'ä¿é™©': { aliases: ['ä¿é™©', 'ä¿é™©ä»£ç†', 'ä¿é™©ç»çºª', 'è½¦é™©', 'å¯¿é™©', 'æ„å¤–é™©', 'å¥åº·é™©', 'ä¿é™©ç§‘æŠ€'],
    commonViolations: ['è¯¯å¯¼é”€å”®æŠ•è¯‰', 'ç†èµ”çº çº·', 'èµ„è´¨é—®é¢˜'],
    appealTips: 'ä¿é™©è¡Œä¸šéœ€æä¾›ä¿é™©ä»£ç†/ç»çºªç‰Œç…§ã€åˆä½œä¿é™©å…¬å¸åè®®ã€é”€å”®äººå‘˜èµ„è´¨è¯æ˜ã€‚å¼ºè°ƒ"å·²è§„èŒƒé”€å”®è¯æœ¯ã€å¦‚å®å‘ŠçŸ¥ä¿é™©æ¡æ¬¾ã€å»ºç«‹ç†èµ”ååŠ©æœºåˆ¶"ã€‚',
    businessModel: 'ä¸ºå®¢æˆ·æä¾›ä¸“ä¸šçš„ä¿é™©å’¨è¯¢å’Œä»£ç†æœåŠ¡ï¼Œä¸æ­£è§„ä¿é™©å…¬å¸åˆä½œï¼Œæ‰€æœ‰é”€å”®äººå‘˜æŒè¯ä¸Šå²—ï¼Œä¸¥æ ¼éµå®ˆä¿é™©é”€å”®è§„èŒƒã€‚' },
  'ç å®é¥°å“': { aliases: ['ç å®', 'é»„é‡‘', 'ç™½é“¶', 'é’»çŸ³', 'ç¿¡ç¿ ', 'ç‰çŸ³', 'é¦–é¥°', 'æ‰‹è¡¨', 'å¥¢ä¾ˆå“', 'åè¡¨', 'ååŒ…'],
    commonViolations: ['å”®å‡æŠ•è¯‰', 'å“è´¨äº‰è®®', 'ä»·æ ¼è™šé«˜æŠ•è¯‰', 'é‰´å®šçº çº·'],
    appealTips: 'ç å®è¡Œä¸šéœ€æä¾›å“ç‰Œæˆæƒä¹¦ã€é‰´å®šè¯ä¹¦ã€è¿›è´§å‘ç¥¨ã€GIA/å›½æ£€ç­‰æƒå¨é‰´å®šæŠ¥å‘Šã€‚å¼ºè°ƒ"æ‰€æœ‰å•†å“å‡é…æœ‰æƒå¨é‰´å®šè¯ä¹¦ã€æ”¯æŒå¤æ£€ã€å‡ä¸€èµ”å"ã€‚',
    businessModel: 'ä¸ºæ¶ˆè´¹è€…æä¾›æ­£å“ç å®/é¥°å“/å¥¢ä¾ˆå“é”€å”®æœåŠ¡ï¼Œæ‰€æœ‰å•†å“å‡æ¥è‡ªæ­£è§„æ¸ é“ï¼Œé…æœ‰æƒå¨é‰´å®šæœºæ„å‡ºå…·çš„é‰´å®šè¯ä¹¦ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹å¤æ£€ã€‚' },
  'å® ç‰©': { aliases: ['å® ç‰©', 'å® ç‰©åº—', 'å® ç‰©åŒ»é™¢', 'å® ç‰©ç¾å®¹', 'å® ç‰©é£Ÿå“', 'çŒ«ç²®', 'ç‹—ç²®', 'å® ç‰©ç”¨å“', 'èŒå® ', 'çŒ«', 'ç‹—'],
    commonViolations: ['æ´»ä½“äº¤æ˜“çº çº·', 'å¥åº·é—®é¢˜æŠ•è¯‰', 'å•†å“è´¨é‡æŠ•è¯‰'],
    appealTips: 'å® ç‰©è¡Œä¸šéœ€æä¾›åŠ¨ç‰©è¯Šç–—è®¸å¯ï¼ˆå® ç‰©åŒ»é™¢ï¼‰ã€æ£€ç–«è¯æ˜ã€å¥åº·ä¿éšœåè®®ã€å”®åæœåŠ¡æ¡æ¬¾ã€‚å¼ºè°ƒ"å·²å»ºç«‹å® ç‰©å¥åº·ä¿éšœæœºåˆ¶ã€æä¾›å”®åè·Ÿè¸ªæœåŠ¡"ã€‚',
    businessModel: 'ä¸ºå® ç‰©ä¸»äººæä¾›ä¸“ä¸šçš„å® ç‰©å•†å“/æœåŠ¡ï¼ŒåŒ…å«å® ç‰©ç”¨å“é”€å”®ã€å® ç‰©ç¾å®¹/åŒ»ç–—ç­‰ã€‚æ‰€æœ‰å•†å“å‡ä¸ºæ­£è§„å“ç‰Œï¼ŒæœåŠ¡äººå‘˜å‡ç»è¿‡ä¸“ä¸šåŸ¹è®­ã€‚' },
  'å¹¿å‘Šè¥é”€': { aliases: ['å¹¿å‘Š', 'è¥é”€', 'æ¨å¹¿', 'å¼•æµ', 'SEO', 'SEM', 'ä¿¡æ¯æµ', 'å…¬ä¼—å·è¿è¥', 'ä»£è¿è¥', 'æ–°åª’ä½“', 'MCN', 'ç½‘çº¢'],
    commonViolations: ['æ•ˆæœä¸è¾¾æ ‡æŠ•è¯‰', 'è™šå‡æ‰¿è¯º', 'è´¹ç”¨çº çº·'],
    appealTips: 'å¹¿å‘Šè¥é”€éœ€æä¾›è¥ä¸šèµ„è´¨ã€æœåŠ¡åˆåŒæ¨¡æ¿ã€æ•ˆæœæŠ¥å‘Šæ ·ä¾‹ã€å®¢æˆ·è¯„ä»·ã€‚å¼ºè°ƒ"å·²æ˜ç¡®æ•ˆæœæŒ‡æ ‡å’Œå…è´£æ¡æ¬¾ã€å®šæœŸæä¾›æ•°æ®æŠ¥å‘Šã€å»ºç«‹é€€è´¹æœºåˆ¶"ã€‚',
    businessModel: 'ä¸ºä¼ä¸šå®¢æˆ·æä¾›ä¸“ä¸šçš„å¹¿å‘ŠæŠ•æ”¾/è¥é”€æ¨å¹¿æœåŠ¡ï¼Œæä¾›æ•°æ®åŒ–æ•ˆæœè¿½è¸ªï¼Œå®šæœŸå‡ºå…·æ•ˆæœæŠ¥å‘Šï¼ŒåˆåŒæ˜ç¡®æœåŠ¡èŒƒå›´å’Œè€ƒæ ¸æ ‡å‡†ã€‚' },
}

// æ ¹æ®ç”¨æˆ·è¾“å…¥åŒ¹é…è¡Œä¸šï¼ˆä¼˜å…ˆåŒ¹é…æœ€é•¿çš„åˆ«åï¼Œé¿å…"çŸ¥è¯†ä»˜è´¹"åŒ¹é…åˆ°"æ•™è‚²"ï¼‰
function matchIndustry(text) {
  const t = text.toLowerCase()
  let bestMatch = null
  let bestLen = 0
  for (const [key, info] of Object.entries(INDUSTRY_KNOWLEDGE)) {
    for (const a of info.aliases) {
      if (t.includes(a) && a.length > bestLen) {
        bestMatch = { key, ...info }
        bestLen = a.length
      }
    }
  }
  if (bestMatch) return bestMatch

  // æ¨¡ç³ŠåŒ¹é…ï¼šé€šè¿‡å…³é”®è¯æ¨æ–­æœ€æ¥è¿‘çš„è¡Œä¸š
  const FUZZY_KEYWORDS = {
    'ç§‘æŠ€': ['è¿œç¨‹', 'ååŠ©', 'è°ƒè¯•', 'å¼€å‘', 'ç¼–ç¨‹', 'ä»£ç ', 'ç½‘ç«™', 'æœåŠ¡å™¨', 'æŠ€æœ¯', 'è¿ç»´', 'éƒ¨ç½²', 'æ•°æ®', 'IT', 'OBS', 'API', 'SDK', 'å°ç¨‹åºå¼€å‘'],
    'ç”Ÿæ´»æœåŠ¡': ['ä¸Šé—¨', 'åˆ°å®¶', 'å®‰è£…', 'æ¸…æ´', 'é™ªæŠ¤', 'è·‘è…¿', 'ä»£åŠ', 'å®¶ç”µç»´ä¿®', 'ç®¡é“', 'å¼€é”', 'æœˆå«‚'],
    'ç”µå•†': ['å–è´§', 'å–ä¸œè¥¿', 'å¸¦è´§', 'ç›´æ’­å–', 'çº¿ä¸Šå–', 'ç½‘ä¸Šå–', 'æœ‹å‹åœˆå–'],
    'æ•™è‚²': ['æ•™äºº', 'æˆè¯¾', 'è®²è¯¾', 'è¾…å¯¼', 'å®¶æ•™', 'åŸ¹è®­ç­', 'ç½‘è¯¾'],
    'é¤é¥®': ['åšé¥­', 'å¤–å–', 'ç‚¹é¤', 'å ‚é£Ÿ', 'é£Ÿå ‚', 'å°åƒ'],
    'é›¶å”®': ['å¼€åº—', 'å®ä½“åº—', 'é—¨åº—', 'å•†åº—', 'æ‚è´§', 'æ–‡å…·', 'æ•°ç äº§å“'],
    'å¥åº·': ['çœ‹ç—…', 'é—®è¯Š', 'ä½“æ£€', 'è¥å…»', 'å‡è‚¥', 'ä¸­è¯'],
    'å¹¿å‘Šè¥é”€': ['æ¥å•', 'è®¾è®¡', 'æµ·æŠ¥', 'è§†é¢‘å‰ªè¾‘', 'æ–‡æ¡ˆ', 'ç­–åˆ’', 'logo'],
  }
  let fuzzyMatch = null
  let fuzzyScore = 0
  for (const [indKey, keywords] of Object.entries(FUZZY_KEYWORDS)) {
    let score = 0
    for (const kw of keywords) {
      if (t.includes(kw.toLowerCase())) score++
    }
    if (score > fuzzyScore) {
      fuzzyScore = score
      fuzzyMatch = indKey
    }
  }
  if (fuzzyMatch && fuzzyScore >= 1) {
    const info = INDUSTRY_KNOWLEDGE[fuzzyMatch]
    if (info) return { key: fuzzyMatch, ...info, _fuzzy: true }
  }
  return null
}

// ========== ç°è‰²/æ•æ„Ÿè¡Œä¸šæ™ºèƒ½æ£€æµ‹ ==========
const SENSITIVE_INDUSTRIES = [
  { patterns: [/æ£‹ç‰Œ/, /éº»å°†/, /æ‰‘å…‹/, /å¾·å·/, /ç‚¸é‡‘èŠ±/, /æ–—åœ°ä¸»/, /æ•é±¼/, /ç”µç©/, /æ¸¸æˆ.*å¸/, /å¸.*æ¸¸æˆ/, /åšå½©/, /å½©ç¥¨/, /ç«çŒœ/, /èµŒ/, /è èœ/, /BC/i],
    category: 'æ£‹ç‰Œ/åšå½©ç±»', risk: 'æé«˜',
    warning: 'æ£‹ç‰Œåšå½©ç±»æ˜¯å¾®ä¿¡é£æ§æœ€ä¸¥æ ¼çš„ç±»ç›®ã€‚ç”³è¯‰å‰éœ€è¦ç¡®è®¤ï¼šæ‚¨çš„äº§å“æ˜¯å¦æœ‰çœŸå®è´§å¸å…‘æ¢åŠŸèƒ½ï¼Ÿæ˜¯å¦æœ‰æ¸¸æˆç‰ˆå·æˆ–è½¯ä»¶è‘—ä½œæƒï¼Ÿ',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹çš„æ¸¸æˆ/å¹³å°ï¼Ÿ\nâ‘¡ æ˜¯å¦æ¶‰åŠçœŸå®è´§å¸å……å€¼å’Œæç°ï¼Ÿ\nâ‘¢ æ˜¯å¦æœ‰æ¸¸æˆç‰ˆå·æˆ–è½¯ä»¶è‘—ä½œæƒï¼Ÿ\nâ‘£ ç›ˆåˆ©æ¨¡å¼æ˜¯ä»€ä¹ˆï¼ˆå¹¿å‘Š/ä¼šå‘˜/é“å…·ï¼‰ï¼Ÿ' },
  { patterns: [/è´·æ¬¾/, /å€Ÿè´·/, /ç½‘è´·/, /ç°é‡‘è´·/, /ä¿¡ç”¨è´·/, /æ¶ˆè´¹é‡‘è/, /å°é¢è´·/, /P2P/i, /æ”¾è´·/, /åŠ©è´·/, /èèµ„/],
    category: 'é‡‘èå€Ÿè´·ç±»', risk: 'é«˜',
    warning: 'é‡‘èå€Ÿè´·ç±»éœ€è¦æŒæœ‰ç›¸å…³é‡‘èç‰Œç…§æ‰èƒ½åˆè§„ç»è¥ã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  å…·ä½“æ˜¯ä»€ä¹ˆé‡‘èæœåŠ¡ï¼ˆåŠ©è´·ã€æ¶ˆè´¹åˆ†æœŸã€ä¼ä¸šèèµ„ï¼‰ï¼Ÿ\nâ‘¡ æ˜¯å¦æŒæœ‰é‡‘èç‰Œç…§æˆ–ä¸æŒç‰Œæœºæ„åˆä½œï¼Ÿ\nâ‘¢ èµ„é‡‘æ¥æºæ˜¯ä»€ä¹ˆï¼Ÿ\nâ‘£ å¹´åŒ–åˆ©ç‡åœ¨ä»€ä¹ˆèŒƒå›´ï¼Ÿ' },
  { patterns: [/è™šæ‹Ÿè´§å¸/, /æ¯”ç‰¹å¸/, /åŒºå—é“¾/, /æ•°å­—è´§å¸/, /åŠ å¯†/, /å¸åœˆ/, /äº¤æ˜“æ‰€/, /æŒ–çŸ¿/, /NFT/i, /Web3/i, /USDT/i, /ä»£å¸/],
    category: 'è™šæ‹Ÿè´§å¸/åŒºå—é“¾ç±»', risk: 'æé«˜',
    warning: 'è™šæ‹Ÿè´§å¸ç›¸å…³ä¸šåŠ¡åœ¨å›½å†…å±äºä¸¥æ ¼ç›‘ç®¡é¢†åŸŸï¼Œç”³è¯‰éš¾åº¦æå¤§ã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  å…·ä½“æ˜¯åŒºå—é“¾æŠ€æœ¯æœåŠ¡è¿˜æ˜¯è™šæ‹Ÿè´§å¸äº¤æ˜“ï¼Ÿ\nâ‘¡ æ˜¯å¦æ¶‰åŠäººæ°‘å¸ä¸è™šæ‹Ÿè´§å¸çš„å…‘æ¢ï¼Ÿ\nâ‘¢ å…¬å¸æ³¨å†Œåœ°åœ¨å“ªé‡Œï¼Ÿ\nâ‘£ ä¸»è¦é¢å‘å›½å†…è¿˜æ˜¯æµ·å¤–ç”¨æˆ·ï¼Ÿ' },
  { patterns: [/æˆäºº/, /æƒ…è¶£/, /ä¸¤æ€§/, /çº¦/, /é™ªèŠ/, /é™ªç©.*å¼‚æ€§/, /äº¤å‹.*ä»˜è´¹/, /è‰²/, /è·å®˜/],
    category: 'æˆäºº/ç¤¾äº¤ç±»', risk: 'æé«˜',
    warning: 'æ¶‰åŠæˆäººå†…å®¹çš„ä¸šåŠ¡åœ¨å¾®ä¿¡å¹³å°ç”³è¯‰æˆåŠŸç‡æä½ã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  å…·ä½“æ˜¯ä»€ä¹ˆäº§å“/æœåŠ¡ï¼Ÿ\nâ‘¡ æ˜¯å¦æœ‰çº¿ä¸‹å®ä½“ç»è¥ï¼Ÿ\nâ‘¢ å¹³å°ä¸Šæ˜¯å¦æœ‰ç”¨æˆ·ç”Ÿæˆå†…å®¹ï¼Ÿ\nâ‘£ æ˜¯å¦æœ‰å†…å®¹å®¡æ ¸æœºåˆ¶ï¼Ÿ' },
  { patterns: [/å‡è‚¥/, /ä¸°èƒ¸/, /å£®é˜³/, /ä¿å¥å“/, /ç¥›æ–‘/, /ç¾ç™½.*äº§å“/, /ä¸­è¯.*è°ƒç†/, /åæ–¹/, /ç§˜æ–¹/, /ç‰¹æ•ˆ/],
    category: 'ä¿å¥å“/åŠŸæ•ˆç±»', risk: 'ä¸­é«˜',
    warning: 'ä¿å¥å“åŠŸæ•ˆå®£ä¼ æ˜¯å¸¸è§è¿è§„åŸå› ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„å¹¿å‘Šæ³•åˆè§„ã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  å…·ä½“é”€å”®ä»€ä¹ˆäº§å“ï¼Ÿ\nâ‘¡ äº§å“æ˜¯å¦æœ‰é£Ÿå“/ä¿å¥å“æ‰¹æ–‡ï¼ˆè“å¸½å­ï¼‰ï¼Ÿ\nâ‘¢ å®£ä¼ ä¸­æ˜¯å¦æœ‰åŠŸæ•ˆæ‰¿è¯ºï¼Ÿ\nâ‘£ äº§å“è¿›è´§æ¸ é“æ˜¯ä»€ä¹ˆï¼Ÿ' },
  { patterns: [/ç”µå­çƒŸ/, /çƒŸæ²¹/, /çƒŸå¼¹/, /é›¾åŒ–/, /å°¼å¤ä¸/],
    category: 'ç”µå­çƒŸç±»', risk: 'é«˜',
    warning: 'ç”µå­çƒŸåœ¨å¾®ä¿¡å¹³å°å±äºç¦å”®ç±»ç›®ï¼Œç”³è¯‰éš¾åº¦è¾ƒå¤§ã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  æ˜¯é”€å”®ç”µå­çƒŸäº§å“è¿˜æ˜¯ç›¸å…³é…ä»¶ï¼Ÿ\nâ‘¡ æ˜¯å¦æœ‰çƒŸè‰ä¸“å–è®¸å¯ï¼Ÿ\nâ‘¢ é”€å”®æ¸ é“æ˜¯çº¿ä¸Šè¿˜æ˜¯çº¿ä¸‹ï¼Ÿ' },
  { patterns: [/åˆ†é”€/, /ä»£ç†/, /æ‹‰äºº/, /å›¢é˜Ÿ/, /è¿”ä½£/, /è£‚å˜/, /å¤šçº§/, /ä¸‹çº¿/, /æ¨å¹¿.*èµš/],
    category: 'åˆ†é”€/ä»£ç†ç±»', risk: 'ä¸­é«˜',
    warning: 'å¤šçº§åˆ†é”€æ¨¡å¼å®¹æ˜“è¢«åˆ¤å®šä¸ºä¼ é”€ï¼Œå¾®ä¿¡åªå…è®¸ä¸€çº§åˆ†é”€ã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  åˆ†é”€å±‚çº§æ˜¯å‡ çº§ï¼ˆç›´æ¨è¿˜æ˜¯å¤šçº§ï¼‰ï¼Ÿ\nâ‘¡ æ˜¯å¦éœ€è¦ç¼´çº³ä»£ç†è´¹/å…¥é—¨è´¹ï¼Ÿ\nâ‘¢ åˆ†é”€å‘˜æ˜¯å¦éœ€è¦å›¤è´§ï¼Ÿ\nâ‘£ ä½£é‡‘ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ' },
  { patterns: [/ä»¿/, /Aè´§/, /é«˜ä»¿/, /å¤åˆ»/, /åŸå•/, /å°¾å•/, /ä»£è´­.*å¥¢/, /å¤–è´¸åŸå•/],
    category: 'ä»¿å“/ä¾µæƒç±»', risk: 'æé«˜',
    warning: 'é”€å”®ä»¿å“å±äºä¸¥é‡è¿è§„ï¼Œç”³è¯‰æˆåŠŸç‡æä½ã€‚å¦‚æœæ˜¯æ­£å“ï¼Œè¯·å‡†å¤‡å¥½å“ç‰Œæˆæƒè¯æ˜ã€‚',
    followup: 'è¯·å¦‚å®è¯´æ˜ï¼š\n\nâ‘  é”€å”®çš„å•†å“æ˜¯æ­£å“è¿˜æ˜¯ä»¿å“ï¼Ÿ\nâ‘¡ æ˜¯å¦æœ‰å“ç‰Œæˆæƒä¹¦æˆ–è¿›è´§å‘ç¥¨ï¼Ÿ\nâ‘¢ å•†å“æ¥æºæ˜¯ä»€ä¹ˆæ¸ é“ï¼Ÿ' },
  { patterns: [/åˆ·å•/, /åˆ·é‡/, /åˆ·ç²‰/, /æ¶¨ç²‰/, /ä¹°ç²‰/, /æ•°æ®.*æœåŠ¡/, /ç‚¹èµ/, /é˜…è¯»é‡/],
    category: 'æ•°æ®é€ å‡/åˆ·é‡ç±»', risk: 'é«˜',
    warning: 'åˆ·å•åˆ·é‡æœåŠ¡è¿åå¹³å°è§„åˆ™ï¼Œç”³è¯‰éš¾åº¦å¾ˆå¤§ã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  å…·ä½“æä¾›ä»€ä¹ˆæœåŠ¡ï¼Ÿ\nâ‘¡ æœåŠ¡å¯¹è±¡æ˜¯å“ªäº›å¹³å°ï¼Ÿ\nâ‘¢ æ˜¯å¦æœ‰å…¶ä»–æ­£è§„ä¸šåŠ¡ï¼Ÿ' },
  { patterns: [/å……å€¼/, /ä»£å……/, /æ¸¸æˆå……å€¼/, /è¯è´¹å……å€¼/, /ä¼šå‘˜ä»£å¼€/, /ä½ä»·.*ä¼šå‘˜/, /å…±äº«.*è´¦å·/],
    category: 'è™šæ‹Ÿå……å€¼/ä»£å……ç±»', risk: 'ä¸­',
    warning: 'è™šæ‹Ÿå……å€¼ç±»éœ€è¦ç¡®è®¤è´§æºåˆæ³•æ€§å’Œæ˜¯å¦æœ‰ç›¸å…³æˆæƒã€‚',
    followup: 'è¯·è¯¦ç»†è¯´æ˜ï¼š\n\nâ‘  å…·ä½“å……å€¼ä»€ä¹ˆäº§å“ï¼ˆæ¸¸æˆ/è¯è´¹/ä¼šå‘˜ï¼‰ï¼Ÿ\nâ‘¡ è´§æºæ¸ é“æ˜¯ä»€ä¹ˆï¼Ÿ\nâ‘¢ æ˜¯å¦æ˜¯å®˜æ–¹æˆæƒçš„ä»£ç†ï¼Ÿ' },
]

// æ£€æµ‹æ•æ„Ÿè¡Œä¸š
function matchSensitiveIndustry(text) {
  const t = text.toLowerCase()
  for (const si of SENSITIVE_INDUSTRIES) {
    if (si.patterns.some(p => p.test(t))) return si
  }
  return null
}

// æ£€æµ‹æ¨¡ç³Š/ç¬¼ç»Ÿçš„è¡Œä¸šæè¿°
function isVagueIndustry(text) {
  const t = text.trim()
  // å¤ªçŸ­ï¼ˆ< 4å­—ä¸”ä¸æ˜¯æ˜ç¡®è¡Œä¸šè¯ï¼‰
  if (t.length < 4) {
    const knownShort = ['é¤é¥®', 'å¤–å–', 'é›¶å”®', 'æ•™è‚²', 'ç¾å®¹', 'ç¾å‘', 'ç‰©æµ', 'å¿«é€’', 'å†œä¸š', 'èŒ¶å¶', 'æ°´æœ']
    if (!knownShort.some(k => t.includes(k)) && !matchIndustry(t)) return true
  }
  // æåº¦ç¬¼ç»Ÿçš„æè¿°
  const vagueTerms = [/^ç”µå•†$/, /^äº’è”ç½‘$/, /^ç§‘æŠ€$/, /^æœåŠ¡$/, /^å•†åŸ$/, /^å¹³å°$/, /^è½¯ä»¶$/, /^ç½‘ç«™$/, /^app$/i, /^å°ç¨‹åº$/, /^å…¬ä¼—å·$/, /^çº¿ä¸Š$/, /^çº¿ä¸‹$/, /^å®ä½“$/, /^å–ä¸œè¥¿/, /^åšç”Ÿæ„/, /^å–è´§/]
  if (vagueTerms.some(p => p.test(t))) return true
  return false
}

// ç”Ÿæˆæ¨¡ç³Šè¡Œä¸šçš„è¿½é—®
function getVagueFollowup(text) {
  const t = text.trim()
  if (/ç”µå•†|å•†åŸ|å¹³å°|å–ä¸œè¥¿|å–è´§|åšç”Ÿæ„/.test(t)) {
    return `æ‚¨è¯´çš„æ˜¯${t}ï¼Œèƒ½å†å…·ä½“è¯´è¯´å—ï¼Ÿ\n\næ¯”å¦‚ï¼š\nâ‘  å–ä»€ä¹ˆç±»å‹çš„å•†å“ï¼ˆæœè£…ã€é£Ÿå“ã€ç”µå­äº§å“ã€æ—¥ç”¨å“â€¦â€¦ï¼‰ï¼Ÿ\nâ‘¡ è´§æºæ˜¯è‡ªå·±ç”Ÿäº§è¿˜æ˜¯ä»£ç†/æ‰¹å‘ï¼Ÿ\nâ‘¢ ä¸»è¦åœ¨å“ªäº›å¹³å°å–ï¼ˆè‡ªæœ‰å°ç¨‹åºã€æ·˜å®ã€æ‹¼å¤šå¤šï¼‰ï¼Ÿ\n\näº†è§£è¶Šè¯¦ç»†ï¼Œæˆ‘ç»™æ‚¨çš„ç”³è¯‰æ–¹æ¡ˆè¶Šç²¾å‡†~`
  }
  if (/äº’è”ç½‘|ç§‘æŠ€|è½¯ä»¶|ç½‘ç«™|app|å°ç¨‹åº|å…¬ä¼—å·/i.test(t)) {
    return `æ‚¨è¯´çš„æ˜¯${t}ï¼Œèƒ½å…·ä½“æè¿°ä¸€ä¸‹å—ï¼Ÿ\n\næ¯”å¦‚ï¼š\nâ‘  æä¾›ä»€ä¹ˆå…·ä½“æœåŠ¡æˆ–äº§å“ï¼Ÿ\nâ‘¡ é¢å‘çš„å®¢æˆ·æ˜¯ä¸ªäººè¿˜æ˜¯ä¼ä¸šï¼Ÿ\nâ‘¢ æ€ä¹ˆæ”¶è´¹çš„ï¼ˆè®¢é˜…åˆ¶ã€æŒ‰æ¬¡æ”¶è´¹ã€å…è´¹+å¢å€¼ï¼‰ï¼Ÿ\n\nä¸åŒç±»å‹çš„ç§‘æŠ€æœåŠ¡ï¼Œç”³è¯‰ç­–ç•¥å·®åˆ«å¾ˆå¤§~`
  }
  if (/æœåŠ¡|çº¿ä¸Š|çº¿ä¸‹|å®ä½“/.test(t)) {
    return `æ‚¨è¯´çš„æ˜¯${t}ï¼ŒèŒƒå›´æœ‰ç‚¹å¹¿ï¼Œèƒ½å…·ä½“è¯´è¯´å—ï¼Ÿ\n\næ¯”å¦‚ï¼š\nâ‘  å…·ä½“æä¾›ä»€ä¹ˆæœåŠ¡ï¼Ÿ\nâ‘¡ é¢å‘ä»€ä¹ˆå®¢æˆ·ç¾¤ä½“ï¼Ÿ\nâ‘¢ æ€ä¹ˆæ”¶è´¹çš„ï¼Ÿ\n\nè¿™æ ·æˆ‘æ‰èƒ½å¸®æ‚¨åŒ¹é…æœ€åˆé€‚çš„ç”³è¯‰ç­–ç•¥~`
  }
  return `ã€Œ${t}ã€è¿™ä¸ªæè¿°æœ‰ç‚¹ç®€çŸ­ï¼Œèƒ½å†è¯¦ç»†è¯´è¯´å—ï¼Ÿ\n\nâ‘  å…·ä½“åšä»€ä¹ˆä¸šåŠ¡/å–ä»€ä¹ˆäº§å“ï¼Ÿ\nâ‘¡ é¢å‘ä»€ä¹ˆå®¢æˆ·ï¼Ÿ\nâ‘¢ æ€ä¹ˆæ”¶è´¹çš„ï¼Ÿ\n\næè¿°è¶Šè¯¦ç»†ï¼Œæˆ‘ç»™æ‚¨çš„ç”³è¯‰æ–¹æ¡ˆå’Œè¯„ä¼°å°±è¶Šå‡†ç¡®~`
}

// ========== æ™ºèƒ½å­—æ®µæå–ï¼šä»ä»»æ„æ¶ˆæ¯ä¸­è¯†åˆ«å¤šç§æ•°æ® ==========
const BANK_NAMES = ['å·¥å•†é“¶è¡Œ','å»ºè®¾é“¶è¡Œ','å†œä¸šé“¶è¡Œ','ä¸­å›½é“¶è¡Œ','äº¤é€šé“¶è¡Œ','æ‹›å•†é“¶è¡Œ','é‚®å‚¨é“¶è¡Œ','é‚®æ”¿å‚¨è“„','æµ¦å‘é“¶è¡Œ','å…´ä¸šé“¶è¡Œ','æ°‘ç”Ÿé“¶è¡Œ','ä¸­ä¿¡é“¶è¡Œ','å…‰å¤§é“¶è¡Œ','åå¤é“¶è¡Œ','å¹³å®‰é“¶è¡Œ','å¹¿å‘é“¶è¡Œ','åŒ—äº¬é“¶è¡Œ','ä¸Šæµ·é“¶è¡Œ','å—äº¬é“¶è¡Œ','å®æ³¢é“¶è¡Œ','æ¸¤æµ·é“¶è¡Œ','æµ™å•†é“¶è¡Œ','æ’ä¸°é“¶è¡Œ','å¾½å•†é“¶è¡Œ','å†œå•†é“¶è¡Œ','å†œæ‘å•†ä¸š','ä¿¡ç”¨ç¤¾','æ‘é•‡é“¶è¡Œ']

function extractFieldsFromMessage(text, existingData = {}) {
  const extracted = {}
  const t = text.trim()

  // æ‰‹æœºå·ï¼ˆ11ä½ï¼Œ1å¼€å¤´ï¼‰
  const phoneMatch = t.match(/1[3-9]\d{9}/)
  if (phoneMatch && !existingData.contact_phone) extracted.contact_phone = phoneMatch[0]

  // å•†æˆ·å·ï¼ˆ8-12ä½çº¯æ•°å­—ï¼Œæ’é™¤æ‰‹æœºå·ï¼‰
  const noPhone = t.replace(/1[3-9]\d{9}/g, '')
  const merchantMatch = noPhone.match(/(?:å•†æˆ·å·[ï¼š:æ˜¯ä¸º]?\s*)(\d{8,12})/) || noPhone.match(/\b(\d{10})\b/)
  if (merchantMatch && !existingData.merchant_id) extracted.merchant_id = (merchantMatch[1] || merchantMatch[0]).trim()

  // ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼ˆ18ä½å­—æ¯æ•°å­—ï¼‰
  const licenseMatch = t.match(/[0-9A-HJ-NP-Z]{18}/i)
  if (licenseMatch && !existingData.license_no) extracted.license_no = licenseMatch[0].toUpperCase()

  // é“¶è¡Œåç§°
  for (const bank of BANK_NAMES) {
    if (t.includes(bank) && !existingData.bank_name) { extracted.bank_name = bank; break }
  }

  // å…¬å¸å…¨ç§°ï¼ˆå« å…¬å¸/æœ‰é™/ä¸ªä½“/å•†è¡Œ/å·¥ä½œå®¤ï¼‰
  if (!existingData.company_name) {
    // ä¼˜å…ˆåŒ¹é…"å…¬å¸å«/å…¬å¸æ˜¯"ç­‰æ˜ç¡®æŒ‡ç¤º
    const namedMatch = t.match(/(?:å…¬å¸|ä¼ä¸š|ä¸»ä½“)[å«æ˜¯ä¸ºï¼š:]\s*([^\s,ï¼Œã€‚]{3,30}(?:æœ‰é™å…¬å¸|è‚¡ä»½å…¬å¸|å…¬å¸|ä¸ªä½“å·¥å•†æˆ·|å•†è¡Œ|å•†åº—|å·¥ä½œå®¤|ä¼ä¸š))/)
    if (namedMatch) {
      extracted.company_name = namedMatch[1]
    } else {
      // é€šç”¨åŒ¹é…ï¼šè‡³å°‘å«2ä¸ªä¸­æ–‡å­—+åç¼€ï¼Œæ’é™¤æ³›ç§°
      const companyMatch = t.match(/[\u4e00-\u9fa5A-Za-z0-9]{3,}[\u4e00-\u9fa5](?:æœ‰é™å…¬å¸|è‚¡ä»½å…¬å¸|ä¸ªä½“å·¥å•†æˆ·|å•†è¡Œ|å·¥ä½œå®¤)/)
      if (companyMatch && !/^(æˆ‘ä»¬|ä½ ä»¬|ä»–ä»¬|äººå®¶|è¿™ä¸ª|é‚£ä¸ª)/.test(companyMatch[0])) extracted.company_name = companyMatch[0]
    }
  }

  // å¤„ç½šç±»å‹å…³é”®è¯
  if (!existingData.problem_type) {
    const normalized = normalizeProblemType(t)
    if (normalized) extracted.problem_type = normalized
  }

  // èº«ä»½è¯åå››ä½ï¼ˆæ˜ç¡®æåŠèº«ä»½è¯+4ä½æ•°å­—ï¼‰
  const idMatch = t.match(/(?:èº«ä»½è¯|èº«ä»½|è¯ä»¶)[å·ç ï¼š:]*.*?(\d{4})\b/)
  if (idMatch && !existingData.legal_id_last4) extracted.legal_id_last4 = idMatch[1]

  // è´¦æˆ·åå››ä½ï¼ˆæ˜ç¡®æåŠè´¦æˆ·/é“¶è¡Œå¡+4ä½æ•°å­—ï¼‰
  const bankAccMatch = t.match(/(?:è´¦æˆ·|è´¦å·|é“¶è¡Œå¡|å¡å·)[å·ç ï¼š:]*.*?(\d{4})\b/)
  if (bankAccMatch && !existingData.bank_account_last4) extracted.bank_account_last4 = bankAccMatch[1]

  // è¡Œä¸šæå–ï¼ˆä»è‡ªç„¶å¯¹è¯ä¸­è¯†åˆ«è¡Œä¸šå…³é”®è¯ï¼‰
  if (!existingData.industry) {
    for (const [indKey, indInfo] of Object.entries(INDUSTRY_KNOWLEDGE)) {
      for (const alias of indInfo.aliases) {
        if (t.includes(alias) && alias.length >= 2) {
          const normalized = matchIndustry(alias)
          if (normalized) { extracted.industry = normalized.key; break }
        }
      }
      if (extracted.industry) break
    }
  }

  // è¿è§„åŸå› æå–ï¼ˆä»è‡ªç„¶å¯¹è¯ä¸­è¯†åˆ«è¿è§„å…³é”®è¯ï¼‰
  if (!existingData.violation_reason) {
    const violationPatterns = [
      /æ¶‰å«Œ[\u4e00-\u9fff]{2,10}/,
      /(?:è¿è§„åŸå› |è¢«å¤„ç½š|åŸå› æ˜¯)[ï¼š:æ˜¯ä¸º]?\s*(.{2,30})/,
    ]
    for (const pat of violationPatterns) {
      const vm = t.match(pat)
      if (vm) { extracted.violation_reason = (vm[1] || vm[0]).trim(); break }
    }
  }

  // æ³•äººå§“åï¼ˆæ˜ç¡®æåŠæ³•äºº+2-4å­—ä¸­æ–‡åï¼‰
  if (!existingData.legal_name) {
    const legalMatch = t.match(/(?:æ³•äºº|æ³•å®šä»£è¡¨äºº|æ³•ä»£)[æ˜¯ä¸ºï¼š:å«]\s*([\u4e00-\u9fa5]{2,4})/)
    if (legalMatch) extracted.legal_name = legalMatch[1]
  }

  // å•†æˆ·åç§°ï¼ˆæ˜ç¡®æåŠå•†æˆ·å+ä¸­æ–‡ï¼‰
  if (!existingData.merchant_name) {
    const mnMatch = t.match(/(?:å•†æˆ·åç§°?|åº—é“ºå|åº—å)[æ˜¯ä¸ºå«ï¼š:]\s*([\u4e00-\u9fa5A-Za-z0-9]{2,20})/)
    if (mnMatch) extracted.merchant_name = mnMatch[1]
  }

  return extracted
}

// ========== æ™ºèƒ½æ¨æ–­å¼•æ“ï¼šæ ¹æ®å·²æœ‰æ•°æ®è‡ªåŠ¨å¡«å……å¯æ¨æ–­çš„å­—æ®µ ==========
const ONLINE_INDUSTRIES = ['æ¸¸æˆ', 'é™ªç©ç¤¾äº¤', 'ç›²ç›’æ½®ç©', 'çŸ¥è¯†ä»˜è´¹', 'å¹¿å‘Šè¥é”€', 'ä¿é™©', 'ç§‘æŠ€', 'è´¢ç¨æœåŠ¡', 'ç”µå•†']
const OFFLINE_INDUSTRIES = ['é¤é¥®', 'ç¾å®¹', 'æ±½è½¦']
const HYBRID_INDUSTRIES = ['é›¶å”®', 'æ•™è‚²', 'å¥åº·', 'ç”Ÿæ´»æœåŠ¡', 'æ—…æ¸¸', 'ç‰©æµ', 'å†œä¸š', 'æˆ¿äº§ç§Ÿèµ', 'ç å®é¥°å“', 'å® ç‰©', 'ç¥¨åŠ¡æ¼”å‡º', 'äºŒæ‰‹äº¤æ˜“']

function inferFieldsFromData(data) {
  const inferred = {}
  const reasons = {}

  // 1. è¡Œä¸š â†’ ç»è¥æ¨¡å¼
  if (data.industry && !data.business_model) {
    const industryText = (data.industry || '').toLowerCase()
    const ind = matchIndustry(industryText)
    const indKey = ind ? ind.key : ''

    // å…ˆçœ‹ç”¨æˆ·åŸå§‹æè¿°ä¸­æœ‰æ²¡æœ‰æ˜ç¡®æåˆ°çº¿ä¸Š/çº¿ä¸‹
    const hasOnlineHint = /å°ç¨‹åº|å…¬ä¼—å·|çº¿ä¸Š|ç½‘ä¸Š|H5|app|ç½‘åº—|æ·˜å®|æ‹¼å¤šå¤š|æŠ–éŸ³|å¿«æ‰‹|ç›´æ’­|å¤–å–å¹³å°/i.test(data.industry + (data._raw_industry || ''))
    const hasOfflineHint = /é—¨åº—|å®ä½“|åº—é“º|çº¿ä¸‹|æ¡£å£|æ‘Šä½|åº—é¢|æŸœå°|å†™å­—æ¥¼|å·¥ä½œå®¤/.test(data.industry + (data._raw_industry || ''))

    if (hasOnlineHint && hasOfflineHint) {
      inferred.business_model = 'çº¿ä¸Š+çº¿ä¸‹ç»“åˆ'
      reasons.business_model = 'æ‚¨æåˆ°äº†çº¿ä¸Šå’Œçº¿ä¸‹ä¸šåŠ¡'
    } else if (hasOfflineHint && !hasOnlineHint) {
      inferred.business_model = 'çº¿ä¸‹é—¨åº—ï¼ˆå®ä½“åº—é“ºï¼‰'
      reasons.business_model = 'æ‚¨æåˆ°äº†å®ä½“ç»è¥'
    } else if (hasOnlineHint) {
      inferred.business_model = 'çº¯çº¿ä¸Šï¼ˆå°ç¨‹åº/å…¬ä¼—å·/H5ï¼‰'
      reasons.business_model = 'æ‚¨æåˆ°äº†çº¿ä¸Šä¸šåŠ¡'
    } else if (ONLINE_INDUSTRIES.includes(indKey)) {
      inferred.business_model = 'çº¯çº¿ä¸Šï¼ˆå°ç¨‹åº/å…¬ä¼—å·/H5ï¼‰'
      reasons.business_model = `${indKey}è¡Œä¸šé€šå¸¸æ˜¯çº¿ä¸Šç»è¥`
    } else if (OFFLINE_INDUSTRIES.includes(indKey)) {
      inferred.business_model = 'çº¿ä¸Š+çº¿ä¸‹ç»“åˆ'
      reasons.business_model = `${indKey}è¡Œä¸šé€šå¸¸çº¿ä¸Šçº¿ä¸‹ç»“åˆ`
    } else if (HYBRID_INDUSTRIES.includes(indKey)) {
      inferred.business_model = 'çº¿ä¸Š+çº¿ä¸‹ç»“åˆ'
      reasons.business_model = `${indKey}è¡Œä¸šé€šå¸¸çº¿ä¸Šçº¿ä¸‹ç»“åˆ`
    }
  }

  // 2. å•†æˆ·åç§° â†” å…¬å¸åç§°ï¼šæ™ºèƒ½äº’å¡«
  if (data.company_name && !data.merchant_name) {
    inferred.merchant_name = data.company_name
    reasons.merchant_name = 'é€šå¸¸ä¸å…¬å¸åç§°ä¸€è‡´'
  }
  if (data.merchant_name && !data.company_name && /å…¬å¸|æœ‰é™|ä¸ªä½“|å•†è¡Œ|å·¥ä½œå®¤|ä¼ä¸š/.test(data.merchant_name)) {
    inferred.company_name = data.merchant_name
    reasons.company_name = 'ä¸å•†æˆ·åç§°ä¸€è‡´'
  }

  // 3. æŠ•è¯‰/é€€æ¬¾/ç”³è¯‰å†å²çš„é»˜è®¤æ¨æ–­ï¼šä¸æ¨æ–­ï¼Œè®©ç”¨æˆ·è‡ªå·±è¯´

  // 4. ä»ç”¨æˆ·æ‰€æœ‰å·²æœ‰æ–‡æœ¬ä¸­æå–æ›´å¤šå­—æ®µï¼ˆæ’é™¤å†…éƒ¨å­—æ®µ_å¼€å¤´ï¼Œé¿å…ä»åŸå§‹è¾“å…¥ä¸­è¯¯æå–ï¼‰
  const allText = Object.entries(data).filter(([k, v]) => typeof v === 'string' && !k.startsWith('_')).map(([, v]) => v).join(' ')
  if (allText.length > 10) {
    const bonus = extractFieldsFromMessage(allText, data)
    for (const [key, value] of Object.entries(bonus)) {
      if (!data[key] && !inferred[key]) {
        inferred[key] = value
        reasons[key] = 'ä»æ‚¨ä¹‹å‰çš„å›ç­”ä¸­è¯†åˆ«åˆ°'
      }
    }
  }

  return { inferred, reasons }
}

// æ‰¾åˆ°ä¸‹ä¸€ä¸ªæœªå¡«å†™çš„å­—æ®µæ­¥éª¤ï¼ˆè·³è¿‡å·²æœ‰æ•°æ®çš„ï¼‰
function findNextUnfilledStep(fromStep, data) {
  for (let i = fromStep; i < TOTAL_STEPS; i++) {
    const key = INFO_FIELDS[i].key
    if (!data[key] || !data[key].trim()) return i
  }
  return TOTAL_STEPS // å…¨éƒ¨å¡«å®Œ
}

// åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æ˜æ˜¾ä¸æ˜¯å›ç­”å½“å‰é—®é¢˜ï¼ˆè€Œæ˜¯å…¶ä»–å­—æ®µçš„æ•°æ®ï¼‰
function isAnswerForDifferentField(msg, currentFieldKey, existingData) {
  const extracted = extractFieldsFromMessage(msg, existingData)
  const extractedKeys = Object.keys(extracted)
  if (extractedKeys.length === 0) return null

  // å¦‚æœæå–åˆ°çš„å­—æ®µåŒ…å«å½“å‰å­—æ®µï¼Œè¯´æ˜ç”¨æˆ·åœ¨å›ç­”å½“å‰é—®é¢˜
  if (extracted[currentFieldKey]) return null

  // å¦‚æœæå–åˆ°çš„æ˜¯å…¶ä»–å­—æ®µï¼Œè¯´æ˜ç”¨æˆ·åœ¨å›ç­”åˆ«çš„é—®é¢˜
  return extracted
}

// å¸¸è§é—®ç­”ï¼ˆæœ¬åœ°å¤„ç†ï¼Œä¸è°ƒ DeepSeekï¼‰
const LOCAL_QA = [
  { patterns: [/å¤šä¹…/, /å¤šé•¿æ—¶é—´/, /å‡ å¤©/, /å‘¨æœŸ/], answer: 'å¾®ä¿¡ç”³è¯‰å®¡æ ¸ä¸€èˆ¬éœ€è¦3-5ä¸ªå·¥ä½œæ—¥ã€‚å¦‚æœææ–™é½å…¨ã€é€»è¾‘æ¸…æ™°ï¼Œéƒ¨åˆ†æ¡ˆä»¶å¯èƒ½æ›´å¿«ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¸®æ‚¨ä¸€æ¬¡æ€§é€šè¿‡ï¼Œå‡å°‘åå¤æäº¤çš„æ—¶é—´æˆæœ¬~' },
  { patterns: [/æˆåŠŸç‡/, /èƒ½æˆåŠŸ/, /æœ‰æŠŠæ¡/, /æ¦‚ç‡/], answer: 'ç”³è¯‰æˆåŠŸç‡å–å†³äºå¤šä¸ªå› ç´ ï¼šå¤„ç½šç±»å‹ã€è¿è§„ä¸¥é‡ç¨‹åº¦ã€ææ–™å®Œæ•´åº¦ã€æ•´æ”¹è¯šæ„ç­‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé¦–æ¬¡ç”³è¯‰ä¸”ææ–™ä¸“ä¸šçš„æƒ…å†µä¸‹ï¼ŒæˆåŠŸç‡åœ¨65%-90%ä¹‹é—´ã€‚æˆ‘ä»¬ä¼šå°½åŠ›ä¸ºæ‚¨å‡†å¤‡æœ€ä¼˜è´¨çš„ææ–™~' },
  { patterns: [/æ”¶è´¹/, /å¤šå°‘é’±/, /ä»·æ ¼/, /è´¹ç”¨/], answer: 'ä¿¡æ¯æ”¶é›†å’Œè¯„ä¼°é˜¶æ®µæ˜¯å…è´¹çš„ã€‚ç”Ÿæˆå®Œæ•´ç”³è¯‰ææ–™åï¼Œæ‚¨å¯ä»¥æ ¹æ®æ¡ˆä»¶å¤æ‚åº¦é€‰æ‹©æ˜¯å¦ä½¿ç”¨æˆ‘ä»¬çš„ä¸“ä¸šæœåŠ¡ã€‚å…ˆè®©æˆ‘äº†è§£æ‚¨çš„æƒ…å†µï¼Œå†ç»™æ‚¨å…·ä½“çš„å»ºè®®~' },
  { patterns: [/æ€ä¹ˆæäº¤/, /åœ¨å“ªé‡Œæäº¤/, /æäº¤ç”³è¯‰/, /ç”³è¯‰å…¥å£/], answer: 'ç”³è¯‰æäº¤æœ‰ä¸¤ç§æ–¹å¼ï¼š\n\nâ‘  å¾®ä¿¡æ”¯ä»˜å•†å®¶åŠ©æ‰‹å°ç¨‹åºï¼ˆæ¨èï¼‰â†’ æˆ‘æ˜¯å•†å®¶ â†’ é£é™©å¤„ç† â†’ åŠŸèƒ½é™åˆ¶è®°å½• â†’ å‘èµ·ç”³è¯‰\nâ‘¡ å•†æˆ·å¹³å°ç½‘é¡µç«¯ pay.weixin.qq.com â†’ è´¦æˆ·ä¸­å¿ƒ â†’ è¿çº¦è®°å½• â†’ æäº¤ç”³è¯‰\n\nç­‰æˆ‘ä»¬æ”¶é›†å®Œä¿¡æ¯ç”Ÿæˆææ–™åï¼Œä¼šæœ‰è¯¦ç»†çš„æäº¤æŒ‡å—~' },
  { patterns: [/95017/, /å®¢æœç”µè¯/, /äººå·¥å®¢æœ/], answer: 'å¾®ä¿¡æ”¯ä»˜å®˜æ–¹å®¢æœç”µè¯æ˜¯95017ï¼Œå·¥ä½œæ—¶é—´9:00-22:00ã€‚ä¸è¿‡ç”µè¯å®¢æœé€šå¸¸åªèƒ½æŸ¥è¯¢çŠ¶æ€ï¼Œæ— æ³•ç›´æ¥è§£å†³ç”³è¯‰é—®é¢˜ã€‚å»ºè®®é€šè¿‡æ­£å¼ç”³è¯‰æ¸ é“æäº¤ä¸“ä¸šææ–™ï¼Œæ•ˆæœæ›´å¥½~' },
  { patterns: [/ä½ æ˜¯è°/, /ä½ æ˜¯æœºå™¨äºº/, /çœŸäºº/, /äººå·¥/], answer: 'æˆ‘æ˜¯AIç”³è¯‰åŠ©æ‰‹ï¼ŒåŸºäºå¤§é‡æˆåŠŸç”³è¯‰æ¡ˆä¾‹è®­ç»ƒï¼Œèƒ½å¤Ÿå¿«é€Ÿæ”¶é›†ä¿¡æ¯å¹¶ç”Ÿæˆä¸“ä¸šçš„ç”³è¯‰ææ–™ã€‚ä¿¡æ¯æ”¶é›†é˜¶æ®µç”±æˆ‘æ¥å¤„ç†ï¼Œæœ€ç»ˆçš„ç”³è¯‰æŠ¥å‘Šä¼šè°ƒç”¨ä¸“ä¸šAIæ¨¡å‹ç”Ÿæˆï¼Œç¡®ä¿ææ–™è´¨é‡~' },
  { patterns: [/éœ€è¦.*ææ–™/, /å‡†å¤‡ä»€ä¹ˆ/, /è¦å¸¦ä»€ä¹ˆ/, /éœ€è¦.*è¯ä»¶/], answer: 'ç”³è¯‰ææ–™é€šå¸¸éœ€è¦å‡†å¤‡ï¼š\n\nâ‘  è¥ä¸šæ‰§ç…§ç…§ç‰‡\nâ‘¡ æ³•äººèº«ä»½è¯æ­£åé¢\nâ‘¢ é—¨åº—/ç»è¥åœºæ‰€ç…§ç‰‡\nâ‘£ å•†å“/æœåŠ¡ç›¸å…³å‡­è¯\nâ‘¤ æ•´æ”¹æªæ–½è¯´æ˜\n\nå…·ä½“ææ–™ä¼šæ ¹æ®æ‚¨çš„è¿è§„ç±»å‹æœ‰æ‰€ä¸åŒï¼Œæˆ‘æ”¶é›†å®Œä¿¡æ¯åä¼šç»™æ‚¨è¯¦ç»†çš„ææ–™æ¸…å•~' },
  { patterns: [/å†»ç»“.*èµ„é‡‘/, /èµ„é‡‘.*å–å‡º/, /é’±.*å–å›/, /æç°/], answer: 'å¦‚æœèµ„é‡‘è¢«å†»ç»“ï¼Œé€šå¸¸éœ€è¦å…ˆå®Œæˆç”³è¯‰è§£é™¤å¤„ç½šï¼Œä¹‹åèµ„é‡‘ä¼šè‡ªåŠ¨è§£å†»è¿”å›å•†æˆ·è´¦æˆ·ã€‚å†»ç»“æœŸä¸€èˆ¬ä¸º180å¤©ï¼Œä½†æˆåŠŸç”³è¯‰åå¯æå‰è§£å†»ã€‚å»ºè®®å°½å¿«å‡†å¤‡ææ–™ç”³è¯‰~' },
  { patterns: [/äºŒæ¬¡ç”³è¯‰/, /é©³å›.*å†/, /å†æ¬¡ç”³è¯‰/, /è¢«æ‹’.*æ€ä¹ˆ/], answer: 'å¦‚æœé¦–æ¬¡ç”³è¯‰è¢«é©³å›ï¼š\n\nâ‘  ä»”ç»†é˜…è¯»é©³å›åŸå› ï¼Œé’ˆå¯¹æ€§è¡¥å……ææ–™\nâ‘¡ å¢åŠ æ›´è¯¦ç»†çš„æ•´æ”¹è¯´æ˜\nâ‘¢ è¡¥å……ç»è¥åˆè§„è¯æ˜ï¼ˆå¦‚è¿›è´§å‡­è¯ã€èµ„è´¨è¯ä¹¦ï¼‰\nâ‘£ ä¸¤æ¬¡ç”³è¯‰é—´éš”å»ºè®®3-5å¤©\n\næˆ‘ä»¬ä¼šåˆ†ææ‚¨çš„é©³å›åŸå› ï¼Œä¼˜åŒ–ç”³è¯‰ææ–™~' },
  { patterns: [/æŠ•è¯‰ç‡/, /æŠ•è¯‰.*å¤„ç†/, /æ€ä¹ˆ.*é™ä½.*æŠ•è¯‰/], answer: 'é™ä½æŠ•è¯‰ç‡çš„å…³é”®æªæ–½ï¼š\n\nâ‘  åŠæ—¶å“åº”ï¼š24å°æ—¶å†…å›å¤æ‰€æœ‰æŠ•è¯‰\nâ‘¡ ä¸»åŠ¨é€€æ¬¾ï¼šå¯¹åˆç†æŠ•è¯‰ä¼˜å…ˆé€€æ¬¾å¤„ç†\nâ‘¢ åå•†æ²Ÿé€šï¼šå¼•å¯¼å®¢æˆ·æ’¤é”€æŠ•è¯‰\nâ‘£ ä¼˜åŒ–æœåŠ¡ï¼šä»æ ¹æºå‡å°‘æŠ•è¯‰äº§ç”Ÿ\n\næŠ•è¯‰ç‡é™è‡³0.01%ä»¥ä¸‹å¯¹ç”³è¯‰æœ€æœ‰åˆ©~' },

  // ===== æ–°å¢QA =====
  { patterns: [/æœ‰æ•‘/, /è¿˜æœ‰å¸Œæœ›/, /èƒ½ä¸èƒ½æ¢å¤/, /è¿˜èƒ½ç”¨/], answer: 'ç»å¤§å¤šæ•°å•†æˆ·å·å¤„ç½šéƒ½æ˜¯å¯ä»¥é€šè¿‡ç”³è¯‰æ¢å¤çš„ï¼å…³é”®åœ¨äºï¼š\n\nâ‘  ææ–™æ˜¯å¦å……åˆ†ä¸“ä¸š\nâ‘¡ æ•´æ”¹æ˜¯å¦åˆ°ä½\nâ‘¢ ç”³è¯‰ç­–ç•¥æ˜¯å¦æ­£ç¡®\n\nå³ä½¿æ˜¯æ”¯ä»˜æƒé™å…³é—­è¿™ç§è¾ƒé‡çš„å¤„ç½šï¼Œåªè¦ææ–™å‡†å¤‡å¾—å½“ï¼Œé¦–æ¬¡ç”³è¯‰æˆåŠŸç‡ä¹Ÿåœ¨65%ä»¥ä¸Šã€‚æˆ‘ä»¬å…ˆæ”¶é›†ä¿¡æ¯è¯„ä¼°æ‚¨çš„å…·ä½“æƒ…å†µ~' },
  { patterns: [/æ‰¾å¾‹å¸ˆ/, /è¦ä¸è¦è¯·å¾‹å¸ˆ/, /æ³•å¾‹/, /å¾‹å¸ˆ/], answer: 'ä¸€èˆ¬çš„å•†æˆ·ç”³è¯‰ä¸éœ€è¦è¯·å¾‹å¸ˆã€‚å¾®ä¿¡æ”¯ä»˜ç”³è¯‰æ˜¯å¹³å°å†…éƒ¨çš„è¡Œæ”¿æµç¨‹ï¼Œå…³é”®æ˜¯æäº¤ç¬¦åˆè¦æ±‚çš„ç”³è¯‰ææ–™å’Œæ•´æ”¹è¯æ˜ã€‚æˆ‘ä»¬çš„AIç³»ç»ŸåŸºäºå¤§é‡æˆåŠŸæ¡ˆä¾‹ï¼Œèƒ½ç”Ÿæˆä¸“ä¸šçº§çš„ç”³è¯‰ææ–™ã€‚\n\nåªæœ‰åœ¨æ¶‰åŠå¤§é¢èµ„é‡‘çº çº·æˆ–æ³•å¾‹è¯‰è®¼æ—¶æ‰éœ€è¦è€ƒè™‘å¾‹å¸ˆ~' },
  { patterns: [/ä»£åŠ/, /æ‰¾äººä»£/, /ä»£ç†ç”³è¯‰/, /å¸®æˆ‘ç”³è¯‰/], answer: 'å¸‚é¢ä¸Šç¡®å®æœ‰ä»£åŠç”³è¯‰çš„æœåŠ¡ï¼Œä½†éœ€æ³¨æ„ï¼š\n\nâ‘  æ­£è§„ä»£åŠé€šå¸¸æ”¶è´¹500-3000å…ƒä¸ç­‰\nâ‘¡ éª—å­å¾ˆå¤šï¼Œæ‰¿è¯º100%æˆåŠŸçš„åŸºæœ¬æ˜¯éª—å­\nâ‘¢ ä»£åŠæœ¬è´¨ä¸Šä¹Ÿæ˜¯å¸®ä½ å‡†å¤‡ææ–™ï¼Œæ ¸å¿ƒè¿˜æ˜¯ææ–™è´¨é‡\n\næˆ‘ä»¬çš„AIç³»ç»Ÿå¯ä»¥å¸®æ‚¨ç”Ÿæˆä¸“ä¸šçš„ç”³è¯‰ææ–™ï¼Œæ‚¨è‡ªå·±æäº¤å³å¯ï¼Œææ–™è´¨é‡ä¸è¾“äººå·¥ä»£åŠ~' },
  { patterns: [/è¡¥å……èµ„æ–™/, /è¡¥å……ææ–™/, /é€šé“.*å¼€æ”¾/, /24å°æ—¶/], answer: 'âš ï¸ é‡è¦æé†’ï¼šå¾®ä¿¡è¡¥å……èµ„æ–™é€šé“é€šå¸¸åªå¼€æ”¾24å°æ—¶ï¼\n\næ”¶åˆ°è¡¥å……èµ„æ–™é€šçŸ¥åè¯·ç«‹å³å‡†å¤‡å¹¶æäº¤ã€‚è¶…æ—¶æœªæäº¤çš„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»´æŒåŸåˆ¤ã€‚\n\nå»ºè®®æå‰å‡†å¤‡å¥½å¸¸ç”¨ææ–™ï¼ˆè¥ä¸šæ‰§ç…§ã€èº«ä»½è¯ç…§ç‰‡ã€é—¨åº—ç…§ç‰‡ç­‰ï¼‰ï¼Œæ”¶åˆ°é€šçŸ¥åç¬¬ä¸€æ—¶é—´ä¸Šä¼ ~' },
  { patterns: [/è®¢å•å·.*å“ª/, /åœ¨å“ª.*è®¢å•å·/, /æ€ä¹ˆæ‰¾.*è®¢å•/, /å¾®ä¿¡.*è®¢å•å·/], answer: 'å¾®ä¿¡æ”¯ä»˜è®¢å•å·æŸ¥æ‰¾æ–¹å¼ï¼š\n\nâ‘  å•†æˆ·å¹³å°ï¼špay.weixin.qq.com â†’ äº¤æ˜“ä¸­å¿ƒ â†’ äº¤æ˜“è´¦å•\nâ‘¡ å•†å®¶åŠ©æ‰‹å°ç¨‹åºï¼šæˆ‘æ˜¯å•†å®¶ â†’ æ”¶æ¬¾è®°å½•\nâ‘¢ æ ¼å¼ï¼šä»¥4å¼€å¤´çš„28ä½æ•°å­—\n\nâš ï¸ æ³¨æ„ï¼šç”³è¯‰è¦å¡«çš„æ˜¯å¾®ä¿¡æ”¯ä»˜è®¢å•å·ï¼Œä¸æ˜¯æ‚¨åº—é“ºç³»ç»Ÿçš„è®¢å•å·ï¼ä¸¤ä¸ªæ˜¯ä¸ä¸€æ ·çš„~' },
  { patterns: [/æ’¤è¯‰/, /æ’¤é”€æŠ•è¯‰/, /æ€ä¹ˆè®©.*æ’¤/, /å®¢æˆ·.*æ’¤/], answer: 'å¼•å¯¼æ¶ˆè´¹è€…æ’¤è¯‰çš„æ–¹æ³•ï¼š\n\nâ‘  ä¸»åŠ¨è”ç³»æ¶ˆè´¹è€…ï¼Œäº†è§£è¯‰æ±‚å¹¶åå•†è§£å†³\nâ‘¡ åŠç†é€€æ¬¾ï¼ˆåŸè·¯å…¨é¢é€€æ¬¾æœ€æœ‰æ•ˆï¼‰\nâ‘¢ é€€æ¬¾åå¼•å¯¼æ¶ˆè´¹è€…æ‰“å¼€å¾®ä¿¡ â†’ æˆ‘ â†’ æ”¯ä»˜ â†’ é’±åŒ… â†’ å¸®åŠ©ä¸­å¿ƒ â†’ äº¤æ˜“æŠ•è¯‰\nâ‘£ åœ¨æŠ•è¯‰è®°å½•ä¸­ç•™è¨€ã€Œå·²è§£å†³ï¼Œæ’¤é”€æŠ•è¯‰ã€\n\nğŸ’¡ æ¶ˆè´¹è€…æ’¤è¯‰å¯¹ç”³è¯‰æˆåŠŸç‡æå‡éå¸¸å¤§ï¼' },
  { patterns: [/ç»“ç®—è´¦æˆ·/, /é“¶è¡Œè´¦æˆ·/, /è´¦æˆ·.*åœ¨å“ªçœ‹/, /å¼€æˆ·.*ä¿¡æ¯/], answer: 'ç»“ç®—è´¦æˆ·ä¿¡æ¯æŸ¥çœ‹è·¯å¾„ï¼š\n\nâ‘  å•†æˆ·å¹³å°ï¼špay.weixin.qq.com â†’ è´¦æˆ·ä¸­å¿ƒ â†’ è´¦æˆ·ä¿¡æ¯\nâ‘¡ å¯ä»¥çœ‹åˆ°å¼€æˆ·é“¶è¡Œã€è´¦æˆ·å·ï¼ˆéƒ¨åˆ†éšè—ï¼‰\n\nğŸ’¡ èµ„é‡‘å†»ç»“æ¡ˆä»¶ç‰¹åˆ«é‡è¦ï¼šæ‹¨æ‰“95017è½¬3æ—¶éœ€è¦æä¾›å•†æˆ·å·+ç»“ç®—è´¦æˆ·åå››ä½è¿›è¡Œèº«ä»½éªŒè¯å’Œå‚¬å®¡~' },
  { patterns: [/èµ„é‡‘.*è§£å†»/, /ä»€ä¹ˆæ—¶å€™.*è§£å†»/, /è§£å†».*å¤šä¹…/, /é’±.*ä»€ä¹ˆæ—¶å€™/], answer: 'èµ„é‡‘è§£å†»æ—¶é—´å–å†³äºæ¡ˆä»¶ç±»å‹ï¼š\n\nâ‘  ç”³è¯‰æˆåŠŸåï¼šé€šå¸¸3-5ä¸ªå·¥ä½œæ—¥å†…èµ„é‡‘è‡ªåŠ¨è§£å†»åˆ°ç»“ç®—è´¦æˆ·\nâ‘¡ æœªç”³è¯‰ï¼šå†»ç»“æœŸä¸€èˆ¬ä¸º180å¤©ï¼Œåˆ°æœŸåè‡ªåŠ¨è§£å†»\nâ‘¢ éƒ¨åˆ†å†»ç»“ï¼šå¯èƒ½åˆ†æ‰¹è§£å†»\n\nå»ºè®®å°½å¿«ç”³è¯‰ï¼ŒæˆåŠŸåå¯å¤§å¹…ç¼©çŸ­ç­‰å¾…æ—¶é—´ã€‚æ‹¨æ‰“95017è½¬3å¯å‚¬ä¿ƒè§£å†»è¿›åº¦~' },
  { patterns: [/è·¨ç±»ç›®/, /ç±»ç›®ä¸ç¬¦/, /ç»è¥èŒƒå›´/, /è¶…èŒƒå›´/], answer: 'è·¨ç±»ç›®ç»è¥ç”³è¯‰è¦ç‚¹ï¼š\n\nâ‘  ç¡®è®¤è¥ä¸šæ‰§ç…§ç»è¥èŒƒå›´æ˜¯å¦åŒ…å«å®é™…ä¸šåŠ¡\nâ‘¡ å¦‚æœåŒ…å«ï¼šæä¾›æ‰§ç…§è¯æ˜å³å¯\nâ‘¢ å¦‚æœä¸åŒ…å«ï¼šå…ˆå»å·¥å•†å˜æ›´ç»è¥èŒƒå›´ï¼Œæ‹¿åˆ°æ–°æ‰§ç…§åå†ç”³è¯‰\nâ‘£ ç«‹å³ä¸‹æ¶æ‰€æœ‰ä¸ç¬¦åˆæ³¨å†Œç±»ç›®çš„å•†å“/æœåŠ¡\nâ‘¤ æäº¤æ•´æ”¹æŠ¥å‘Šè¯´æ˜å·²æ¢³ç†å…¨éƒ¨å•†å“\n\nğŸ’¡ å…ˆæ•´æ”¹ã€å†ç”³è¯‰ï¼Œåˆ‡å‹¿è¾¹å–è¾¹è¯‰~' },
  { patterns: [/å°ç¦/, /æ°¸ä¹…/, /æ³¨é”€/, /å•†æˆ·å·.*æ²¡äº†/], answer: 'å•†æˆ·å·å°ç¦æ˜¯æœ€ä¸¥é‡çš„å¤„ç½šï¼Œä½†ä»æœ‰ç”³è¯‰æœºä¼šï¼š\n\nâ‘  ææ–™è¦æ±‚æœ€é«˜ï¼šéœ€è¦å…¨å¥—è¯ä»¶+è¯¦ç»†ä¸šåŠ¡è¯´æ˜+å……åˆ†æ•´æ”¹è¯æ®\nâ‘¡ å¯èƒ½éœ€è¦æ³•äººè§†é¢‘è®¤è¯\nâ‘¢ å»ºè®®å…ˆå¤„ç†æ‰€æœ‰æŠ•è¯‰ï¼ŒæŠ•è¯‰æ¸…é›¶åå†ç”³è¯‰\nâ‘£ å¦‚æœç”³è¯‰ç¡®å®æ— æ³•é€šè¿‡ï¼Œå¯ä»¥è€ƒè™‘æ³¨é”€åç”¨æ–°ä¸»ä½“é‡æ–°ç”³è¯·å•†æˆ·å·\n\nâš ï¸ æ³¨é”€æ¡ä»¶ï¼šæ— è¿è§„ã€æ— ä½™é¢ã€æ— æŠ•è¯‰ã€30å¤©æ— äº¤æ˜“~' },
  { patterns: [/äº¤æ˜“å¼‚å¸¸/, /é£æ§/, /è¢«é£æ§/, /è§¦å‘é£æ§/], answer: 'äº¤æ˜“å¼‚å¸¸æ˜¯æœ€å¸¸è§çš„å¤„ç½šåŸå› ï¼Œé€šå¸¸ç”±ä»¥ä¸‹åŸå› è§¦å‘ï¼š\n\nâ‘  çŸ­æ—¶é—´äº¤æ˜“é‡æ¿€å¢ï¼ˆæ–°åº—å¼€ä¸šã€åšæ´»åŠ¨ï¼‰\nâ‘¡ å¤§é¢äº¤æ˜“å¼‚å¸¸ï¼ˆå•ç¬”é‡‘é¢è¿‡å¤§ï¼‰\nâ‘¢ äº¤æ˜“æ—¶é—´å¼‚å¸¸ï¼ˆæ·±å¤œå¤§é‡äº¤æ˜“ï¼‰\nâ‘£ å…³è”è´¦æˆ·å¼‚å¸¸\n\nç”³è¯‰å…³é”®ï¼šç”¨æ•°æ®å’Œè¯æ®è§£é‡Šäº¤æ˜“æ³¢åŠ¨çš„åˆç†åŸå› ï¼Œæä¾›çœŸå®è®¢å•å‡­è¯ã€‚è¿™ç±»æ¡ˆä»¶æˆåŠŸç‡è¾ƒé«˜~' },
  { patterns: [/å¤šæ¬¡ç”³è¯‰/, /ç”³è¯‰.*å‡ æ¬¡/, /åå¤.*é©³å›/, /ä¸€ç›´è¢«é©³å›/], answer: 'âš ï¸ é‡è¦è­¦å‘Šï¼šè¿ç»­ç”³è¯‰5æ¬¡ä¸é€šè¿‡ï¼Œå¯èƒ½è¢«ç³»ç»Ÿæ ‡è®°ä¸ºã€Œä¸æ”¯æŒç”³è¯‰ã€ï¼\n\nå¦‚æœå·²è¢«é©³å›å¤šæ¬¡ï¼š\n\nâ‘  å…ˆåœä¸‹æ¥ï¼Œä¸è¦æ€¥ç€å†æäº¤\nâ‘¡ æ‹¨æ‰“95017è½¬3æŸ¥è¯¢å…·ä½“é©³å›åŸå› \nâ‘¢ é’ˆå¯¹æ€§åœ°è¡¥å……é©³å›åŸå› è¦æ±‚çš„ææ–™\nâ‘£ é—´éš”5-7å¤©åå†æäº¤\nâ‘¤ è€ƒè™‘æ¢ä¸€ä¸ªæ›´ä¸“ä¸šçš„æ•´æ”¹æ–¹æ¡ˆ\n\næ¯æ¬¡æäº¤éƒ½è¦ç¡®ä¿æ¯”ä¸Šæ¬¡æ›´å®Œå–„ï¼' },
  { patterns: [/å•†å®¶åŠ©æ‰‹/, /å°ç¨‹åº.*å…¥å£/, /æ€ä¹ˆ.*ç™»å½•/, /å•†æˆ·å¹³å°/], answer: 'å¾®ä¿¡æ”¯ä»˜å•†æˆ·ç›¸å…³å…¥å£ï¼š\n\nâ‘  å•†å®¶åŠ©æ‰‹å°ç¨‹åºï¼šå¾®ä¿¡æœç´¢ã€Œå¾®ä¿¡æ”¯ä»˜å•†å®¶åŠ©æ‰‹ã€\nâ‘¡ å•†æˆ·å¹³å°ç½‘é¡µï¼špay.weixin.qq.com\nâ‘¢ ç”³è¯‰å…¥å£ï¼šå•†å®¶åŠ©æ‰‹ â†’ æˆ‘æ˜¯å•†å®¶ â†’ é£é™©å¤„ç† â†’ ç”³è¯‰ä¸­å¿ƒ\nâ‘£ è¿è§„è®°å½•ï¼šå•†å®¶åŠ©æ‰‹ â†’ é£é™©å¤„ç† â†’ åŠŸèƒ½é™åˆ¶è®°å½•/è¿çº¦å¤„ç†è®°å½•\n\nğŸ’¡ å»ºè®®ç”¨æ³•äººå¾®ä¿¡ç™»å½•ï¼Œæƒé™æœ€å…¨~' },
  { patterns: [/å›è®¿/, /ç”µè¯å›è®¿/, /å¾®ä¿¡.*æ‰“ç”µè¯/, /ä¼šä¸ä¼š.*è”ç³»/], answer: 'å¾®ä¿¡å®¡æ ¸å›¢é˜Ÿåœ¨å®¡æ ¸è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¿›è¡Œç”µè¯å›è®¿ï¼š\n\nâ‘  ä¸€èˆ¬åœ¨æäº¤ç”³è¯‰å1-3ä¸ªå·¥ä½œæ—¥å†…\nâ‘¡ ä¼šæ ¸å®å•†æˆ·åŸºæœ¬ä¿¡æ¯ã€ç»è¥æƒ…å†µã€æ•´æ”¹æªæ–½\nâ‘¢ åŠ¡å¿…ä¿æŒç”µè¯ç•…é€šï¼Œé”™è¿‡å›è®¿å¯èƒ½ç›´æ¥å¯¼è‡´ç”³è¯‰å¤±è´¥\nâ‘£ å›è®¿æ—¶æ€åº¦è¦é…åˆã€è¯šæ³ï¼Œå›ç­”ä¸æäº¤ææ–™ä¸€è‡´\n\nğŸ’¡ å»ºè®®å¡«å†™æ—¥å¸¸ä½¿ç”¨çš„æ‰‹æœºå·ï¼Œç¡®ä¿èƒ½æ¥å¬~' },
  { patterns: [/äº¤æ˜“å°ç¥¨/, /äº¤æ˜“å‡­è¯/, /ä»€ä¹ˆ.*å‡­è¯/, /å‡­è¯.*è¦æ±‚/], answer: 'äº¤æ˜“å‡­è¯è¦æ±‚ï¼š\n\nâ‘  æœºæ‰“å°ç¥¨/ç”µå­è®¢å•ï¼ˆä¸æ¥å—æ‰‹å†™å•æ®ï¼‰\nâ‘¡ éœ€åŒ…å«ï¼šäº¤æ˜“æ—¶é—´ã€é‡‘é¢ã€å•†å“åç§°\nâ‘¢ å°ç¥¨ä¸Šçš„è®¢å•å·å¿…é¡»èƒ½åœ¨åå°æŸ¥åˆ°ä¸”ä¸ºæˆåŠŸäº¤æ˜“\nâ‘£ è‡³å°‘æä¾›3ç¬”ä»¥ä¸Šä¸åŒæ—¶é—´çš„äº¤æ˜“å‡­è¯\nâ‘¤ çº¿ä¸Šè®¢å•ï¼šæä¾›è®¢å•è¯¦æƒ…æˆªå›¾+å‘è´§/ç‰©æµæˆªå›¾\nâ‘¥ çº¿ä¸‹è®¢å•ï¼šæä¾›POSå°ç¥¨+å•†å“ç…§ç‰‡\n\nâš ï¸ ç…§ç‰‡å¿…é¡»æ¸…æ™°å¯è¾¨ï¼' },
  { patterns: [/æ‹ç…§/, /ç…§ç‰‡.*è¦æ±‚/, /å›¾ç‰‡.*æ¸…æ™°/, /è¯ä»¶ç…§/], answer: 'ç”³è¯‰ç…§ç‰‡æ‹æ‘„è¦æ±‚ï¼š\n\nâ‘  è¯ä»¶ç±»ï¼šæ­£é¢æ‹æ‘„ï¼Œå››è§’å®Œæ•´ï¼Œæ–‡å­—æ¸…æ™°å¯è¾¨\nâ‘¡ é—¨åº—ç…§ï¼šé—¨å¤´è¦åŒ…å«åº—åï¼Œå†…æ™¯è¦ä½“ç°ç»è¥èŒƒå›´\nâ‘¢ æ‰‹æŒè¯ä»¶ï¼šæ³•äººæ‰‹æŒèº«ä»½è¯ï¼Œé¢éƒ¨å’Œè¯ä»¶éƒ½è¦æ¸…æ™°\nâ‘£ æ ¼å¼ï¼šJPG/PNGï¼Œå»ºè®®æ¯å¼ 2MBä»¥å†…\nâ‘¤ ç¦æ­¢På›¾ï¼šä¸è¦ç¾åŒ–ã€è£å‰ªæˆ–æ·»åŠ æ°´å°\n\nğŸ’¡ è‡ªç„¶å…‰ä¸‹æ‹æ‘„æ•ˆæœæœ€å¥½ï¼Œé¿å…åå…‰å’Œé˜´å½±~' },
  { patterns: [/åˆ†é”€/, /ä¸€çº§åˆ†é”€/, /äºŒçº§åˆ†é”€/, /åˆ†ä½£/], answer: 'å¾®ä¿¡å¯¹åˆ†é”€æ¨¡å¼çš„è§„å®šï¼š\n\nâ‘  åªå…è®¸ä¸€çº§åˆ†é”€ï¼ˆåªæœ‰ç›´æ¥æ¨èäººè·å¾—ä½£é‡‘ï¼‰\nâ‘¡ ç¦æ­¢å¤šçº§åˆ†é”€ï¼ˆAæ¨èBï¼ŒBæ¨èCï¼ŒAä¸èƒ½ä»Cè·åˆ©ï¼‰\nâ‘¢ ç¦æ­¢å…¥é—¨è´¹ï¼ˆä¸èƒ½è¦æ±‚ç¼´è´¹æ‰èƒ½æˆä¸ºåˆ†é”€å‘˜ï¼‰\nâ‘£ ç¦æ­¢å›¤è´§è¦æ±‚\n\nå¦‚æœè¢«åˆ¤å®šä¸ºå¤šçº§åˆ†é”€ï¼Œéœ€è¦æä¾›åˆ†é”€åå°æˆªå›¾è¯æ˜ä»…ä¸€çº§ã€æäº¤åˆ†é”€è§„åˆ™æ–‡æ¡£ã€æ•´æ”¹å¹¶å…³é—­å¤šçº§ä½£é‡‘åŠŸèƒ½~' },
]

// æ£€æµ‹æ˜¯å¦æ˜¯"ä¸ºä»€ä¹ˆ"ç±»é—®é¢˜
function isWhyQuestion(text) {
  const t = text.trim().toLowerCase()
  return WHY_PATTERNS.some(p => p.test(t))
}

// æ£€æµ‹æ˜¯å¦æ˜¯å¸¸è§é—®ç­”
function matchLocalQA(text) {
  const t = text.trim().toLowerCase()
  for (const qa of LOCAL_QA) {
    if (qa.patterns.some(p => p.test(t))) return qa.answer
  }
  return null
}

// æ£€æµ‹æ˜¯å¦æ˜¯"æ²¡æœ‰/ä¸çŸ¥é“/æ— "ç±»ç®€çŸ­å›ç­”ï¼ˆè¿™æ˜¯æœ‰æ•ˆå›ç­”ï¼Œä¸æ˜¯æé—®ï¼‰
function isNegativeAnswer(text) {
  const t = text.trim()
  // ç²¾ç¡®åŒ¹é…çŸ­å¦å®š
  if (/^(æ²¡æœ‰|æ²¡|æ— |ä¸çŸ¥é“|ä¸æ¸…æ¥š|ä¸ç¡®å®š|ä¸äº†è§£|æš‚æ— |ä¸å¤ªæ¸…æ¥š|0|æš‚æ—¶æ²¡æœ‰|ç›®å‰æ²¡æœ‰|è¿˜æ²¡æœ‰|åº”è¯¥æ²¡æœ‰|ä»€ä¹ˆéƒ½æ²¡|æ²¡ä»€ä¹ˆ|ä¸å¤ªç¡®å®š|å¿˜äº†|å¿˜è®°äº†|æ²¡æœ‰è¿‡|ä»æ¥æ²¡|æœª|å¦|ç¬¬ä¸€æ¬¡|é¦–æ¬¡|N\/A|NA|æ— æ³•æä¾›)$/i.test(t)) return true
  if (/^æ²¡(æœ‰|ä»€ä¹ˆ)/.test(t) && t.length <= 6) return true
  if (/^ä¸çŸ¥é“[ï¼Œ,ã€‚\s]/.test(t)) return true
  if (/^ä¸æ¸…æ¥š[ï¼Œ,ã€‚\s]/.test(t)) return true
  // æ‰©å±•ï¼šè¾ƒé•¿çš„å¦å®š/æ— æ³•æä¾›è¡¨è¾¾
  if (/^(æˆ‘æ²¡æœ‰|æ²¡æœ‰è¿™[äº›ä¸ª]|æ‹¿ä¸åˆ°|æ‰¾ä¸åˆ°|æ²¡æ³•æä¾›|æä¾›ä¸äº†|ç»™ä¸äº†|æˆ‘ä¸çŸ¥é“|æˆ‘ä¸æ¸…æ¥š|æ²¡åŠæ³•æä¾›|æŸ¥ä¸åˆ°|çœ‹ä¸åˆ°|ç™»ä¸ä¸Š|è¿›ä¸å»)[å•Šå‘¢å§äº†å“¦å“ˆ~ï¼!ã€‚.ï¼Œ,]*$/i.test(t)) return true
  return false
}

// æ£€æµ‹"ç¨å/å»¶è¿Ÿ"ç±»å›ç­”ï¼ˆç”¨æˆ·æš‚æ—¶æ²¡æœ‰è¿™ä¸ªä¿¡æ¯ï¼Œä¸åº”å­˜ä¸ºå­—é¢å€¼ï¼‰
function isDeferAnswer(text) {
  const t = text.trim()
  if (/^.{0,6}(æ™šç‚¹|ç¨å|å›å¤´|ç­‰ä¸‹|å¾…ä¼š|ä¸€ä¼š|ç­‰ä¸€ä¸‹|è¿‡å|ä¹‹å|ä»¥å|ä¸‹æ¬¡).{0,6}(å‘Šè¯‰|ç»™|è¯´|å‘|æä¾›|è¡¥å……|å†è¯´|å†ç»™|å†å‘)/.test(t)) return true
  if (/^.{0,4}(å¿˜äº†|å¿˜è®°äº†|è®°ä¸ä½|è®°ä¸æ¸…|è®°ä¸å¾—|æƒ³ä¸èµ·).{0,10}(å‘Šè¯‰|ç»™|è¯´|å‘|è¡¥|$)/.test(t)) return true
  if (/^(è¿˜æ²¡|æš‚æ—¶æ²¡|æ‰‹å¤´æ²¡|æ‰‹ä¸Šæ²¡|ç°åœ¨æ²¡).{0,6}(æ‰¾åˆ°|æ‹¿åˆ°|æŸ¥åˆ°|çœ‹åˆ°|æœ‰)/.test(t)) return true
  if (/^(æˆ‘[å»æ‰¾æŸ¥çœ‹ç¿»]ä¸€ä¸‹|æˆ‘å…ˆ[æ‰¾æŸ¥çœ‹ç¿»]|å®¹æˆ‘|è®©æˆ‘|æˆ‘å¾—).{0,8}(æ‰¾|æŸ¥|çœ‹|ç¿»|ç¡®è®¤)/.test(t)) return true
  if (/^(ä¸åœ¨èº«è¾¹|ä¸åœ¨æ‰‹è¾¹|æ²¡å¸¦|æ²¡åœ¨|ä¸åœ¨è¿™)/.test(t)) return true
  return false
}

// æ£€æµ‹æ¨¡ç³Š/åæ§½/éå›ç­”ç±»å†…å®¹ï¼ˆç”¨æˆ·åœ¨å‘ç‰¢éªšæˆ–è¯´åºŸè¯ï¼Œä¸æ˜¯åœ¨å›ç­”é—®é¢˜ï¼‰
function isVagueNonAnswer(text, fieldKey) {
  const t = text.trim()
  // æ˜æ˜¾çš„åæ§½/æŠ±æ€¨ï¼ˆä¸æ˜¯åœ¨å›ç­”é—®é¢˜ï¼‰
  if (/^(å·²ç»|éƒ½).{0,4}(å‡ºæ¥|é—®|è¯´|å¡«|å›ç­”|ç»™).{0,4}(äº†|è¿‡).{0,6}(å¾ˆå¤š|ä¸å°‘|å¥½å¤š|å¤ªå¤š|å¤Ÿå¤š)/.test(t)) return true
  if (/^(é—®é¢˜.*å¤ªå¤š|å¤ªå¤š.*é—®é¢˜|æ€ä¹ˆè¿™ä¹ˆå¤š|è¿˜æœ‰å¤šå°‘|è¿˜è¦é—®å¤šå°‘|æ²¡å®Œæ²¡äº†|çƒ¦æ­»|å¥½çƒ¦|å¥½ç´¯|ä¸æƒ³å¡«äº†|ä¸æƒ³å›ç­”äº†)/.test(t)) return true
  // æ•·è¡å›ç­”ï¼ˆå¯¹äºéœ€è¦å…·ä½“ä¿¡æ¯çš„å­—æ®µï¼‰
  const detailFields = new Set(['refund_policy', 'complaint_status', 'violation_reason', 'business_model'])
  if (detailFields.has(fieldKey)) {
    if (/^(å·®ä¸å¤š|å¤§æ¦‚å§|å°±é‚£æ ·|ä¸€èˆ¬èˆ¬|è¿˜è¡Œ|è¿˜å¥½|æ­£å¸¸|æ™®é€š|ä¸€èˆ¬|å°±è¿™æ ·|æ²¡ä»€ä¹ˆç‰¹åˆ«|éƒ½æœ‰|éƒ½è¡Œ|éšä¾¿|ä½ çœ‹ç€åŠ)$/.test(t)) return true
  }
  return false
}

// æ£€æµ‹æ‹’ç»/å›é¿å‹å›ç­”ï¼ˆå¦‚"è¿™ä¸ªä¸ç”¨å’Œä½ è¯´å§""ä¸å‘Šè¯‰ä½ "ï¼‰
function isRefusalAnswer(text) {
  const t = text.trim()
  if (/ä¸ç”¨.{0,4}(è¯´|å‘Šè¯‰|æä¾›|ç»™)|ä¸æƒ³.{0,4}(è¯´|å‘Šè¯‰|æä¾›|ç»™)|ä¸æ–¹ä¾¿.{0,4}(è¯´|å‘Šè¯‰|æä¾›)|è·Ÿä½ æ²¡å…³ç³»|ä¸ä½ æ— å…³|å‡­ä»€ä¹ˆå‘Šè¯‰|å¹²å˜›å‘Šè¯‰|ä½ ç®¡ä¸ç€|ä¸å…³ä½ äº‹|ç®¡å¥½ä½ è‡ªå·±|åˆ«ç®¡/.test(t)) return true
  if (/^(ä¸ç”¨äº†|ä¸ç”¨|ä¸ç»™|ä¸è¯´|ä¸å¡«|è·³è¿‡|pass|skip)$/i.test(t)) return true
  return false
}

// æ™ºèƒ½å»é™¤å¸¦æƒ…ç»ª/ä¸è€çƒ¦çš„å‰ç¼€ï¼Œæå–å®é™…æ•°æ®ï¼ˆå¦‚"ç»™ä½ äº†1409570162"â†’"1409570162"ï¼‰
function stripFrustrationPrefix(text) {
  const t = text.trim()
  const m = t.match(/^(ç»™ä½ äº†|å‘Šè¯‰ä½ äº†|å‘Šè¯‰ä½ |ç»™ä½ |éƒ½è¯´äº†|æˆ‘è¯´äº†|å‰é¢è¯´äº†|å·²ç»è¯´äº†|åˆšæ‰è¯´äº†|è¯´è¿‡äº†|è·Ÿä½ è¯´äº†|ä¸æ˜¯è¯´äº†å—|ä¸æ˜¯è¯´äº†|è¯´äº†æ˜¯|è¯´äº†å‘€|å°±æ˜¯|å°±)[\uff0c,\s]*/)
  if (m) {
    const cleaned = t.slice(m[0].length).trim()
    if (cleaned.length > 0) return cleaned
  }
  return t
}

// æ£€æµ‹æ˜¯å¦æ˜¯ä¸å½“å‰æ”¶é›†æ— å…³çš„é—²èŠ/æé—®ï¼ˆè€Œéå›ç­”é—®é¢˜ï¼‰
function isQuestion(text) {
  const t = text.trim()
  // çŸ­çš„å¦å®šå›ç­”ä¸æ˜¯æé—®
  if (isNegativeAnswer(t)) return false
  // æ˜ç¡®çš„é—®å¥æ ‡ç‚¹
  if (t.endsWith('?') || t.endsWith('ï¼Ÿ')) return true
  // ä¸­æ–‡ç–‘é—®è¯­æ°”è¯ç»“å°¾ï¼ˆå—/å‘¢/å˜›/ä¹ˆ/å§ â€” æ’é™¤"æ²¡æœ‰å—"è¿™ç±»å¦å®šå¥å¼è¢«è¯¯åˆ¤ï¼‰
  if (/[å—å‘¢å˜›ä¹ˆ]$/.test(t) && !/^(æ²¡|ä¸|æ— )/.test(t)) return true
  // ä»¥ç–‘é—®è¯å¼€å¤´ä¸”ä¸åƒæ˜¯åœ¨å›ç­”é—®é¢˜ï¼ˆæ’é™¤"ä»€ä¹ˆéƒ½æ²¡æœ‰"è¿™ç±»ï¼‰
  if (/^(è¯·é—®|æˆ‘æƒ³é—®|é—®ä¸€ä¸‹|èƒ½ä¸èƒ½å‘Šè¯‰æˆ‘|å¯ä»¥å¸®æˆ‘|æ€ä¹ˆ|å¦‚ä½•|å“ªé‡Œ|ä¸ºä»€ä¹ˆ|å‡­ä»€ä¹ˆ|åˆ°åº•)/.test(t)) return true
  return false
}

// æ£€æµ‹æ¶ˆæ¯æ˜¯å¦æ˜¯ç”¨æˆ·å¯¹AIæœ¬èº«è¯´è¯ï¼ˆè€Œéåœ¨å›ç­”ä¸šåŠ¡é—®é¢˜ï¼‰
// ä¾‹å¦‚ï¼š"ä½ æ˜¯é‚£ä¸ªæ¨¡å‹å—"ã€"ä½ åˆ°åº•æ‡‚ä¸æ‡‚"ã€"ä½ æ€ä¹ˆè¿™ä¹ˆç¬¨"ã€"è®¤çœŸæ€è€ƒ"ç­‰
function isDirectedAtAI(text) {
  const t = text.trim()
  // ä»¥"ä½ "å¼€å¤´ + å¯¹AIçš„è´¨ç–‘/æŠ±æ€¨/æé—®/å‘½ä»¤
  if (/^ä½ (æ˜¯|åˆ°åº•|æ€ä¹ˆ|æ²¡æ³•|è¿˜æ˜¯|èƒ½ä¸èƒ½|å¯ä»¥|åœ¨è¯´|åœ¨å¹²|åœ¨åš|å–œæ¬¢|æœ‰æ²¡æœ‰|çŸ¥é“|ç†è§£|æ˜ç™½|å¬æ‡‚|çœ‹æ‡‚|è§‰å¾—|è®¤ä¸º|æƒ³|è¯´|ç»™æˆ‘|å¸®æˆ‘|å‘Šè¯‰|å›ç­”)/.test(t)) {
    // æ’é™¤ç”¨æˆ·åœ¨å›ç­”é—®é¢˜æ—¶ä»¥"ä½ "å¼€å¤´çš„åˆç†æƒ…å†µï¼ˆå¦‚ "ä½ ä»¬å…¬å¸å«XX"ã€"ä½ è¯´çš„é‚£ä¸ªæ˜¯XXX"ï¼‰
    if (/^ä½ (ä»¬|çš„|è¯´çš„|æåˆ°çš„|é—®çš„)(å…¬å¸|å•†æˆ·|åº—|è¡Œä¸š|ä¸šåŠ¡|äº§å“|æœåŠ¡)/.test(t)) return false
    return true
  }
  // éª‚AI / å¯¹AIä¸æ»¡
  if (/^(ç¬¨|å‚»|è ¢|åºŸç‰©|åƒåœ¾|ç™½ç—´|æ™ºéšœ|æœ‰ç—…|è„‘æ®‹|ä»€ä¹ˆç©æ„|ä»€ä¹ˆä¸œè¥¿|æä»€ä¹ˆ|å¹²ä»€ä¹ˆ|è¯´ä»€ä¹ˆ)/.test(t)) return true
  // å‘½ä»¤AI / å¯¹AIçš„æŒ‡ä»¤ï¼ˆä¸æ˜¯å›ç­”é—®é¢˜ï¼‰
  if (/^(è®¤çœŸ|ä»”ç»†|å¥½å¥½|ç”¨å¿ƒ|åŠ¨è„‘|å†æƒ³|é‡æ–°)(æ€è€ƒ|æƒ³æƒ³|æƒ³ä¸€æƒ³|å¬|çœ‹|åˆ†æ|å›ç­”|ç†è§£)/.test(t)) return true
  // é—®AIèº«ä»½ / èƒ½åŠ›ï¼ˆå¼€å¤´åŒ¹é…ï¼‰
  if (/^(ä½ æ˜¯|è¿™æ˜¯|é‚£ä¸ª)(ä»€ä¹ˆ|å•¥|å“ªä¸ª|è°|AI|äººå·¥æ™ºèƒ½|æœºå™¨äºº|æ¨¡å‹|GPT|DeepSeek|ç¨‹åº|ç³»ç»Ÿ)/i.test(t)) return true
  // æ¶ˆæ¯ä»»æ„ä½ç½®åŒ…å«é—®AIèº«ä»½ï¼ˆè¦†ç›–"ä½ å¥½ ä½ æ˜¯é‚£ä¸ªæ¨¡å‹"ã€"è¯·é—®ä½ æ˜¯AIå—"ç­‰å¤åˆæ¶ˆæ¯ï¼‰
  if (t.length < 40 && /ä½ æ˜¯.{0,4}(ä»€ä¹ˆ|å•¥|è°|AI|äººå·¥æ™ºèƒ½|æœºå™¨äºº|æ¨¡å‹|GPT|DeepSeek|ç¨‹åº|ç³»ç»Ÿ|å“ªä¸ªæ¨¡å‹|é‚£ä¸ªæ¨¡å‹)/i.test(t)) return true
  // çŸ­æ¶ˆæ¯+æ˜æ˜¾ä¸æ˜¯æ•°æ®ï¼ˆçº¯ç²¹åœ¨è·ŸAIèŠå¤©ï¼‰
  if (t.length < 20 && /ä½ (æ‡‚|ç¬¨|è ¢|å‚»|è¡Œä¸è¡Œ|èƒ½ä¸èƒ½|ä¼šä¸ä¼š|æœ‰?ç—…|çƒ¦ä¸çƒ¦|å¥½çƒ¦|å¤ªè ¢|å¤ªç¬¨|å¤ªå‚»|è„‘å­|æ™ºå•†|æ°´å¹³|ä»€ä¹ˆéƒ½ä¸|å•¥éƒ½ä¸)/.test(t)) return true
  // "æˆ‘åœ¨é—®ä½ XX" / "æˆ‘è¯´çš„æ˜¯XX" ç±»çº æ­£AIçš„è¯
  if (/^æˆ‘(åœ¨|æ˜¯)(é—®|è¯´|å‘Šè¯‰|è·Ÿ)(ä½ |AI)/.test(t)) return true
  // çº¯é—®å€™/æ‰“æ‹›å‘¼ï¼ˆä»»ä½•å­—æ®µä¸‹éƒ½ä¸æ˜¯æœ‰æ•ˆç­”æ¡ˆï¼‰
  if (/^(ä½ å¥½|æ‚¨å¥½|hello|hi|å—¨|å“ˆå–½|åœ¨å—|åœ¨ä¸åœ¨|å–‚)[ï¼!~ã€‚.ï¼Œ,\s]*$/i.test(t)) return true
  // åŒ…å«é—®å€™ä½†ä¸å«ä»»ä½•ä¸šåŠ¡å…³é”®è¯ â†’ é—²èŠï¼ˆè¦†ç›–"ä½ å¥½ ä½ æ˜¯é‚£ä¸ªæ¨¡å‹"ã€"hi åœ¨å—"ç­‰ï¼‰
  if (t.length < 30 && /ä½ å¥½|æ‚¨å¥½|hello|hi|å—¨|å“ˆå–½/i.test(t) && !/åš|å–|ç»è¥|ä¸šåŠ¡|è¡Œä¸š|å•†æˆ·|åº—|å…¬å¸|æœåŠ¡|äº§å“|å¤–å–|é›¶å”®|é¤é¥®|æ•™è‚²|æ¸¸æˆ|è½¯ä»¶|ç§‘æŠ€|åŒ»ç–—|é‡‘è/.test(t)) return true
  return false
}

// ========== è¾“å…¥æ ‡å‡†åŒ–ï¼šå°†ç”¨æˆ·æ¨¡ç³Šè¾“å…¥æ˜ å°„ä¸ºæ ‡å‡†å€¼ ==========
const PROBLEM_TYPE_MAP = {
  '1': 'äº¤æ˜“æ‹¦æˆª', 'äº¤æ˜“æ‹¦æˆª': 'äº¤æ˜“æ‹¦æˆª', 'æ‹¦æˆª': 'äº¤æ˜“æ‹¦æˆª', 'ä»˜æ¬¾å¼‚å¸¸': 'äº¤æ˜“æ‹¦æˆª', 'æ”¯ä»˜å¼‚å¸¸': 'äº¤æ˜“æ‹¦æˆª', 'æ— æ³•ä»˜æ¬¾': 'äº¤æ˜“æ‹¦æˆª',
  '2': 'æ”¶æ¬¾é™é¢', 'æ”¶æ¬¾é™é¢': 'æ”¶æ¬¾é™é¢', 'é™é¢': 'æ”¶æ¬¾é™é¢', 'é¢åº¦': 'æ”¶æ¬¾é™é¢', 'é™åˆ¶': 'æ”¶æ¬¾é™é¢', 'é¢åº¦é™åˆ¶': 'æ”¶æ¬¾é™é¢', 'æ”¶æ¬¾å—é™': 'æ”¶æ¬¾é™é¢',
  '3': 'æ”¯ä»˜æƒé™å…³é—­', 'æ”¯ä»˜æƒé™å…³é—­': 'æ”¯ä»˜æƒé™å…³é—­', 'æƒé™å…³é—­': 'æ”¯ä»˜æƒé™å…³é—­', 'å…³é—­': 'æ”¯ä»˜æƒé™å…³é—­', 'æ— æ³•æ”¶æ¬¾': 'æ”¯ä»˜æƒé™å…³é—­', 'ä¸èƒ½æ”¶æ¬¾': 'æ”¯ä»˜æƒé™å…³é—­', 'æ”¶æ¬¾å…³é—­': 'æ”¯ä»˜æƒé™å…³é—­', 'è¢«å…³äº†': 'æ”¯ä»˜æƒé™å…³é—­', 'è¢«å…³é—­': 'æ”¯ä»˜æƒé™å…³é—­', 'æ”¶æ¬¾è¢«å…³': 'æ”¯ä»˜æƒé™å…³é—­', 'æ²¡æ³•æ”¶æ¬¾': 'æ”¯ä»˜æƒé™å…³é—­',
  '4': 'èµ„é‡‘å†»ç»“', 'èµ„é‡‘å†»ç»“': 'èµ„é‡‘å†»ç»“', 'å†»ç»“': 'èµ„é‡‘å†»ç»“', 'å»¶è¿Ÿç»“ç®—': 'èµ„é‡‘å†»ç»“', 'é’±è¢«å†»äº†': 'èµ„é‡‘å†»ç»“', 'é’±å†»äº†': 'èµ„é‡‘å†»ç»“', 'å†»ç»“èµ„é‡‘': 'èµ„é‡‘å†»ç»“', 'é’±å–ä¸å‡ºæ¥': 'èµ„é‡‘å†»ç»“', 'æä¸äº†ç°': 'èµ„é‡‘å†»ç»“', 'è¢«å†»äº†': 'èµ„é‡‘å†»ç»“', 'è¢«å†»ç»“': 'èµ„é‡‘å†»ç»“', 'èµ„é‡‘è¢«å†»': 'èµ„é‡‘å†»ç»“',
  '5': 'å•†æˆ·å·å°ç¦', 'å•†æˆ·å·å°ç¦': 'å•†æˆ·å·å°ç¦', 'å°ç¦': 'å•†æˆ·å·å°ç¦', 'å°å·': 'å•†æˆ·å·å°ç¦', 'è¢«å°': 'å•†æˆ·å·å°ç¦', 'è¢«å°äº†': 'å•†æˆ·å·å°ç¦', 'å·å°äº†': 'å•†æˆ·å·å°ç¦', 'æ°¸ä¹…å°ç¦': 'å•†æˆ·å·å°ç¦', 'å·è¢«å°': 'å•†æˆ·å·å°ç¦',
}

// æ ‡å‡†åŒ–å¤„ç½šç±»å‹
function normalizeProblemType(text) {
  const t = text.trim().toLowerCase()
  // ç›´æ¥åŒ¹é…ï¼ˆå®Œå…¨ç›¸ç­‰ï¼‰
  if (PROBLEM_TYPE_MAP[t]) return PROBLEM_TYPE_MAP[t]
  // å•å­—ç¬¦æ•°å­—é”®åªåŒ¹é…çº¯æ•°å­—è¾“å…¥ï¼ˆé˜²æ­¢ "æœˆæµæ°´50000" åŒ¹é… '5' â†’ å•†æˆ·å·å°ç¦ï¼‰
  if (/^\d$/.test(t) && PROBLEM_TYPE_MAP[t]) return PROBLEM_TYPE_MAP[t]
  // æ¨¡ç³ŠåŒ¹é…ï¼šåªç”¨ â‰¥2å­—ç¬¦ çš„å…³é”®è¯åšå­ä¸²åŒ¹é…
  for (const [key, val] of Object.entries(PROBLEM_TYPE_MAP)) {
    if (key.length >= 2 && t.includes(key)) return val
  }
  return null
}

// ========== è·‘é¢˜/æ— å…³è¾“å…¥æ£€æµ‹ï¼šç”¨æˆ·è¯´çš„æ˜æ˜¾ä¸æ˜¯åœ¨å›ç­”å½“å‰é—®é¢˜ ==========
function isOffTopicInput(text, fieldKey) {
  const t = text.trim()
  // æ•°å­—å‹å­—æ®µï¼šçº¯æ•°å­—è¾“å…¥æ°¸è¿œä¸æ˜¯è·‘é¢˜
  if (NUMERIC_FIELDS.has(fieldKey) && /^\d+$/.test(t)) return false
  // ç”¨æˆ·åœ¨è¯·æ±‚AIåšäº‹ï¼ˆå†™ä»£ç ã€å†™æ–‡ç« ã€ç¿»è¯‘ç­‰ï¼‰è€Œéå›ç­”é—®é¢˜
  if (/^(è¯·|å¸®æˆ‘|å¸®å¿™|éº»çƒ¦|èƒ½ä¸èƒ½|å¯ä»¥|ä½ èƒ½|èƒ½å¦|è¯·å¸®|è¯·ç»™|æˆ‘æƒ³è®©ä½ |ä½ å¸®æˆ‘)(å†™|åš|ç”Ÿæˆ|ç¿»è¯‘|ç”»|è®¾è®¡|å¼€å‘|ç¼–|æ|å¼„|åˆ›å»º|åˆ¶ä½œ)/.test(t)) return true
  // æ˜æ˜¾çš„é—²èŠ/æµ‹è¯•ï¼ˆæ’é™¤çº¯æ•°å­—ï¼Œé¿å…è¯¯æ€èº«ä»½è¯åå››ä½ç­‰ï¼‰
  if (/^(æµ‹è¯•|test|abc|å“ˆå“ˆå“ˆ|å•¦å•¦å•¦|å˜»å˜»|æ— èŠ|æ²¡äº‹)/i.test(t) && t.length < 15) return true
  // ä¸å½“å‰é—®é¢˜å®Œå…¨æ— å…³çš„æŠ€æœ¯è¯·æ±‚
  if (/å†™.*ä»£ç |å†™.*ç¨‹åº|HTML|CSS|JavaScript|Python|Java|ä»£ç |ç¼–ç¨‹|å¼€å‘.*ç½‘ç«™|å¼€å‘.*app/i.test(t) && fieldKey !== 'industry') return true
  if (/å†™.*ä»£ç |å†™.*ç¨‹åº|HTML|CSS|JavaScript|Python|Java\b/i.test(t) && fieldKey === 'industry') return true
  return false
}

// ========== æ— æ•ˆ/åƒåœ¾å›ç­”æ£€æµ‹ï¼ˆfieldKeyç”¨äºåŒºåˆ†æ•°å­—å‹å­—æ®µï¼‰ ==========
function isMeaninglessInput(text, fieldKey) {
  const t = text.trim()
  // æ•°å­—å‹å­—æ®µï¼šçº¯æ•°å­—è¾“å…¥æ°¸è¿œä¸æ˜¯åƒåœ¾
  if (NUMERIC_FIELDS.has(fieldKey) && /^\d+$/.test(t)) return false
  // æ˜ç¡®è¡¨ç¤ºä¸çŸ¥é“æ€ä¹ˆå›ç­”
  if (/^(ä¸çŸ¥é“è¯´å•¥|ä¸çŸ¥é“æ€ä¹ˆè¯´|ä¸çŸ¥é“æ€ä¹ˆå›ç­”|ä¸ä¼šè¯´|è¯´ä¸æ¸…|ä¸å¥½è¯´|ä¸çŸ¥é“å¡«ä»€ä¹ˆ|ä¸æ¸…æ¥šæ€ä¹ˆå¡«|ä¸çŸ¥é“å†™ä»€ä¹ˆ|ä¸æ‡‚|çœ‹ä¸æ‡‚|å•¥æ„æ€|ä»€ä¹ˆæ„æ€å•Š|ä¸ç†è§£|éšä¾¿|ç®—äº†|è·³è¿‡å§|ä¸‹ä¸€ä¸ª|è¿‡|ç•¥|ä¸æƒ³è¯´|æ‡’å¾—è¯´|ä¸æƒ³å¡«|emmm|å—¯å—¯|å“¦å“¦|å“¦|å—¯|å•Š|å‘ƒ|é¢|å¥½å§|è¡Œå§|ok|OK|Ok|\.+|ã€‚+|â€¦+|~+|\?+|ï¼Ÿ+|ï¼+|!+|å‘µå‘µ|å“ˆå“ˆ|å˜¿å˜¿)$/i.test(t)) return true
  // å£å¤´æ•·è¡/åº”ä»˜å¼çŸ­å›ç­”ï¼ˆå—¯å—¯å¥½çš„å§ã€å¥½å§å¥½å§ã€å“¦å“¦å¥½çš„ã€å—¯å—¯çŸ¥é“äº†ç­‰ï¼‰
  if (t.length <= 10 && /^(å—¯+|å“¦+|å•Š+|å‘ƒ+|é¢+)(å¥½çš„?|è¡Œ|å§|å‘¢|å•Š|å“¦|å˜›|äº†|çŸ¥é“äº†?|æ˜ç™½äº†?|å¯ä»¥|æ²¡é—®é¢˜|çœ‹åˆ°äº†?|æ”¶åˆ°|OK|ok)*[å§å‘¢å•Šå“¦å˜›äº†~ï¼!ã€‚.]*$/i.test(t)) return true
  if (t.length <= 10 && /^(å¥½[å§çš„å•Šå‘¢å˜›]|è¡Œ[å§äº†å•Š]|å¯ä»¥[å§äº†]|æ²¡é—®é¢˜|æ”¶åˆ°|çŸ¥é“äº†|æ˜ç™½äº†|çœ‹åˆ°äº†|äº†è§£äº†|OKäº†?|okäº†?)[å§å‘¢å•Šå“¦å˜›äº†~ï¼!ã€‚.]*$/i.test(t)) return true
  // çº¯æ ‡ç‚¹/è¡¨æƒ…/æ•°å­—ï¼ˆéé€‰é¡¹æ•°å­—ï¼Œä¸”éæ•°å­—å‹å­—æ®µï¼‰
  if (/^[.,ã€‚ï¼Œï¼!ï¼Ÿ?~â€¦\s\d]+$/.test(t) && !/^[1-5]$/.test(t)) return true
  // æçŸ­ä¸”æ— å®è´¨å†…å®¹
  if (t.length <= 2 && !/^[1-5]$/.test(t) && !/[\u4e00-\u9fff]{2}/.test(t)) return true
  return false
}

// ========== å­—æ®µå€¼æ™ºèƒ½æ ‡å‡†åŒ–ï¼šå°†å£è¯­åŒ–æè¿°è½¬ä¸ºä¸“ä¸šè¡¨è¿° ==========
function normalizeFieldValue(key, rawValue, existingData = {}) {
  const v = rawValue.trim()
  if (!v) return v

  switch (key) {
    case 'industry': {
      // ç”¨ matchIndustry æ ‡å‡†åŒ–è¡Œä¸šåç§°
      const ind = matchIndustry(v)
      if (ind) return ind.key  // "æˆ‘å–è¡£æœçš„" â†’ "é›¶å”®"
      // å»æ‰å£è¯­åŒ–å‰ç¼€
      return v.replace(/^(æˆ‘æ˜¯|æˆ‘ä»¬æ˜¯|æˆ‘åš|æˆ‘ä»¬åš|æˆ‘æ|å°±æ˜¯|ä¸»è¦æ˜¯|æˆ‘çš„æ˜¯|å±äº)/, '')
               .replace(/(çš„|å§|å•Š|å‘¢|å˜›|å“¦|å‘€)$/g, '').trim() || v
    }
    case 'business_model': {
      // æ ‡å‡†åŒ–ç»è¥æ¨¡å¼
      if (/^1$|çº¯çº¿ä¸Š|åª.*çº¿ä¸Š|ç½‘ä¸Š|å°ç¨‹åº|å…¬ä¼—å·|H5|ç½‘åº—/.test(v)) return 'çº¯çº¿ä¸Šï¼ˆå°ç¨‹åº/å…¬ä¼—å·/H5ï¼‰'
      if (/^2$|çº¿ä¸‹|é—¨åº—|å®ä½“|åº—é“º|å¼€åº—/.test(v)) return 'çº¿ä¸‹é—¨åº—ï¼ˆå®ä½“åº—é“ºï¼‰'
      if (/^3$|çº¿ä¸Š.*çº¿ä¸‹|çº¿ä¸‹.*çº¿ä¸Š|éƒ½æœ‰|ç»“åˆ|ä¸¤ä¸ªéƒ½/.test(v)) return 'çº¿ä¸Š+çº¿ä¸‹ç»“åˆ'
      return v.replace(/^(æˆ‘æ˜¯|æˆ‘ä»¬æ˜¯|å°±æ˜¯|ä¸»è¦æ˜¯)/, '').trim() || v
    }
    case 'violation_reason': {
      // å»æ‰å£è¯­åŒ–å‰ç¼€ï¼Œä¿ç•™åŸå§‹æè¿°
      return v.replace(/^(å°±æ˜¯|ä»–è¯´|å¾®ä¿¡è¯´|ä¸Šé¢å†™çš„æ˜¯|å†™çš„æ˜¯|æ˜¾ç¤º)/, '').trim() || v
    }
    case 'merchant_name':
    case 'company_name': {
      // å»æ‰å£è¯­åŒ–åŒ…è£¹å’Œå¸¸è§æ— ç”¨å‰ç¼€
      return v.replace(/^(ä¼ä¸š[ï¼Œ,\s]*|å…¬å¸[ï¼Œ,\s]*|ä¸ªä½“[ï¼Œ,\s]*|å«|å«åš|åå­—æ˜¯|åç§°æ˜¯|æ˜¯|æˆ‘å«)/, '').replace(/(å§|å•Š|å‘¢)$/g, '').trim() || v
    }
    case 'legal_name': {
      // å»æ‰å£è¯­åŒ–åŒ…è£¹
      return v.replace(/^(å«|å«åš|åå­—æ˜¯|åç§°æ˜¯|æ˜¯|æˆ‘å«)/, '').replace(/(å§|å•Š|å‘¢)$/g, '').trim() || v
    }
    case 'complaint_status': {
      if (/æ²¡æœ‰|æ— |æ²¡|0/.test(v) && v.length < 8) return 'æ²¡æœ‰æœªå¤„ç†æŠ•è¯‰'
      if (/æœ‰|å¥½å‡ ä¸ª|ä¸€äº›|å‡ ä¸ª/.test(v) && !/æ²¡/.test(v)) {
        return v.replace(/^(æœ‰|æ˜¯)/, '').trim() ? `æœ‰æœªå¤„ç†æŠ•è¯‰ï¼š${v.replace(/^(æœ‰|æ˜¯)/, '').trim()}` : v
      }
      return v
    }
    case 'refund_policy': {
      if (/æ²¡æœ‰|æ— |æ²¡|æ²¡å¼„|è¿˜æ²¡/.test(v) && v.length < 8) return 'æš‚æ— å®Œå–„é€€æ¬¾æ”¿ç­–'
      return v
    }
    case 'appeal_history': {
      if (/æ²¡æœ‰|æ— |æ²¡|ç¬¬ä¸€æ¬¡|é¦–æ¬¡|ä»æ¥æ²¡/.test(v) && v.length < 10) return 'é¦–æ¬¡ç”³è¯‰'
      return v
    }
    default:
      return v
  }
}

// ========== è¾“å…¥æ ¡éªŒå™¨ï¼šæ¯ä¸ªå…³é”®å­—æ®µæœ‰æ ¡éªŒè§„åˆ™ ==========
const FIELD_VALIDATORS = {
  merchant_id: (v) => {
    const cleaned = v.replace(/\s+/g, '')
    // å•†æˆ·å·é€šå¸¸æ˜¯10ä½æ•°å­—
    if (/^\d{8,12}$/.test(cleaned)) return { valid: true, cleaned }
    if (/\d{8,12}/.test(cleaned)) {
      const match = cleaned.match(/\d{8,12}/)
      return { valid: true, cleaned: match[0], hint: `å·²æå–å•†æˆ·å·ï¼š${match[0]}` }
    }
    return { valid: false, message: 'âš ï¸ å•†æˆ·å·æ ¼å¼ä¼¼ä¹ä¸å¤ªå¯¹ï¼Œé€šå¸¸æ˜¯10ä½æ•°å­—ï¼ˆå¦‚1234567890ï¼‰ã€‚\n\nå¯åœ¨å•†æˆ·å¹³å° pay.weixin.qq.com â†’ è´¦æˆ·ä¸­å¿ƒ â†’ å•†æˆ·ä¿¡æ¯ ä¸­æŸ¥çœ‹ã€‚\n\nè¯·é‡æ–°è¾“å…¥æ‚¨çš„å•†æˆ·å·~' }
  },
  legal_id_last4: (v) => {
    const cleaned = v.replace(/\s+/g, '')
    if (/^\d{4}$/.test(cleaned)) return { valid: true, cleaned }
    if (/^\d{1,3}$/.test(cleaned)) return { valid: false, message: 'âš ï¸ è¯·è¾“å…¥èº«ä»½è¯å·çš„åå››ä½æ•°å­—ï¼ˆ4ä½ï¼‰ï¼Œæ‚¨è¾“å…¥çš„ä½æ•°ä¸å¤Ÿ~' }
    if (/\d{4}/.test(cleaned)) {
      const last4 = cleaned.slice(-4)
      if (/^\d{4}$/.test(last4)) return { valid: true, cleaned: last4, hint: `å·²æå–åå››ä½ï¼š${last4}` }
    }
    // Accept X ending (some IDs end with X)
    if (/^\d{3}[xX]$/.test(cleaned)) return { valid: true, cleaned: cleaned.toUpperCase() }
    return { valid: false, message: 'âš ï¸ èº«ä»½è¯åå››ä½æ ¼å¼ä¸å¯¹ï¼Œè¯·è¾“å…¥4ä½æ•°å­—ï¼ˆå¦‚æœæœ«å°¾æ˜¯Xä¹Ÿå¯ä»¥ï¼‰~' }
  },
  bank_account_last4: (v) => {
    const cleaned = v.replace(/\s+/g, '')
    if (/^\d{4}$/.test(cleaned)) return { valid: true, cleaned }
    if (/^\d{1,3}$/.test(cleaned)) return { valid: false, message: 'âš ï¸ è¯·è¾“å…¥ç»“ç®—è´¦æˆ·å·çš„åå››ä½æ•°å­—ï¼ˆ4ä½ï¼‰ï¼Œæ‚¨è¾“å…¥çš„ä½æ•°ä¸å¤Ÿ~' }
    if (/\d{4}$/.test(cleaned)) {
      const last4 = cleaned.slice(-4)
      return { valid: true, cleaned: last4, hint: `å·²æå–åå››ä½ï¼š${last4}` }
    }
    return { valid: false, message: 'âš ï¸ è¯·è¾“å…¥ç»“ç®—è´¦æˆ·å·çš„åå››ä½æ•°å­—ï¼ˆ4ä½ï¼‰ã€‚\n\nå¯åœ¨å•†æˆ·å¹³å° â†’ è´¦æˆ·ä¸­å¿ƒ â†’ è´¦æˆ·ä¿¡æ¯ ä¸­æŸ¥çœ‹~' }
  },
  contact_phone: (v) => {
    const cleaned = v.replace(/[\s\-()ï¼ˆï¼‰]/g, '')
    if (/^1[3-9]\d{9}$/.test(cleaned)) return { valid: true, cleaned }
    if (/^0\d{2,3}\d{7,8}$/.test(cleaned)) return { valid: true, cleaned } // å›ºè¯
    if (/^\d{7,8}$/.test(cleaned)) return { valid: true, cleaned } // çŸ­å·
    if (/1[3-9]\d{9}/.test(cleaned)) {
      const match = cleaned.match(/1[3-9]\d{9}/)
      return { valid: true, cleaned: match[0], hint: `å·²æå–æ‰‹æœºå·ï¼š${match[0]}` }
    }
    return { valid: false, message: 'âš ï¸ æ‰‹æœºå·æ ¼å¼ä¼¼ä¹ä¸å¤ªå¯¹ã€‚è¯·è¾“å…¥11ä½æ‰‹æœºå·ï¼ˆå¦‚13812345678ï¼‰ã€‚\n\nè¿™ä¸ªå·ç å¾ˆé‡è¦ï¼Œå¾®ä¿¡å®¡æ ¸å›¢é˜Ÿå¯èƒ½ä¼šè¿›è¡Œç”µè¯å›è®¿~' }
  },
  company_name: (v) => {
    const cleaned = v.trim()
    // å¦‚æœçœ‹èµ·æ¥åƒä¸ªäººåï¼ˆ2-3ä¸ªæ±‰å­—ï¼Œä¸å«å…¬å¸/å•†è¡Œç­‰å…³é”®è¯ï¼‰ï¼Œæé†’ç”¨æˆ·
    if (/^[\u4e00-\u9fff]{2,3}$/.test(cleaned) && !/å…¬å¸|å•†è¡Œ|å·¥ä½œå®¤|ä¸ªä½“|åº—|éƒ¨|å‚|ç¤¾|æ‰€|é¦†|é™¢|å ‚|è¡Œ|é“º|åŠ|å·|ç½‘ç»œ|ç§‘æŠ€|è´¸æ˜“|å•†è´¸/.test(cleaned)) {
      return { valid: false, message: `ğŸ¤” ã€Œ${cleaned}ã€çœ‹èµ·æ¥åƒä¸ªäººå§“åã€‚è¿™é‡Œéœ€è¦çš„æ˜¯è¥ä¸šæ‰§ç…§ä¸Šçš„å…¬å¸/ä¸ªä½“æˆ·å…¨ç§°ï¼Œæ¯”å¦‚"XXç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸"æˆ–"XXå¸‚XXå•†è¡Œ"ã€‚\n\nå¦‚æœæ‚¨æ˜¯ä¸ªä½“æˆ·ä¸”æ‰§ç…§ä¸Šå°±æ˜¯ä¸ªäººåå­—ï¼Œè¯·è¾“å…¥"ä¸ªä½“æˆ· ${cleaned}"ç¡®è®¤~` }
    }
    return { valid: true, cleaned }
  },
  legal_name: (v) => {
    const cleaned = v.trim()
    // å¦‚æœçœ‹èµ·æ¥åƒå…¬å¸åï¼ˆå«æœ‰é™å…¬å¸/å·¥ä½œå®¤/å•†è¡Œç­‰ï¼‰ï¼Œæé†’ç”¨æˆ·
    if (/æœ‰é™å…¬å¸|å·¥ä½œå®¤|å•†è¡Œ|ä¸ªä½“|ä¼ä¸š|é›†å›¢|è‚¡ä»½|åˆä¼™|äº‹åŠ¡æ‰€/.test(cleaned)) {
      return { valid: false, message: `ğŸ¤” ã€Œ${cleaned}ã€çœ‹èµ·æ¥åƒå…¬å¸åç§°ã€‚è¿™é‡Œéœ€è¦çš„æ˜¯æ³•äººä»£è¡¨çš„ä¸ªäººå§“åï¼ˆè¥ä¸šæ‰§ç…§ä¸Š"æ³•å®šä»£è¡¨äºº"ä¸€æ ï¼‰ã€‚\n\nå¦‚æœæ‚¨çš„æ³•äººå§“åç¡®å®åŒ…å«è¿™äº›å­—ï¼Œè¯·å†è¾“å…¥ä¸€æ¬¡ç¡®è®¤~` }
    }
    return { valid: true, cleaned }
  },
  violation_reason: (v) => {
    const cleaned = v.trim()
    // çŸ­æ–‡æœ¬å¿…é¡»åŒ…å«è¿è§„ç›¸å…³å…³é”®è¯ï¼Œå¦åˆ™å¾ˆå¯èƒ½æ˜¯ç”¨æˆ·åœ¨å›ç­”å…¶ä»–é—®é¢˜
    const violationKeywords = /æ¶‰å«Œ|è¿è§„|å¼‚å¸¸|æ¬ºè¯ˆ|å”®å‡|å¥—ç°|èµŒåš|è‰²æƒ…|æ´—é’±|éæ³•|è™šå‡|äº¤æ˜“|çº çº·|æŠ•è¯‰|åˆ†é”€|ä¼ é”€|æ‹¦æˆª|å†»ç»“|å°ç¦|é™é¢|å…³é—­|å¤„ç½š|é£é™©|è¢«å°|è¢«å†»|è¢«å…³|è¢«é™|ä¾µæƒ|ä»¿å†’|ç›—ç‰ˆ|è·‘åˆ†|èµ„é‡‘|ä¿¡ç”¨å¡/
    if (cleaned.length <= 5 && !violationKeywords.test(cleaned)) {
      return { valid: false, message: `ğŸ¤” ã€Œ${cleaned}ã€ä¼¼ä¹ä¸æ˜¯è¿è§„åŸå› æè¿°ã€‚\n\nè¯·æä¾›å¾®ä¿¡å®˜æ–¹ç»™å‡ºçš„å…·ä½“è¿è§„åŸå› ï¼Œé€šå¸¸åœ¨"å•†å®¶åŠ©æ‰‹å°ç¨‹åº â†’ é£é™©å¤„ç† â†’ åŠŸèƒ½é™åˆ¶è®°å½•"ä¸­å¯ä»¥çœ‹åˆ°ã€‚\n\næ¯”å¦‚ï¼šæ¶‰å«Œäº¤æ˜“å¼‚å¸¸ã€æ¶‰å«Œæ¬ºè¯ˆã€æ¶‰å«Œä¿¡ç”¨å¡å¥—ç°ç­‰~` }
    }
    return { valid: true, cleaned }
  },
  license_no: (v) => {
    const cleaned = v.replace(/\s+/g, '')
    // ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š18ä½
    if (/^[0-9A-Z]{18}$/i.test(cleaned)) return { valid: true, cleaned: cleaned.toUpperCase() }
    // 15ä½å·¥å•†æ³¨å†Œå·
    if (/^\d{15}$/.test(cleaned)) return { valid: true, cleaned }
    // ç”¨æˆ·å¯èƒ½è¾“å…¥äº†"æ²¡æœ‰"ç­‰
    if (isNegativeAnswer(cleaned)) return { valid: true, cleaned: v.trim() }
    // é•¿åº¦ä¸å¯¹ä½†åƒæ˜¯åœ¨å°è¯•è¾“å…¥
    if (/^[0-9A-Z]{10,}$/i.test(cleaned)) return { valid: false, message: `âš ï¸ ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç é€šå¸¸æ˜¯18ä½å­—æ¯+æ•°å­—ï¼ˆå¦‚91110105MA01234X56ï¼‰ï¼Œæ‚¨è¾“å…¥äº†${cleaned.length}ä½ï¼Œè¯·æ ¸å¯¹åé‡æ–°è¾“å…¥~` }
    return { valid: true, cleaned: v.trim() } // å…¶ä»–æ ¼å¼æ”¾è¿‡
  },
}

// éªŒè¯å­—æ®µè¾“å…¥
function validateField(key, value) {
  const validator = FIELD_VALIDATORS[key]
  if (!validator) return { valid: true, cleaned: value.trim() }
  return validator(value)
}

/**
 * æœ¬åœ°è§„åˆ™å¼•æ“å¤„ç†ç”¨æˆ·æ¶ˆæ¯
 * @param {string} userMessage ç”¨æˆ·è¾“å…¥
 * @param {number} step å½“å‰æ”¶é›†æ­¥éª¤ (0-based)
 * @param {object} data å·²æ”¶é›†çš„æ•°æ®
 * @returns {{ response: string, nextStep: number, collectedData: object, infoUpdate: object|null, needDeepSeek: boolean, allCollected: boolean }}
 */
export function processLocal(userMessage, step, data) {
  const d = { ...data }
  const currentField = INFO_FIELDS[step] || INFO_FIELDS[INFO_FIELDS.length - 1]
  const msg = userMessage.trim()

  // 0. ç©ºæ¶ˆæ¯ä¿æŠ¤
  if (!msg) {
    return { response: `è¯·å›ç­”å½“å‰é—®é¢˜ï¼š\n\n${currentField.question}`, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 1. æ£€æµ‹"ä¸ºä»€ä¹ˆ"ç±»é—®é¢˜
  if (isWhyQuestion(msg)) {
    const explanation = currentField.why
    const response = `ä¸ºä»€ä¹ˆéœ€è¦ã€Œ${currentField.label}ã€ï¼Ÿ\n\n${explanation}\n\nğŸ”’ æ‚¨çš„æ‰€æœ‰ä¿¡æ¯ä»…ç”¨äºç”Ÿæˆç”³è¯‰ææ–™ï¼Œæˆ‘ä»¬ä¸ä¼šç”¨äºä»»ä½•å…¶ä»–ç”¨é€”ã€‚\n\nè¯·ç»§ç»­å›ç­”ä¸Šé¢çš„é—®é¢˜ï¼š\n\n${currentField.question}`
    return { response, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 2. æ£€æµ‹æœ¬åœ°å¯å›ç­”çš„å¸¸è§é—®é¢˜ï¼ˆä½†ä¸èƒ½æ˜¯çŸ­å›ç­”è¢«è¯¯åŒ¹é…ï¼‰
  // å½“åœ¨violation_reasonæ­¥éª¤ä¸”æ¶ˆæ¯åŒ…å«è¿è§„ç›¸å…³å†…å®¹æ—¶ï¼Œè·³è¿‡QAåŒ¹é…ï¼Œä¼˜å…ˆæå–è¿è§„åŸå› 
  const skipQA = currentField.key === 'violation_reason' && /æ¶‰å«Œ|é™åˆ¶åŠŸèƒ½|é™åˆ¶æ—¶é—´|åŠŸèƒ½é™åˆ¶|è¿è§„|å¤„ç½š|å…³é—­.*åŠŸèƒ½|å‡ºæ¬¾|æ”¶æ¬¾/.test(msg)
  // é•¿æ¶ˆæ¯ï¼ˆ>30å­—ç¬¦ï¼‰ä¸”åŒ…å«å­—æ®µæ•°æ®ç‰¹å¾ï¼ˆå•†æˆ·å·/å…¬å¸å/æ•°å­—ID/è¡Œä¸šå…³é”®è¯ç­‰ï¼‰æ—¶è·³è¿‡QAï¼Œä¼˜å…ˆæå–å­—æ®µ
  const hasFieldData = msg.length > 30 && (/\d{8,12}/.test(msg) || /å…¬å¸|æœ‰é™|å•†æˆ·|å•†è¡Œ|å·¥ä½œå®¤|ä¸ªä½“/.test(msg) || /åš|å–|ç»è¥|ä¸šåŠ¡/.test(msg))
  if (!isNegativeAnswer(msg) && !skipQA && !hasFieldData) {
    const qaAnswer = matchLocalQA(msg)
    if (qaAnswer) {
      const response = `${qaAnswer}\n\nå¥½çš„ï¼Œæˆ‘ä»¬ç»§ç»­æ”¶é›†ä¿¡æ¯ã€‚å½“å‰é—®é¢˜ï¼š\n\n${currentField.question}`
      return { response, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
    }
  }

  // 2.5 æ£€æµ‹æ˜¯å¦æ˜¯å¯¹AIæœ¬èº«è¯´è¯ï¼ˆè€Œéå›ç­”ä¸šåŠ¡é—®é¢˜ï¼‰â†’ äº¤ç»™DeepSeekè‡ªç„¶å›åº”
  if (isDirectedAtAI(msg)) {
    return { response: null, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: true, allCollected: false }
  }

  // 2.6 æ£€æµ‹ç”¨æˆ·æ˜¯å¦åœ¨çº æ­£/è¡¥å……å·²è¢«è‡ªåŠ¨æ¨æ–­çš„å­—æ®µï¼ˆé˜²æ­¢ç­”æ¡ˆè¢«å­˜å…¥é”™è¯¯çš„ä¸‹ä¸€ä¸ªå­—æ®µï¼‰
  // åœºæ™¯ï¼šindustry å›ç­”å business_model è¢«è‡ªåŠ¨æ¨æ–­ä¸º"çº¯çº¿ä¸Š"ï¼Œä½†ç”¨æˆ·ç´§æ¥ç€è¯´"çº¿ä¸Šçº¿ä¸‹éƒ½æœ‰"
  // æ­¤æ—¶ step å·²è·³åˆ° problem_typeï¼Œä½†ç”¨æˆ·çš„å›ç­”åº”è¯¥æ›´æ–° business_model è€Œéå­˜ä¸º problem_type
  if (step > 0) {
    const autoInferableFields = { business_model: /çº¿ä¸Š|çº¿ä¸‹|é—¨åº—|å®ä½“|å°ç¨‹åº|å…¬ä¼—å·|H5|ç½‘ä¸Š|ç½‘åº—|ç»“åˆ|éƒ½æœ‰|ä¸¤ä¸ªéƒ½|app/i }
    for (const [fieldKey, pattern] of Object.entries(autoInferableFields)) {
      // åªåœ¨è¯¥å­—æ®µå·²æœ‰å€¼ã€ä¸”åœ¨å½“å‰å­—æ®µä¹‹å‰ã€ä¸”ç”¨æˆ·æ¶ˆæ¯æ˜ç¡®åŒ¹é…è¯¥å­—æ®µæ—¶è§¦å‘
      // ä½†å¦‚æœæ¶ˆæ¯åŒæ—¶åŒ…å«å½“å‰å­—æ®µçš„å…³é”®è¯ï¼ˆå¦‚"å°ç¨‹åºè¢«å…³äº†"åŒæ—¶å«å°ç¨‹åº+å…³é—­ï¼‰ï¼Œä¼˜å…ˆè§†ä¸ºå½“å‰å­—æ®µçš„å›ç­”
      const currentFieldKeywords = { problem_type: /å…³é—­|å†»ç»“|å°ç¦|æ‹¦æˆª|é™é¢|é™åˆ¶|è¢«å°|æƒé™|æ”¶æ¬¾/, violation_reason: /æ¶‰å«Œ|è¿è§„|å¼‚å¸¸|å¤„ç½š|å¥—ç°|æ¬ºè¯ˆ|èµŒåš/ }
      const currentHasKeyword = currentFieldKeywords[currentField.key] && currentFieldKeywords[currentField.key].test(msg)
      if (d[fieldKey] && fieldKey !== currentField.key && pattern.test(msg) && !currentHasKeyword) {
        const fieldIdx = INFO_FIELDS.findIndex(f => f.key === fieldKey)
        if (fieldIdx >= 0 && fieldIdx < step) {
          // ç”¨æˆ·åœ¨çº æ­£/è¡¥å……ä¹‹å‰è¢«è‡ªåŠ¨æ¨æ–­çš„å­—æ®µ
          const newValue = normalizeFieldValue(fieldKey, stripFrustrationPrefix(msg), d)
          const oldValue = d[fieldKey]
          if (newValue !== oldValue) {
            d[fieldKey] = newValue
            const fieldDef = INFO_FIELDS[fieldIdx]
            const response = `âœ… å·²æ›´æ–°${fieldDef.label}ï¼š${oldValue} â†’ ${newValue}\n\næˆ‘ä»¬ç»§ç»­~ å½“å‰é—®é¢˜ï¼š\n\n${currentField.question}`
            return { response, nextStep: step, collectedData: d, infoUpdate: { key: fieldKey, label: fieldDef.label, value: newValue, group: fieldDef.group, icon: fieldDef.icon }, needDeepSeek: false, allCollected: false }
          }
        }
      }
    }
  }

  // 3. [å·²ç§»é™¤æœ¬åœ°regexè·¨å­—æ®µæå–] æ‰€æœ‰å­—æ®µæå–ç»Ÿä¸€ç”±DeepSeek APIå®Œæˆ

  // 3.5 æ£€æµ‹æ˜¯å¦æ˜¯æé—®/æƒ…ç»ªåŒ–è¡¨è¾¾/å¤æ‚æ¶ˆæ¯ â†’ äº¤ç»™ DeepSeek
  if (isQuestion(msg) && msg.length < 60) {
    return { response: null, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: true, allCollected: false }
  }
  // é•¿æ¶ˆæ¯ä¸­åŒ…å«æƒ…ç»ª/æ±‚åŠ©/æŠ±æ€¨ä¸”ä¸åƒåœ¨å›ç­”é—®é¢˜ â†’ äº¤ç»™ DeepSeekï¼ˆDeepSeekè´Ÿè´£æå–æœ‰ç”¨æ•°æ®ï¼‰
  if (msg.length > 15 && /æ€ä¹ˆåŠ|æ€¥|å¸®å¸®|æ•‘|å®³æ€•|æ‹…å¿ƒ|æ°”æ­»|å‘|éª—|ä¸å…¬å¹³|æŠ•è¯‰ä½ |ä»€ä¹ˆæ„æ€|æä¸æ‡‚|å¤ªéš¾äº†/.test(msg) && !isNegativeAnswer(msg)) {
    return { response: null, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: true, allCollected: false }
  }
  // 3.55 çŸ­çš„æ±‚åŠ©/æŠ±æ€¨/çº é”™ï¼šå¦‚"æ€ä¹ˆåŠå•Š"ã€"æ²¡æœ‰è¿™äº›æ€ä¹ˆåŠ"ã€"ä½ å†™é”™äº†å§"ã€"æé”™äº†"
  if (/æ€ä¹ˆåŠ|ä½ å†™é”™|æé”™äº†|å¼„é”™äº†|ä¸å¯¹å§|é”™äº†å§|æœ‰é—®é¢˜/.test(msg) && msg.length <= 15) {
    return { response: null, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: true, allCollected: false }
  }

  // 3.8 è·‘é¢˜/æ— å…³è¾“å…¥æ£€æµ‹ï¼šç”¨æˆ·è¯´çš„ä¸æ˜¯åœ¨å›ç­”å½“å‰é—®é¢˜
  if (isOffTopicInput(msg, currentField.key)) {
    return { response: `ğŸ˜Š æ‚¨å¥½ï¼æˆ‘æ˜¯å•†æˆ·å·ç”³è¯‰ä¸“å®¶ï¼Œç›®å‰æ­£åœ¨å¸®æ‚¨æ”¶é›†ç”³è¯‰æ‰€éœ€çš„ä¿¡æ¯~\n\næˆ‘ä»¬å…ˆç»§ç»­å®Œæˆå½“å‰é—®é¢˜ï¼š\n\n${currentField.question}`, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 3.85 æ‹’ç»/å›é¿å‹å›ç­”æ£€æµ‹ï¼šç”¨æˆ·æ˜ç¡®æ‹’ç»æä¾›ä¿¡æ¯
  if (isRefusalAnswer(msg)) {
    // éå¿…å¡«å­—æ®µï¼ˆå¯è·³è¿‡ï¼‰ï¼šå­˜é»˜è®¤å€¼ï¼Œç»§ç»­ä¸‹ä¸€é¢˜
    const skippableFields = { license_no: 'ç”¨æˆ·æœªæä¾›', legal_id_last4: 'ç”¨æˆ·æœªæä¾›', bank_account_last4: 'ç”¨æˆ·æœªæä¾›', appeal_history: 'é¦–æ¬¡ç”³è¯‰' }
    if (skippableFields[currentField.key]) {
      d[currentField.key] = skippableFields[currentField.key]
      const rawNext = step + 1
      const nextS = findNextUnfilledStep(rawNext, d)
      if (nextS >= TOTAL_STEPS) return { response: 'æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ç»§ç»­~', nextStep: nextS, collectedData: d, infoUpdate: { key: currentField.key, label: currentField.label, value: skippableFields[currentField.key], group: currentField.group, icon: currentField.icon }, needDeepSeek: false, allCollected: true }
      const nf = INFO_FIELDS[nextS]
      return { response: `æ²¡å…³ç³»ï¼Œè¿™ä¸ªä¿¡æ¯å¯ä»¥åç»­è¡¥å……~\n\n${nf.question}`, nextStep: nextS, collectedData: d, infoUpdate: { key: currentField.key, label: currentField.label, value: skippableFields[currentField.key], group: currentField.group, icon: currentField.icon }, needDeepSeek: false, allCollected: false }
    }
    // å¿…å¡«å­—æ®µï¼šå‹å¥½è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ï¼Œé‡æ–°æé—®
    return { response: `ğŸ˜Š ç†è§£æ‚¨çš„é¡¾è™‘~ ä¸è¿‡ã€Œ${currentField.label}ã€æ˜¯ç”³è¯‰ææ–™ä¸­å¿…éœ€çš„ä¿¡æ¯ï¼Œç¼ºå°‘çš„è¯ä¼šå½±å“ç”³è¯‰æˆåŠŸç‡ã€‚\n\nğŸ”’ æ‚¨çš„ä¿¡æ¯ä»…ç”¨äºæœ¬æ¬¡ç”³è¯‰ï¼Œæˆ‘ä»¬ä¸ä¼šæ³„éœ²æˆ–ç”¨äºå…¶ä»–ç”¨é€”ã€‚\n\n${currentField.question}`, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 3.88 å¤„ç½šç±»å‹è¿½é—®çŠ¶æ€ï¼šæå‰å¤„ç†ï¼Œé˜²æ­¢è¢« meaningless æ£€æµ‹æ‹¦æˆª
  if (currentField.key === 'problem_type' && d._problem_followup_asked) {
    // æ£€æµ‹æ˜¯å¦æ˜¯è¿è§„åŸå› çš„å¤šé€‰æ ¼å¼ï¼ˆå¦‚ "6.7"ã€"6ï¼Œ7"ã€"6å’Œ7"ã€"â‘ â‘¥"ï¼‰
    const violationOptionMap = {
      '1': 'æ¶‰å«Œäº¤æ˜“å¼‚å¸¸', 'â‘ ': 'æ¶‰å«Œäº¤æ˜“å¼‚å¸¸',
      '2': 'æ¶‰å«Œäº¤æ˜“çº çº·/æŠ•è¯‰è¿‡å¤š', 'â‘¡': 'æ¶‰å«Œäº¤æ˜“çº çº·/æŠ•è¯‰è¿‡å¤š',
      '3': 'æ¶‰å«Œè·¨ç±»ç›®ç»è¥', 'â‘¢': 'æ¶‰å«Œè·¨ç±»ç›®ç»è¥',
      '4': 'æ¶‰å«Œä¿¡ç”¨å¡å¥—ç°', 'â‘£': 'æ¶‰å«Œä¿¡ç”¨å¡å¥—ç°',
      '5': 'æ¶‰å«Œå¤šçº§åˆ†é”€/ä¼ é”€', 'â‘¤': 'æ¶‰å«Œå¤šçº§åˆ†é”€/ä¼ é”€',
      '6': 'æ¶‰å«Œæ¬ºè¯ˆ/å”®å‡', 'â‘¥': 'æ¶‰å«Œæ¬ºè¯ˆ/å”®å‡',
      '7': 'æ¶‰å«ŒèµŒåš/è‰²æƒ…/éæ³•å†…å®¹', 'â‘¦': 'æ¶‰å«ŒèµŒåš/è‰²æƒ…/éæ³•å†…å®¹',
    }
    // è§£æå¤šé€‰ï¼šæ”¯æŒ "6.7"ã€"6ï¼Œ7"ã€"6å’Œ7"ã€"6 7"ã€"67" ç­‰æ ¼å¼
    const nums = msg.replace(/[.ï¼Œ,ã€å’Œä¸åŠ\s]+/g, ' ').trim().split(/\s+/).flatMap(s => {
      // å¤„ç† "67" è¿™ç§è¿å†™
      if (/^\d{2,}$/.test(s)) return s.split('')
      return [s]
    })
    const reasons = nums.map(n => violationOptionMap[n]).filter(Boolean)
    if (reasons.length > 0) {
      delete d._problem_followup_asked
      d.violation_reason = reasons.join('ã€')
      const rawNext = step + 1
      const nextS = findNextUnfilledStep(rawNext, d)
      // è·³è¿‡ violation_reason æ­¥éª¤ï¼ˆå·²å¡«å……ï¼‰
      const afterViolation = findNextUnfilledStep(nextS, d)
      const nf = INFO_FIELDS[afterViolation] || INFO_FIELDS[nextS]
      const targetStep = afterViolation < TOTAL_STEPS ? afterViolation : nextS
      const infoUpdate = { key: 'violation_reason', label: 'è¿è§„åŸå› ', value: d.violation_reason, group: 'problem', icon: 'ğŸ“‹' }
      return { response: `âœ… å·²è®°å½•è¿è§„åŸå› ï¼š${d.violation_reason}\n\n${nf ? nf.question : 'ç»§ç»­ä¸‹ä¸€æ­¥~'}`, nextStep: targetStep, collectedData: d, infoUpdate, needDeepSeek: false, allCollected: targetStep >= TOTAL_STEPS }
    }
    // éå¤šé€‰æ ¼å¼ï¼Œä½œä¸ºè¿½é—®çš„å›ç­”å¤„ç†ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
    delete d._problem_followup_asked
    d._problem_detail = msg
    const rawNext = step + 1
    const nextS = findNextUnfilledStep(rawNext, d)
    if (nextS >= TOTAL_STEPS) return { response: 'âœ… æ„Ÿè°¢è¡¥å……ï¼', nextStep: nextS, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: true }
    const nf = INFO_FIELDS[nextS]
    return { response: `æ„Ÿè°¢è¡¥å……ï¼è¿™äº›ä¿¡æ¯å¯¹åˆ¶å®šç”³è¯‰ç­–ç•¥éå¸¸æœ‰å¸®åŠ©~\n\n${nf.question}`, nextStep: nextS, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 3.9 æ— æ•ˆ/åƒåœ¾å›ç­”æ£€æµ‹ï¼šä¸å­˜ä¸ºå­—æ®µå€¼ï¼Œå‹å¥½å¼•å¯¼é‡æ–°å›ç­”
  if (isMeaninglessInput(msg, currentField.key) && !isNegativeAnswer(msg)) {
    const fieldHints = {
      industry: 'æ¯”å¦‚æ‚¨æ˜¯åšé¤é¥®å¤–å–ã€æœè£…é›¶å”®ã€æ•™è‚²åŸ¹è®­ã€æ¸¸æˆã€ç›²ç›’ã€SaaSè½¯ä»¶â€¦â€¦ç”¨è‡ªå·±çš„è¯è¯´å°±è¡Œ~',
      business_model: 'æ¯”å¦‚ï¼šçº¯çº¿ä¸Šï¼ˆå°ç¨‹åº/H5ï¼‰ã€çº¿ä¸‹é—¨åº—ã€è¿˜æ˜¯çº¿ä¸Š+çº¿ä¸‹ç»“åˆï¼Ÿç®€å•è¯´è¯´å°±å¥½~',
      problem_type: 'æ¯”å¦‚ï¼šäº¤æ˜“æ‹¦æˆªã€æ”¶æ¬¾é™é¢ã€æ”¯ä»˜æƒé™å…³é—­ã€èµ„é‡‘å†»ç»“ã€å•†æˆ·å·å°ç¦ï¼Ÿè¾“å…¥æ•°å­—ä¹Ÿè¡Œ~',
      violation_reason: 'æ‚¨å¯ä»¥æ‰“å¼€ã€Œå¾®ä¿¡æ”¯ä»˜å•†å®¶åŠ©æ‰‹ã€â†’ é£é™©å¤„ç† â†’ åŠŸèƒ½é™åˆ¶è®°å½•ï¼ŒæŠŠä¸Šé¢æ˜¾ç¤ºçš„åŸå› å‘ç»™æˆ‘~',
      merchant_id: 'å•†æˆ·å·ä¸€èˆ¬æ˜¯10ä½æ•°å­—ï¼Œå¯åœ¨å•†æˆ·å¹³å° pay.weixin.qq.com â†’ è´¦æˆ·ä¸­å¿ƒ æŸ¥çœ‹~',
      merchant_name: 'å°±æ˜¯æ‚¨çš„å•†æˆ·å·æ˜¾ç¤ºçš„åç§°ï¼Œæ¯”å¦‚"XXå°åƒåº—"~',
      company_name: 'è¥ä¸šæ‰§ç…§ä¸Šçš„å…¬å¸å…¨ç§°ï¼Œæ¯”å¦‚"XXå¸‚XXç§‘æŠ€æœ‰é™å…¬å¸"~',
      legal_name: 'è¥ä¸šæ‰§ç…§ä¸Šçš„æ³•å®šä»£è¡¨äººå§“å~',
      bank_name: 'æ‚¨å•†æˆ·å·ç»‘å®šçš„ç»“ç®—é“¶è¡Œï¼Œæ¯”å¦‚"æ‹›å•†é“¶è¡Œ"ã€"å·¥å•†é“¶è¡Œ"~',
    }
    const hint = fieldHints[currentField.key] || 'è¯·æ ¹æ®æ‚¨çš„å®é™…æƒ…å†µå›ç­”ï¼Œä¸ç¡®å®šçš„å¯ä»¥å¤§æ¦‚è¯´è¯´~'
    return { response: `ğŸ˜Š æ²¡å…³ç³»ï¼Œä¸ç”¨ç´§å¼ ï¼è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆç®€å•ï¼š\n\n${currentField.question}\n\nğŸ’¡ ${hint}`, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 3.10 å»¶è¿Ÿ/æ¨è„±å›ç­”ï¼šã€Œå¿˜äº†æ™šç‚¹å‘Šè¯‰ä½ ã€â†’å­˜ä¸ºå¾…è¡¥å……
  if (isDeferAnswer(msg)) {
    const deferrable = new Set(['license_no', 'legal_id_last4', 'bank_account_last4', 'merchant_id', 'company_name', 'merchant_name', 'bank_name', 'contact_phone', 'legal_name'])
    if (deferrable.has(currentField.key)) {
      d[currentField.key] = 'â³å¾…è¡¥å……'
      const rawNext = step + 1
      const nextS = findNextUnfilledStep(rawNext, d)
      const iu = { key: currentField.key, label: currentField.label, value: 'â³å¾…è¡¥å……', group: currentField.group, icon: currentField.icon }
      if (nextS >= TOTAL_STEPS) return { response: 'å¥½çš„ï¼Œè¿™ä¸ªä¿¡æ¯æ‚¨å¯ä»¥ç¨ååœ¨å³ä¾§é¢æ¿è¡¥å……~', nextStep: nextS, collectedData: d, infoUpdate: iu, needDeepSeek: false, allCollected: true }
      const nf = INFO_FIELDS[nextS]
      return { response: `æ²¡é—®é¢˜ï¼Œã€Œ${currentField.label}ã€æ‚¨å¯ä»¥ç¨ååœ¨å³ä¾§é¢æ¿è¡¥å……~\n\næˆ‘ä»¬å…ˆç»§ç»­ ğŸ‘‡\n\n${nf.question}`, nextStep: nextS, collectedData: d, infoUpdate: iu, needDeepSeek: false, allCollected: false }
    }
    return { response: `ğŸ˜Š ç†è§£~ ä¸è¿‡ã€Œ${currentField.label}ã€å¯¹ç”³è¯‰å¾ˆé‡è¦ï¼Œç¼ºå°‘ä¼šå½±å“æˆåŠŸç‡ã€‚\n\nèƒ½å°½é‡æä¾›ä¸€ä¸‹å—ï¼Ÿ\n\n${currentField.question}`, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 3.11 æ¨¡ç³Š/åæ§½æ£€æµ‹ï¼šã€Œå·²ç»å‡ºæ¥äº†å¾ˆå¤šäº†ã€â†’ä¸å½“æœ‰æ•ˆç­”æ¡ˆ
  if (isVagueNonAnswer(msg, currentField.key)) {
    const remaining = TOTAL_STEPS - step
    return { response: `ğŸ˜Š ç†è§£æ‚¨çš„å¿ƒæƒ…~ è¿˜å‰©${remaining}ä¸ªé—®é¢˜å°±å®Œæˆäº†ï¼Œæ¯ä¸ªéƒ½ä¼šç›´æ¥å½±å“æ‚¨çš„ç”³è¯‰ç»“æœå“¦ï¼\n\n${currentField.question}\n\nğŸ’¡ è¯·å°½é‡å…·ä½“æè¿°ï¼Œè¿™æ ·ç”Ÿæˆçš„ç”³è¯‰ææ–™æ‰æ›´æœ‰é’ˆå¯¹æ€§~`, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 4. è¾“å…¥æ ‡å‡†åŒ–ï¼ˆç‰¹å®šå­—æ®µåšæ™ºèƒ½æ˜ å°„ï¼‰
  let finalValue = stripFrustrationPrefix(msg)

  // 4.0 è¿è§„åŸå› å­—æ®µï¼šä»é•¿æ–‡æœ¬ä¸­æ™ºèƒ½æå–æ ¸å¿ƒè¿è§„åŸå›  + è‡ªåŠ¨è¯†åˆ«å¤„ç½šç±»å‹
  if (currentField.key === 'violation_reason' && msg.length > 15) {
    const violations = []
    const vMatches = msg.match(/æ¶‰å«Œ[\u4e00-\u9fff]{2,10}/g)
    if (vMatches) violations.push(...vMatches)
    const commonViolations = ['äº¤æ˜“å¼‚å¸¸', 'æ¬ºè¯ˆ', 'ä¿¡ç”¨å¡å¥—ç°', 'è™šå‡äº¤æ˜“', 'æ¶‰å«ŒèµŒåš', 'è‰²æƒ…', 'ä¼ é”€', 'æ´—é’±', 'å”®å‡', 'ä¾µæƒ', 'è¿åæ³•å¾‹æ³•è§„', 'äº¤æ˜“çº çº·', 'è·¨ç±»ç›®ç»è¥', 'å¤šçº§åˆ†é”€']
    for (const cv of commonViolations) {
      if (msg.includes(cv) && !violations.some(v => v.includes(cv))) violations.push(cv)
    }
    if (violations.length > 0) {
      finalValue = [...new Set(violations)].join('ã€')
    }
    // æå–å¤„ç½šæ—¶é—´
    const timeMatches = msg.match(/\d{4}[/å¹´.-]\d{1,2}[/æœˆ.-]\d{1,2}/g)
    if (timeMatches) d._violation_times = timeMatches.join('ã€')
    // æ™ºèƒ½æ¨æ–­problem_typeï¼ˆå¦‚æœè¿˜æ²¡å¡«ï¼‰
    if (!d.problem_type) {
      if (/å…³é—­.*æ”¶æ¬¾.*åŠŸèƒ½|å…³é—­å•†æˆ·æ”¶æ¬¾|æ”¶æ¬¾åŠŸèƒ½.*å…³é—­/.test(msg)) {
        d.problem_type = 'æ”¯ä»˜æƒé™å…³é—­'
      } else if (/å…³é—­.*å‡ºæ¬¾|å‡ºæ¬¾.*å…³é—­/.test(msg) && /å…³é—­.*æ”¶æ¬¾|æ”¶æ¬¾.*å…³é—­/.test(msg)) {
        d.problem_type = 'æ”¯ä»˜æƒé™å…³é—­'
      } else if (/å†»ç»“|å»¶è¿Ÿç»“ç®—/.test(msg)) {
        d.problem_type = 'èµ„é‡‘å†»ç»“'
      } else if (/å°ç¦|æ°¸ä¹…é™åˆ¶/.test(msg)) {
        d.problem_type = 'å•†æˆ·å·å°ç¦'
      } else if (/é™é¢|é¢åº¦/.test(msg)) {
        d.problem_type = 'æ”¶æ¬¾é™é¢'
      } else if (/æ‹¦æˆª/.test(msg)) {
        d.problem_type = 'äº¤æ˜“æ‹¦æˆª'
      }
    }
    // æå–é™åˆ¶èŒƒå›´è¯¦æƒ…
    const restrictions = []
    if (/å…³é—­.*æ”¶æ¬¾/.test(msg)) restrictions.push('å…³é—­æ”¶æ¬¾')
    if (/å…³é—­.*å‡ºæ¬¾/.test(msg)) restrictions.push('å…³é—­å‡ºæ¬¾')
    if (/ä¿ç•™.*æç°/.test(msg)) restrictions.push('ä»…ä¿ç•™æç°')
    if (/ä¿ç•™.*é€€æ¬¾/.test(msg)) restrictions.push('ä»…ä¿ç•™é€€æ¬¾')
    if (restrictions.length > 0) d._restriction_details = restrictions.join('ã€')
  }

  if (currentField.key === 'problem_type' && !d._problem_followup_asked) {
    const normalized = normalizeProblemType(msg)
    if (normalized) {
      finalValue = normalized
    }
    // å¦‚æœç”¨æˆ·è¾“å…¥å®Œå…¨æ— æ³•è¯†åˆ«ä¸ºä»»ä½•å¤„ç½šç±»å‹ï¼Œäº¤ç»™DeepSeekå¤„ç†ï¼ˆå¯èƒ½åŒ…å«å…¶ä»–å­—æ®µæ•°æ®ï¼‰
    if (!normalized && !/[å†»ç»“å°ç¦æ‹¦æˆªé™é¢å…³é—­æƒé™]/.test(msg)) {
      return { response: null, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: true, allCollected: false }
    }
  }

  // 5. è¾“å…¥æ ¡éªŒï¼ˆæ ¼å¼ç±»å­—æ®µåšéªŒè¯ï¼‰
  let validation = validateField(currentField.key, finalValue)
  if (!validation.valid) {
    // 5.1 æ™ºèƒ½é‡è¯•ï¼šå»æ‰æƒ…ç»ªå‰ç¼€å†éªŒè¯ï¼ˆå¦‚"ç»™ä½ äº†1409570162"â†’"1409570162"ï¼‰
    const stripped = stripFrustrationPrefix(finalValue)
    if (stripped !== finalValue) {
      const retryValidation = validateField(currentField.key, stripped)
      if (retryValidation.valid) {
        validation = retryValidation
        finalValue = stripped
      }
    }
  }
  if (!validation.valid) {
    // æ ¡éªŒå¤±è´¥ï¼šäº¤ç»™DeepSeekåˆ¤æ–­æ˜¯å¦æ˜¯å…¶ä»–å­—æ®µçš„æ•°æ®
    return { response: validation.message, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: true, allCollected: false }
  }
  // ä½¿ç”¨æ¸…ç†åçš„å€¼
  finalValue = validation.cleaned || finalValue
  if (validation.hint) {
    // æœ‰è‡ªåŠ¨æå–æç¤ºï¼ˆå¦‚ä»é•¿æ–‡æœ¬ä¸­æå–äº†æ‰‹æœºå·ï¼‰
  }

  // 5.5 [å·²ç§»é™¤æœ¬åœ°regexå¤šå­—æ®µæå–] è·¨å­—æ®µæå–ç»Ÿä¸€ç”±DeepSeek APIå®Œæˆ

  // 6. "æ²¡æœ‰/ä¸çŸ¥é“"ç±»å›ç­”çš„æ™ºèƒ½å¤„ç†
  if (isNegativeAnswer(msg)) {
    const negativeFieldMap = {
      complaint_status: 'æ²¡æœ‰æœªå¤„ç†æŠ•è¯‰',
      refund_policy: 'æš‚æ— å®Œå–„é€€æ¬¾æ”¿ç­–',
      appeal_history: 'é¦–æ¬¡ç”³è¯‰',
      license_no: 'ç”¨æˆ·æš‚æœªæä¾›',
      legal_id_last4: 'ç”¨æˆ·æš‚æœªæä¾›',
      bank_account_last4: 'ç”¨æˆ·æš‚æœªæä¾›',
      merchant_name: 'ç”¨æˆ·æš‚æœªæä¾›',
      legal_name: 'ç”¨æˆ·æš‚æœªæä¾›',
      company_name: 'ç”¨æˆ·æš‚æœªæä¾›',
      bank_name: 'ç”¨æˆ·æš‚æœªæä¾›',
      contact_phone: 'ç”¨æˆ·æš‚æœªæä¾›',
    }
    if (negativeFieldMap[currentField.key]) {
      finalValue = negativeFieldMap[currentField.key]
    }
  }

  // 6.1 å¤„ç½šç±»å‹è¿½é—®ï¼šäº†è§£æ—¶é—´çº¿å’Œå½±å“
  if (currentField.key === 'problem_type' && !d._problem_followup_asked) {
    d._problem_followup_asked = true
    d[currentField.key] = finalValue
    let followup = `æ”¶åˆ°ï¼Œæ‚¨é‡åˆ°çš„æ˜¯ã€Œ${finalValue}ã€ã€‚\n\nä¸ºäº†æ›´å¥½åœ°å¸®æ‚¨åˆ¶å®šç”³è¯‰ç­–ç•¥ï¼Œå†äº†è§£ä¸¤ä¸ªå…³é”®ä¿¡æ¯ï¼š\n\nâ‘  å¤§æ¦‚æ˜¯ä»€ä¹ˆæ—¶å€™æ”¶åˆ°çš„å¤„ç½šé€šçŸ¥ï¼Ÿï¼ˆæ¯”å¦‚ï¼šæ˜¨å¤©ã€ä¸Šå‘¨ã€ä¸€ä¸ªæœˆå‰ï¼‰\nâ‘¡ `
    if (/å†»ç»“/.test(finalValue)) followup += 'å¤§æ¦‚å†»ç»“äº†å¤šå°‘èµ„é‡‘ï¼Ÿè¿™ä¼šå½±å“ç”³è¯‰çš„ä¼˜å…ˆçº§å’Œç­–ç•¥ã€‚'
    else if (/å°ç¦/.test(finalValue)) followup += 'å°ç¦å‰å•†æˆ·å·ä½¿ç”¨äº†å¤šé•¿æ—¶é—´ï¼Ÿæ—¥å‡äº¤æ˜“é¢å¤§æ¦‚å¤šå°‘ï¼Ÿ'
    else if (/å…³é—­/.test(finalValue)) followup += 'å…³é—­å‰æ¯å¤©å¤§æ¦‚æœ‰å¤šå°‘ç¬”æ”¶æ¬¾ï¼Ÿå¯¹æ‚¨çš„ç»è¥å½±å“å¤§å—ï¼Ÿ'
    else followup += 'ç›®å‰å¯¹æ‚¨çš„ç»è¥å½±å“å¤§å—ï¼Ÿ'
    followup += '\n\nï¼ˆç®€å•è¯´è¯´å°±è¡Œï¼Œè¿™äº›ä¿¡æ¯ä¼šè®©ç”³è¯‰ææ–™æ›´æœ‰é’ˆå¯¹æ€§~ï¼‰'
    const infoUpdate = { key: currentField.key, label: currentField.label, value: finalValue, group: currentField.group, icon: currentField.icon }
    return { response: followup, nextStep: step, collectedData: d, infoUpdate, needDeepSeek: false, allCollected: false }
  }
  // ï¼ˆå¤„ç½šç±»å‹è¿½é—®çš„å›ç­”å·²åœ¨ section 3.88 æå‰å¤„ç†ï¼Œæ­¤å¤„ä¸å†é‡å¤ï¼‰

  // 6.2 ç”³è¯‰å†å²è¿½é—®ï¼šåªè¦æœ‰è¿‡ç”³è¯‰ç»å†å°±è¿½é—®è¯¦æƒ…
  if (currentField.key === 'appeal_history' && !d._appeal_followup_asked && /æœ‰|ç”³è¯‰è¿‡|æäº¤è¿‡|è¯•è¿‡|é©³å›|æ‹’ç»|å¤±è´¥|ä¸é€šè¿‡|è¢«æ‹’/.test(finalValue) && !/æ²¡|æ— |å¦|é¦–æ¬¡|ç¬¬ä¸€æ¬¡|N\/A/.test(finalValue)) {
    d._appeal_followup_asked = true
    d[currentField.key] = finalValue
    const infoUpdate = { key: currentField.key, label: currentField.label, value: finalValue, group: currentField.group, icon: currentField.icon }
    let followup = `äº†è§£äº†ï¼Œä¹‹å‰æœ‰ç”³è¯‰è¿‡ã€‚è¿™ä¸ªä¿¡æ¯å¾ˆå…³é”®ï¼\n\nè¯·å¸®æˆ‘è¡¥å……ä¸€ä¸‹ï¼š\n\nâ‘  ä¸€å…±ç”³è¯‰è¿‡å‡ æ¬¡ï¼Ÿ\nâ‘¡ æœ€è¿‘ä¸€æ¬¡çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆé€šè¿‡/é©³å›/ç­‰å¾…ä¸­ï¼‰\nâ‘¢ å¦‚æœè¢«é©³å›è¿‡ï¼Œè¿˜è®°å¾—é©³å›åŸå› å—ï¼Ÿ\n\nï¼ˆç®€å•è¯´è¯´å°±è¡Œï¼Œè¿™äº›ä¿¡æ¯ä¼šç›´æ¥å½±å“æ–°çš„ç”³è¯‰ç­–ç•¥~ï¼‰`
    return { response: followup, nextStep: step, collectedData: d, infoUpdate, needDeepSeek: false, allCollected: false }
  }
  if (currentField.key === 'appeal_history' && d._appeal_followup_asked) {
    delete d._appeal_followup_asked
    d._appeal_reject_reason = finalValue  // ä¿å­˜é©³å›åŸå› 
    const rawNext = step + 1
    const nextS = findNextUnfilledStep(rawNext, d)
    if (nextS >= TOTAL_STEPS) return { response: 'âœ… æ„Ÿè°¢ï¼', nextStep: nextS, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: true }
    const nf = INFO_FIELDS[nextS]
    let tip = ''
    if (!/ä¸è®°å¾—|ä¸çŸ¥é“|å¿˜äº†/.test(finalValue)) tip = '\n\nğŸ’¡ æœ‰äº†é©³å›åŸå› ï¼Œæˆ‘ä¼šåœ¨æ–°çš„ç”³è¯‰ææ–™ä¸­é’ˆå¯¹æ€§åœ°è¡¥å¼ºè¿™äº›è–„å¼±ç‚¹ã€‚'
    return { response: `æ˜ç™½äº†ï¼Œæˆ‘è®°ä¸‹äº†ã€‚${tip}\n\n${nf.question}`, nextStep: nextS, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
  }

  // 6.3 æŠ•è¯‰æƒ…å†µè¿½é—®ï¼šå›ç­”ã€Œæœ‰ã€ä½†æ²¡ç»™è¯¦æƒ…æ—¶ï¼Œè¿½é—®å…³é”®ä¿¡æ¯
  if (currentField.key === 'complaint_status' && !d._complaint_followup_asked && /æœ‰|å­˜åœ¨/.test(finalValue) && !/æ²¡|æ— |å¦|0/.test(finalValue) && finalValue.length < 15) {
    d._complaint_followup_asked = true
    d[currentField.key] = finalValue
    const infoUpdate = { key: currentField.key, label: currentField.label, value: 'æœ‰æœªå¤„ç†æŠ•è¯‰', group: currentField.group, icon: currentField.icon }
    const followup = `æ”¶åˆ°ï¼æœ‰æŠ•è¯‰çš„è¯ï¼Œå¤„ç†çŠ¶æ€ä¼šç›´æ¥å½±å“ç”³è¯‰ç»“æœã€‚è¯·è¡¥å……ä¸€ä¸‹ï¼š\n\nâ‘  å¤§æ¦‚æœ‰å‡ ä¸ªæœªå¤„ç†æŠ•è¯‰ï¼Ÿ\nâ‘¡ æŠ•è¯‰åŸå› ä¸»è¦æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆé€€æ¬¾çº çº·/æœåŠ¡ä¸æ»¡æ„/æœªæ”¶åˆ°è´§ç­‰ï¼‰\nâ‘¢ ç›®å‰æœ‰åœ¨å¤„ç†å—ï¼Ÿ\n\nâš ï¸ é‡è¦æç¤ºï¼šå»ºè®®å…ˆ100%å¤„ç†å®ŒæŠ•è¯‰å†æäº¤ç”³è¯‰ï¼ŒæŠ•è¯‰ç‡è¿‡é«˜ä¼šç›´æ¥è¢«é©³å›ã€‚`
    return { response: followup, nextStep: step, collectedData: d, infoUpdate, needDeepSeek: false, allCollected: false }
  }
  if (currentField.key === 'complaint_status' && d._complaint_followup_asked) {
    delete d._complaint_followup_asked
    d[currentField.key] = `æœ‰æœªå¤„ç†æŠ•è¯‰ï¼š${finalValue}`
    const rawNext = step + 1
    const nextS = findNextUnfilledStep(rawNext, d)
    const iu = { key: currentField.key, label: currentField.label, value: d[currentField.key], group: currentField.group, icon: currentField.icon }
    if (nextS >= TOTAL_STEPS) return { response: 'âœ… æŠ•è¯‰è¯¦æƒ…å·²è®°å½•ï¼', nextStep: nextS, collectedData: d, infoUpdate: iu, needDeepSeek: false, allCollected: true }
    const nf = INFO_FIELDS[nextS]
    return { response: `æ„Ÿè°¢è¡¥å……ï¼æŠ•è¯‰è¯¦æƒ…å·²è®°å½•ï¼Œæˆ‘ä¼šåœ¨ç”³è¯‰ææ–™ä¸­é’ˆå¯¹æ€§åœ°åˆ¶å®šæŠ•è¯‰å¤„ç†æ–¹æ¡ˆã€‚\n\n${nf.question}`, nextStep: nextS, collectedData: d, infoUpdate: iu, needDeepSeek: false, allCollected: false }
  }

  // 6.5 è¡Œä¸šå­—æ®µæ™ºèƒ½è¿½é—®ï¼šæ¨¡ç³Šå›ç­” / æ•æ„Ÿè¡Œä¸šæ£€æµ‹
  if (currentField.key === 'industry') {
    // å¦‚æœæ˜¯è¿½é—®åçš„ç¬¬äºŒæ¬¡å›ç­”ï¼Œåˆå¹¶ä¿¡æ¯ç»§ç»­
    if (d._industry_detail_asked) {
      delete d._industry_detail_asked
      // åˆå¹¶ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡çš„å›ç­”
      const firstAnswer = d._industry_first_answer || ''
      delete d._industry_first_answer
      finalValue = firstAnswer ? `${firstAnswer}ï¼ˆ${finalValue}ï¼‰` : finalValue
      // æ•æ„Ÿè¡Œä¸šè¿½é—®åï¼Œå†æ£€æµ‹ä¸€æ¬¡ï¼Œè®°å½•é£é™©æ ‡è®°
      const sensitive = matchSensitiveIndustry(finalValue)
      if (sensitive) {
        d._sensitive_industry = sensitive.category
        d._sensitive_risk = sensitive.risk
      }
    } else {
      // ç¬¬ä¸€æ¬¡å›ç­”ï¼šæ£€æµ‹æ•æ„Ÿè¡Œä¸š
      const sensitive = matchSensitiveIndustry(finalValue)
      if (sensitive) {
        d._industry_detail_asked = true
        d._industry_first_answer = finalValue
        d._sensitive_industry = sensitive.category
        d._sensitive_risk = sensitive.risk
        const response = `âš ï¸ æ£€æµ‹åˆ°æ‚¨çš„ä¸šåŠ¡å¯èƒ½å±äºã€Œ${sensitive.category}ã€ï¼Œé£é™©ç­‰çº§ï¼š${sensitive.risk}\n\n${sensitive.warning}\n\n${sensitive.followup}\n\nğŸ’¡ è¯·å¦‚å®æè¿°ï¼Œæˆ‘ä¼šæ ¹æ®å®é™…æƒ…å†µç»™æ‚¨æœ€ä¸“ä¸šçš„ç”³è¯‰å»ºè®®ã€‚å³ä½¿æ˜¯é«˜é£é™©ç±»ç›®ï¼Œåªè¦ä¸šåŠ¡åˆè§„ï¼Œä¹Ÿæœ‰ç”³è¯‰æˆåŠŸçš„æ¡ˆä¾‹~`
        return { response, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
      }
      // æ£€æµ‹æ¨¡ç³Šå›ç­”
      if (isVagueIndustry(finalValue)) {
        d._industry_detail_asked = true
        d._industry_first_answer = finalValue
        const response = getVagueFollowup(finalValue)
        return { response, nextStep: step, collectedData: d, infoUpdate: null, needDeepSeek: false, allCollected: false }
      }
    }
  }

  // 7. æ­£å¸¸æ”¶é›†ä¿¡æ¯ï¼ˆå…ˆåšæ™ºèƒ½æ ‡å‡†åŒ–ï¼‰
  finalValue = normalizeFieldValue(currentField.key, finalValue, d)
  // ä¿å­˜åŸå§‹è¾“å…¥ç”¨äºåç»­æ¨æ–­ï¼ˆå¦‚ä» "æˆ‘åœ¨å°ç¨‹åºä¸Šå–ç›²ç›’" æ¨æ–­ç»è¥æ¨¡å¼ï¼‰
  if (currentField.key === 'industry') d._raw_industry = msg
  d[currentField.key] = finalValue

  // 7.5 [å·²ç§»é™¤æœ¬åœ°è‡ªåŠ¨æ¨æ–­] å­—æ®µæ¨æ–­ç»Ÿä¸€ç”±DeepSeek APIå®Œæˆ

  const rawNextStep = step + 1
  const nextStep = findNextUnfilledStep(rawNextStep, d)
  const infoUpdate = { key: currentField.key, label: currentField.label, value: finalValue, group: currentField.group, icon: currentField.icon }
  const allInfoUpdates = [infoUpdate]
  const autoFilledFields = [] // è‡ªåŠ¨æ¨æ–­å·²ç§»è‡³DeepSeek APIï¼Œæœ¬åœ°ä¿ç•™ç©ºæ•°ç»„å…¼å®¹
  const allAutoFields = autoFilledFields
  const reasons = {}

  // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨æ”¶é›†å®Œæ¯•
  if (nextStep >= TOTAL_STEPS) {
    // ç”Ÿæˆæ•°æ®æ‘˜è¦è®©ç”¨æˆ·ç¡®è®¤ï¼ˆå¸¦è´¨é‡æ ‡æ³¨ï¼‰
    let dataSummary = ''
    const fieldLabels = { problem_type: 'å¤„ç½šç±»å‹', violation_reason: 'è¿è§„åŸå› ', merchant_id: 'å•†æˆ·å·', merchant_name: 'å•†æˆ·åç§°', company_name: 'å…¬å¸å…¨ç§°', license_no: 'ä¿¡ç”¨ä»£ç ', legal_name: 'æ³•äººå§“å', legal_id_last4: 'èº«ä»½è¯åå››ä½', industry: 'æ‰€å±è¡Œä¸š', business_model: 'ç»è¥æ¨¡å¼', complaint_status: 'æŠ•è¯‰æƒ…å†µ', refund_policy: 'é€€æ¬¾æ”¿ç­–', bank_name: 'å¼€æˆ·é“¶è¡Œ', bank_account_last4: 'è´¦æˆ·åå››ä½', contact_phone: 'è”ç³»ç”µè¯', appeal_history: 'ç”³è¯‰å†å²' }
    let idx = 1
    const pendingFields = []
    const essentialFields = ['problem_type', 'violation_reason', 'merchant_id', 'company_name', 'legal_name', 'contact_phone']
    for (const [key, value] of Object.entries(d)) {
      if (value && value.trim() && fieldLabels[key]) {
        const display = value.length > 20 ? value.slice(0, 20) + '...' : value
        const isPending = value.includes('â³å¾…è¡¥å……') || value === 'ç”¨æˆ·æš‚æœªæä¾›'
        if (isPending) {
          dataSummary += `${idx}. ${fieldLabels[key]}ï¼šâš ï¸ ${display}ï¼ˆéœ€è¡¥å……ï¼‰\n`
          pendingFields.push(fieldLabels[key])
        } else {
          dataSummary += `${idx}. ${fieldLabels[key]}ï¼š${display}\n`
        }
        idx++
      }
    }
    // å®Œæ•´åº¦è¯„åˆ†
    const totalFields = Object.keys(fieldLabels).length
    const filledCount = totalFields - pendingFields.length
    let qualityNote = ''
    if (pendingFields.length > 0) {
      const isEssentialMissing = pendingFields.some(f => essentialFields.some(e => fieldLabels[e] === f))
      qualityNote = `\n\nâš ï¸ æœ‰${pendingFields.length}é¡¹å¾…è¡¥å……ï¼š${pendingFields.join('ã€')}ã€‚\n${isEssentialMissing ? 'ğŸ”´ å…¶ä¸­åŒ…å«å…³é”®å¿…å¡«é¡¹ï¼Œç¼ºå°‘ä¼šä¸¥é‡å½±å“ç”³è¯‰æˆåŠŸç‡ï¼è¯·å°½å¿«åœ¨å³ä¾§é¢æ¿è¡¥å……ã€‚' : 'ğŸ’¡ è¿™äº›ä¿¡æ¯ä¸å½±å“æŠ¥å‘Šç”Ÿæˆï¼Œä½†è¡¥å……åç”³è¯‰ææ–™ä¼šæ›´å®Œæ•´ã€‚'}`
    }
    // é£é™©è¯„ä¼°
    const risk = assessRisk(d)
    let riskSection = `\n\nğŸ“Š åˆæ­¥é£é™©è¯„ä¼°ï¼š\n\néš¾åº¦ç­‰çº§ï¼š${risk.level}ï¼ˆè¯„åˆ†${risk.riskScore}/100ï¼‰\né¢„ä¼°æˆåŠŸç‡ï¼š${risk.successRate}\n`
    if (risk.factors.length > 0) riskSection += `å…³é”®å› ç´ ï¼š${risk.factors.join('ï¼›')}\n`
    if (risk.tips.length > 0) riskSection += `\nâš¡ é‡è¦æç¤ºï¼š\n${risk.tips.map((t, i) => `${i + 1}. ${t}`).join('\n')}\n`

    // åŒ¹é…å†…ç½®æˆåŠŸæ¡ˆä¾‹
    const matchedCases = matchBuiltInCases(d.problem_type, d.industry, d.violation_reason)
    let caseSection = ''
    if (matchedCases.length > 0) {
      caseSection = `\n\nğŸ“š ç±»ä¼¼æˆåŠŸæ¡ˆä¾‹å‚è€ƒï¼š\n${matchedCases.map(c => `ğŸ“Œ ${c.title} â€” ${c.success_summary}`).join('\n')}\n`
    }

    // ææ–™æ¸…å•
    const checklist = generateMaterialChecklist(d)
    const requiredItems = checklist.filter(c => c.required)
    let checklistSection = `\n\nğŸ“‹ æ‚¨éœ€è¦å‡†å¤‡çš„ææ–™æ¸…å•ï¼ˆå…±${requiredItems.length}é¡¹å¿…éœ€ï¼‰ï¼š\n`
    const groups = {}
    requiredItems.forEach(c => { if (!groups[c.category]) groups[c.category] = []; groups[c.category].push(c.item) })
    for (const [cat, items] of Object.entries(groups)) {
      checklistSection += `\n${cat}ï¼š\n${items.map(i => `â˜ ${i}`).join('\n')}\n`
    }

    const response = `âœ… ä¿¡æ¯æ”¶é›†å®Œæ¯•ï¼\n\næ‚¨æä¾›çš„æ‰€æœ‰ä¿¡æ¯å·²ç»è®°å½•å®Œæˆï¼ˆå…±${TOTAL_STEPS}é¡¹ï¼‰ï¼š\n\n${dataSummary}${qualityNote}${riskSection}${caseSection}${checklistSection}\nğŸ”’ ä»¥ä¸Šæ•°æ®ä»…ç”¨äºæœ¬æ¬¡ç”Ÿæˆç”³è¯‰ææ–™ï¼Œå¯¹è¯ç»“æŸåä¸ä¼šç”¨äºå…¶ä»–ç”¨é€”ã€‚\n\nâ³ æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆä¸“ä¸šçš„è¯„ä¼°æŠ¥å‘Šå’Œç”³è¯‰ææ–™ï¼Œè¯·ç¨å€™...`
    return { response, nextStep, collectedData: d, infoUpdate: allInfoUpdates, needDeepSeek: false, allCollected: true }
  }

  // è¿˜æœ‰ä¸‹ä¸€ä¸ªé—®é¢˜
  const nextField = INFO_FIELDS[nextStep]
  // è‡ªç„¶è¿‡æ¸¡è¯­ï¼ˆå–ä»£æœºæ¢°çš„[X/16]æ ¼å¼ï¼‰
  const progressPct = Math.round((nextStep / TOTAL_STEPS) * 100)
  let progress = ''

  // ===== ç‰¹æ®Šå¤„ç†ï¼šä¸šåŠ¡äº†è§£é˜¶æ®µç»“æŸåï¼ŒAIä¸»åŠ¨ç¡®è®¤ç†è§£ =====
  // å½“ business_model æ˜¯å½“å‰æ­£åœ¨å›ç­”çš„å­—æ®µï¼ˆéè‡ªåŠ¨æ¨æ–­ï¼‰æ—¶æ˜¾ç¤ºä¸šåŠ¡æ€»ç»“
  if (currentField.key === 'business_model' && d.industry) {
    const ind = matchIndustry(d.industry)
    let bizSummary = ''
    if (ind) {
      bizSummary = `\n\nğŸ¯ æˆ‘å¯¹æ‚¨ä¸šåŠ¡çš„ç†è§£ï¼š\n\næ‚¨æ˜¯åš${ind.key}ç›¸å…³ä¸šåŠ¡çš„ï¼Œç»è¥æ¨¡å¼æ˜¯${d.business_model}ã€‚\n${ind.appealTips ? `\nğŸ’¡ ${ind.key}è¡Œä¸šç”³è¯‰è¦ç‚¹ï¼š${ind.appealTips}` : ''}`
    } else {
      bizSummary = `\n\nğŸ¯ æˆ‘å¯¹æ‚¨ä¸šåŠ¡çš„ç†è§£ï¼š\n\næ‚¨çš„ä¸šåŠ¡æ˜¯ï¼š${d.industry}ï¼Œç»è¥æ¨¡å¼æ˜¯${d.business_model}ã€‚\n\nğŸ’¡ æˆ‘ä¼šæ ¹æ®æ‚¨çš„å…·ä½“ä¸šåŠ¡ç±»å‹æ¥å®šåˆ¶ç”³è¯‰ç­–ç•¥ã€‚`
    }

    const confirm = generateConfirmation(currentField.key, finalValue, msg, d)
    const response = `${confirm}${bizSummary}\n\nå¥½çš„ï¼Œæˆ‘å·²ç»äº†è§£äº†æ‚¨çš„ä¸šåŠ¡æƒ…å†µï¼ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ã€‚\n\n${nextField.question}`
    return { response, nextStep, collectedData: d, infoUpdate: allInfoUpdates, needDeepSeek: false, allCollected: false }
  }

  // ===== ç‰¹æ®Šå¤„ç†ï¼šindustry å›ç­”åå¦‚æœ business_model è¢«è‡ªåŠ¨æ¨æ–­ï¼Œæ˜¾ç¤ºä¸šåŠ¡æ€»ç»“ =====
  if (currentField.key === 'industry' && d.business_model && autoFilledFields.some(f => f.key === 'business_model')) {
    const ind = matchIndustry(d.industry)
    let bizSummary = ''
    const autoFillNote = `\n\nğŸ¤– å·²è‡ªåŠ¨è¯†åˆ«ï¼šç»è¥æ¨¡å¼ â†’ ${d.business_model}ï¼ˆ${reasons.business_model || 'æ ¹æ®è¡Œä¸šåˆ¤æ–­'}ï¼‰\nå¦‚æœä¸å¯¹ï¼Œå¯ä»¥åœ¨å³ä¾§é¢æ¿ç‚¹å‡»ä¿®æ”¹~`
    if (ind) {
      bizSummary = `\n\nğŸ¯ æˆ‘å¯¹æ‚¨ä¸šåŠ¡çš„ç†è§£ï¼š\n\næ‚¨æ˜¯åš${ind.key}ç›¸å…³ä¸šåŠ¡çš„ã€‚\n${ind.appealTips ? `ğŸ’¡ ${ind.key}è¡Œä¸šç”³è¯‰è¦ç‚¹ï¼š${ind.appealTips}` : ''}`
    } else {
      bizSummary = `\n\nğŸ’¡ æˆ‘ä¼šæ ¹æ®æ‚¨çš„å…·ä½“ä¸šåŠ¡ç±»å‹æ¥å®šåˆ¶ç”³è¯‰ç­–ç•¥ã€‚`
    }

    const confirm = generateConfirmation(currentField.key, finalValue, msg, d)
    const response = `${confirm}${autoFillNote}${bizSummary}\n\nå¥½çš„ï¼Œä¸šåŠ¡æƒ…å†µå·²äº†è§£ï¼æ¥ä¸‹æ¥çœ‹çœ‹é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ã€‚\n\n${nextField.question}`
    return { response, nextStep, collectedData: d, infoUpdate: allInfoUpdates, needDeepSeek: false, allCollected: false }
  }

  // ç”Ÿæˆç¡®è®¤ + ä¸‹ä¸€ä¸ªé—®é¢˜ï¼ˆæ ¹æ®å·²çŸ¥ä¸šåŠ¡ç±»å‹æ™ºèƒ½è°ƒæ•´æªè¾ï¼‰
  let confirm = generateConfirmation(currentField.key, finalValue, msg, d)
  let nextQuestion = nextField.question

  // æ ¹æ®å·²çŸ¥ä¿¡æ¯å®šåˆ¶åç»­é—®é¢˜æªè¾ï¼ˆè®©ç”¨æˆ·æ„Ÿè§‰AIçœŸæ­£ç†è§£äº†æƒ…å†µï¼‰
  if (d.industry && nextField.key === 'complaint_status') {
    const ind = matchIndustry(d.industry)
    if (ind && ind.commonViolations.length > 0) {
      nextQuestion = `ğŸ“¢ ç›®å‰æœ‰æ²¡æœ‰æœªå¤„ç†çš„æ¶ˆè´¹è€…æŠ•è¯‰ï¼Ÿ\n\n${ind.key}è¡Œä¸šå¸¸è§çš„æŠ•è¯‰ç±»å‹æœ‰ï¼š${ind.commonViolations.join('ã€')}ã€‚\n\næ²¡æœ‰çš„è¯ç›´æ¥è¯´"æ²¡æœ‰"å³å¯ã€‚`
    }
  }
  if (d.industry && nextField.key === 'violation_reason') {
    const ind = matchIndustry(d.industry)
    if (ind && ind.commonViolations.length > 0) {
      nextQuestion = `ğŸ“‹ å¾®ä¿¡å®˜æ–¹ç»™å‡ºçš„å…·ä½“è¿è§„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ\n\nğŸ’¡ ${ind.key}è¡Œä¸šå¸¸è§è¿è§„åŒ…æ‹¬ï¼š${ind.commonViolations.join('ã€')}\n\nè¯·æ‰“å¼€ã€Œå¾®ä¿¡æ”¯ä»˜å•†å®¶åŠ©æ‰‹ã€â†’ é£é™©å¤„ç† â†’ åŠŸèƒ½é™åˆ¶è®°å½•ï¼ŒæŠŠåŸå› å¤åˆ¶ç»™æˆ‘~`
    }
  }
  if (d.problem_type && /å†»ç»“/.test(d.problem_type) && nextField.key === 'bank_name') {
    nextQuestion = `ğŸ¦ è¯·æä¾›æ‚¨çš„ç»“ç®—è´¦æˆ·å¼€æˆ·é“¶è¡Œåç§°ï¼ˆå¦‚ï¼šå·¥å•†é“¶è¡Œã€æ‹›å•†é“¶è¡Œç­‰ï¼‰~\n\nâš ï¸ èµ„é‡‘å†»ç»“æ¡ˆä»¶ç‰¹åˆ«é‡è¦ï¼šæ‹¨æ‰“95017è½¬3æ—¶éœ€è¦æä¾›å•†æˆ·å·+ç»“ç®—è´¦æˆ·åå››ä½è¿›è¡Œèº«ä»½éªŒè¯å’Œå‚¬å®¡ã€‚`
  }
  if (d.problem_type && /å†»ç»“/.test(d.problem_type) && nextField.key === 'bank_account_last4') {
    nextQuestion = `ğŸ’³ è¯·æä¾›æ‚¨çš„ç»“ç®—è´¦æˆ·å·åå››ä½~\n\nâš ï¸ èµ„é‡‘å†»ç»“æ¡ˆä»¶ï¼šè¿™ä¸ªä¿¡æ¯æ˜¯æ‹¨æ‰“95017å‚¬å®¡çš„å¿…å¤‡éªŒè¯ä¿¡æ¯ï¼`
  }

  // è‡ªç„¶è¿‡æ¸¡è¯­ + é˜¶æ®µæ€§åˆ†æï¼ˆåƒé¡¾é—®ä¸€æ ·ç»™åé¦ˆï¼‰
  let encouragement = ''
  if (nextStep === 4) {
    const ptTip = d.problem_type ? `æ ¹æ®æ‚¨çš„æƒ…å†µï¼ˆ${d.problem_type}ï¼‰ï¼Œ` : ''
    encouragement = `\n\n${ptTip}æ¥ä¸‹æ¥æˆ‘éœ€è¦æ‚¨çš„ä¸€äº›åŸºæœ¬è¯ä»¶ä¿¡æ¯ï¼Œè¿™äº›åœ¨ç”³è¯‰ææ–™ä¸­æ˜¯å¿…éœ€çš„ã€‚`
  } else if (nextStep === 8) {
    // è¿‡åŠæ—¶ç»™é˜¶æ®µæ€§åˆ†æ
    const risk = assessRisk(d)
    let midAnalysis = ''
    if (risk && d.problem_type) {
      midAnalysis = `\n\nğŸ“Š é˜¶æ®µåˆ†æï¼šåŸºäºç›®å‰ä¿¡æ¯ï¼Œæ‚¨çš„æ¡ˆä»¶éš¾åº¦${risk.level}ï¼Œé¢„ä¼°æˆåŠŸç‡${risk.successRate}ã€‚æˆ‘ä»¬ç»§ç»­å®Œå–„ä¿¡æ¯ï¼Œæœ€ç»ˆæŠ¥å‘Šä¼šæ›´ç²¾å‡†ã€‚`
    }
    encouragement = midAnalysis || '\n\nåŸºæœ¬ä¿¡æ¯å·®ä¸å¤šäº†ï¼Œå†äº†è§£å‡ ä¸ªç»è¥ç»†èŠ‚å°±å¯ä»¥ä¸ºæ‚¨ç”ŸæˆæŠ¥å‘Šäº†ã€‚'
  } else if (nextStep === 12) {
    const remaining = TOTAL_STEPS - nextStep
    encouragement = `\n\nå¿«è¦å®Œæˆäº†ï¼Œè¿˜æœ‰${remaining}ä¸ªé—®é¢˜~`
  } else if (nextStep === 15) {
    encouragement = '\n\næœ€åä¸€ä¸ªé—®é¢˜ï¼ä¹‹åæˆ‘å°±å¯ä»¥ä¸ºæ‚¨ç”Ÿæˆä¸“ä¸šçš„ç”³è¯‰æŠ¥å‘Šäº†ã€‚'
  }

  // å¦‚æœæœ‰è‡ªåŠ¨æ¨æ–­/æå–çš„å­—æ®µï¼Œåœ¨ç¡®è®¤æ¶ˆæ¯ä¸­æç¤º
  let autoFillNote = ''
  if (allAutoFields.length > 0) {
    const parts = allAutoFields.map(f => `${f.label} â†’ ${f.value}ï¼ˆ${f.reason}ï¼‰`)
    autoFillNote = `\n\nğŸ¤– å·²è‡ªåŠ¨è¯†åˆ«ï¼š${parts.join('ã€')}\nå¦‚æœä¸å¯¹ï¼Œå¯ä»¥åœ¨å³ä¾§é¢æ¿ä¿®æ”¹~`
  }

  const response = `${confirm}${autoFillNote}${encouragement}\n\n${nextQuestion}`

  return { response, nextStep, collectedData: d, infoUpdate: allInfoUpdates, needDeepSeek: false, allCollected: false }
}

// æ ¹æ®å­—æ®µç±»å‹ç”Ÿæˆä¸ªæ€§åŒ–ç¡®è®¤å›å¤ï¼ˆvalue = finalValue after normalization, data = å·²æ”¶é›†æ•°æ®ä¸Šä¸‹æ–‡ï¼‰
function generateConfirmation(key, value, rawInput, data = {}) {
  const v = value.trim()
  const raw = (rawInput || v).trim()
  const wasNormalized = v !== raw // æ˜¯å¦ç»è¿‡äº†æ ‡å‡†åŒ–

  switch (key) {
    case 'problem_type': {
      const vl = v.toLowerCase()
      let tip = ''
      if (vl.includes('å†»ç»“')) tip = 'èµ„é‡‘å†»ç»“æ˜¯è¾ƒä¸¥é‡çš„å¤„ç½šï¼Œä½†é€šè¿‡ä¸“ä¸šç”³è¯‰ä»æœ‰å¾ˆå¤§æ¢å¤ç©ºé—´ã€‚å»ºè®®åŒæ—¶æ‹¨æ‰“95017è½¬3å‚¬å®¡ã€‚'
      else if (vl.includes('å…³é—­') || vl.includes('æ— æ³•æ”¶æ¬¾')) tip = 'æ”¯ä»˜æƒé™å…³é—­å½±å“è¾ƒå¤§ï¼Œä½†è¿™ç±»æ¡ˆä»¶ç”³è¯‰æ¢å¤æˆåŠŸç‡è¾ƒé«˜ã€‚'
      else if (vl.includes('é™é¢') || vl.includes('é™åˆ¶')) tip = 'æ”¶æ¬¾é™é¢æ˜¯å¸¸è§å¤„ç½šï¼Œé€šå¸¸æ˜¯é£æ§è‡ªåŠ¨è§¦å‘ï¼Œç”³è¯‰ç›¸å¯¹å¥½å¤„ç†ã€‚'
      else if (vl.includes('æ‹¦æˆª')) tip = 'äº¤æ˜“æ‹¦æˆªé€šå¸¸æ˜¯é˜¶æ®µæ€§é£æ§æªæ–½ï¼ŒåŠæ—¶ç”³è¯‰ä¸€èˆ¬éƒ½èƒ½è§£å†³ã€‚'
      else if (vl.includes('å°ç¦')) tip = 'å•†æˆ·å·å°ç¦æ˜¯æœ€ä¸¥é‡çš„å¤„ç½šï¼Œéœ€è¦å‡†å¤‡éå¸¸å……åˆ†çš„ææ–™ï¼Œå¯èƒ½éœ€è¦æ³•äººè§†é¢‘è®¤è¯ã€‚'
      const normalized = wasNormalized ? `ï¼ˆå·²è¯†åˆ«ä¸ºï¼š${v}ï¼‰` : ''
      return `âœ… å¤„ç½šç±»å‹å·²è®°å½•ï¼š${v} ${normalized}\n${tip ? `\nğŸ’¡ ${tip}` : ''}`
    }
    case 'violation_reason': {
      const viol = matchViolation(v)
      const ind = data.industry ? matchIndustry(data.industry) : null
      let response = `âœ… å·²è®°å½•è¿è§„åŸå› ï¼šã€Œ${v.slice(0, 30)}${v.length > 30 ? '...' : ''}ã€`
      if (viol) {
        response += `\n\nğŸ’¡ ä¸“ä¸šåˆ†æï¼š${viol.description}\nğŸ“Š é¢„ä¼°æˆåŠŸç‡ï¼š${viol.estimated_success_rate}\nğŸ”‘ ç”³è¯‰å…³é”®ï¼š${viol.success_key}`
      }
      if (ind) {
        response += `\n\nâ„¹ï¸ ${ind.key}è¡Œä¸šç”³è¯‰è¦ç‚¹ï¼š${ind.appealTips}`
      }
      return response
    }
    case 'merchant_id':
      return `âœ… å•†æˆ·å·å·²è®°å½•ï¼š${v}${wasNormalized ? 'ï¼ˆå·²è‡ªåŠ¨æå–ï¼‰' : ''}`
    case 'merchant_name':
      return `âœ… å•†æˆ·åç§°å·²è®°å½•ï¼š${v}`
    case 'company_name':
      return `âœ… å…¬å¸åç§°å·²è®°å½•ï¼š${v}`
    case 'license_no':
      return `âœ… ä¿¡ç”¨ä»£ç å·²è®°å½•${v.length === 18 ? 'ï¼ˆ18ä½ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼‰' : ''}ã€‚`
    case 'legal_name':
      return `âœ… æ³•äººå§“åå·²è®°å½•ï¼š${v}`
    case 'legal_id_last4':
      return `âœ… èº«ä»½è¯åå››ä½å·²è®°å½•ï¼ˆ****${v}ï¼‰ã€‚${wasNormalized ? 'ï¼ˆå·²è‡ªåŠ¨æå–åå››ä½ï¼‰' : ''}`
    case 'industry': {
      const ind = matchIndustry(v)
      if (ind) return `ğŸ‘ æ˜ç™½äº†ï¼Œæ‚¨æ˜¯åš${ind.key}ç›¸å…³ä¸šåŠ¡çš„ï¼æˆ‘å¯¹è¿™ä¸ªè¡Œä¸šçš„ç”³è¯‰æ¡ˆä¾‹æ¯”è¾ƒç†Ÿæ‚‰~`
      return `ğŸ‘ æ˜ç™½äº†ï¼Œæ‚¨çš„ä¸šåŠ¡æ˜¯ï¼š${v}ã€‚æˆ‘ä¼šæ ¹æ®æ‚¨çš„å…·ä½“æƒ…å†µæ¥åˆ¶å®šç”³è¯‰æ–¹æ¡ˆã€‚`
    }
    case 'business_model':
      return `âœ… ç»è¥æ¨¡å¼å·²è®°å½•ã€‚`
    case 'complaint_status': {
      if (/æ²¡æœ‰|æ— |æš‚æ— /.test(v)) return `âœ… å¥½çš„ï¼Œå½“å‰æ²¡æœ‰æœªå¤„ç†æŠ•è¯‰ã€‚\n\nğŸ’¡ è¿™å¯¹ç”³è¯‰éå¸¸æœ‰åˆ©ï¼æŠ•è¯‰æ¸…é›¶æ˜¯ç”³è¯‰é€šè¿‡çš„é‡è¦æ¡ä»¶ä¹‹ä¸€ã€‚`
      return `âœ… æŠ•è¯‰æƒ…å†µå·²è®°å½•ã€‚\n\nâš ï¸ å»ºè®®ï¼šå¦‚æœæœ‰æœªå¤„ç†æŠ•è¯‰ï¼Œè¯·ä¼˜å…ˆå¤„ç†å®Œå†æäº¤ç”³è¯‰ï¼ŒæŠ•è¯‰ç‡è¿‡é«˜ä¼šç›´æ¥å½±å“ç”³è¯‰ç»“æœã€‚`
    }
    case 'refund_policy': {
      if (/æ²¡æœ‰|æš‚æ— /.test(v)) return `âœ… å·²è®°å½•ã€‚\n\nğŸ’¡ æ²¡å…³ç³»ï¼æˆ‘ä¼šåœ¨ç”³è¯‰ææ–™ä¸­å¸®æ‚¨æ‹Ÿå®šä¸€ä»½ä¸“ä¸šçš„é€€æ¬¾æ”¿ç­–ï¼Œè¿™æ˜¯ç”³è¯‰ææ–™çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚`
      return `âœ… é€€æ¬¾æ”¿ç­–å·²è®°å½•ã€‚`
    }
    case 'contact_phone':
      return `âœ… è”ç³»ç”µè¯å·²è®°å½•ï¼š${v}${wasNormalized ? 'ï¼ˆå·²è‡ªåŠ¨æå–ï¼‰' : ''}\n\nğŸ’¡ è¯·ä¿æŒç”µè¯ç•…é€šï¼Œå¾®ä¿¡å®¡æ ¸å¯èƒ½ä¼šç”µè¯å›è®¿ã€‚`
    case 'bank_name':
      return `âœ… å¼€æˆ·é“¶è¡Œå·²è®°å½•ï¼š${v}`
    case 'bank_account_last4':
      return `âœ… ç»“ç®—è´¦æˆ·åå››ä½å·²è®°å½•ï¼ˆ****${v}ï¼‰ã€‚${wasNormalized ? 'ï¼ˆå·²è‡ªåŠ¨æå–åå››ä½ï¼‰' : ''}`
    case 'appeal_history': {
      if (/é¦–æ¬¡|æ²¡æœ‰|æ— |æ²¡/.test(v)) return `âœ… é¦–æ¬¡ç”³è¯‰ã€‚\n\nğŸ’¡ é¦–æ¬¡ç”³è¯‰é€šå¸¸æˆåŠŸç‡æ›´é«˜ï¼Œå…³é”®æ˜¯ä¸€æ¬¡æ€§æŠŠææ–™å‡†å¤‡å……åˆ†ï¼`
      if (/é©³å›|æ‹’ç»|å¤±è´¥|ä¸é€šè¿‡/.test(v)) return `âœ… æœ‰è¢«é©³å›è®°å½•ã€‚\n\nâš ï¸ æ³¨æ„ï¼šäºŒæ¬¡ç”³è¯‰éœ€è¦æ¯”é¦–æ¬¡æ›´å……åˆ†çš„ææ–™ã€‚å»ºè®®å…ˆæ‹¨æ‰“95017è½¬3æŸ¥è¯¢å…·ä½“é©³å›åŸå› ï¼Œæˆ‘ä»¬ä¼šé’ˆå¯¹æ€§ä¼˜åŒ–ææ–™ã€‚`
      return `âœ… ç”³è¯‰å†å²å·²è®°å½•ã€‚`
    }
    default:
      return `âœ… å·²è®°å½•ã€‚`
  }
}

/**
 * æ„å»ºä¿¡æ¯æ”¶é›†é˜¶æ®µ DeepSeek çš„å¯Œä¸Šä¸‹æ–‡
 * è®© AI äº†è§£å®Œæ•´çš„æ”¶é›†è¿›åº¦ã€å·²æœ‰åˆ†æã€è¡Œä¸šçŸ¥è¯†ï¼Œä»è€ŒåƒçœŸäººé¡¾é—®ä¸€æ ·è‡ªç„¶å¯¹è¯
 */
export function buildCollectionContext(data, currentStep) {
  const collected = []
  const remaining = []

  for (let i = 0; i < INFO_FIELDS.length; i++) {
    const field = INFO_FIELDS[i]
    const value = data[field.key]
    if (value && String(value).trim() && !String(value).includes('â³å¾…è¡¥å……') && !String(value).includes('ç”¨æˆ·æš‚æœªæä¾›') && !String(value).includes('ç”¨æˆ·æœªæä¾›')) {
      collected.push(`â€¢ ${field.label}: ${value}`)
    } else {
      remaining.push(`â€¢ ${field.label} â€” ${field.question.split('\n')[0].replace(/^[^\s]*\s/, '')}`)
    }
  }

  let ctx = `\n\n===== ä¿¡æ¯æ”¶é›†è¿›åº¦ (${collected.length}/${INFO_FIELDS.length}) =====\n`
  if (collected.length > 0) {
    ctx += `\nã€å·²æ”¶é›†ã€‘\n${collected.join('\n')}\n`
  }
  if (remaining.length > 0) {
    const show = remaining.slice(0, 4)
    ctx += `\nã€å¾…æ”¶é›†ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ã€‘\n${show.join('\n')}\n`
    if (remaining.length > 4) ctx += `...è¿˜æœ‰${remaining.length - 4}é¡¹\n`
  }

  // é£é™©è¯„ä¼°
  if (data.problem_type) {
    const risk = assessRisk(data)
    if (risk) {
      ctx += `\nã€é£é™©è¯„ä¼°ã€‘éš¾åº¦: ${risk.level}(${risk.riskScore}/100)  æˆåŠŸç‡: ${risk.successRate}\n`
      if (risk.factors.length > 0) ctx += `å…³é”®å› ç´ : ${risk.factors.join('ï¼›')}\n`
    }
  }

  // è¡Œä¸šåˆ†æ
  if (data.industry) {
    const industry = matchIndustry(data.industry)
    if (industry) {
      ctx += `\nã€è¡Œä¸šåˆ†æã€‘${industry.key}\nç”³è¯‰è¦ç‚¹: ${industry.appealTips}\nå¸¸è§è¿è§„: ${industry.commonViolations?.join('ã€')}\n`
    }
    const sensitive = matchSensitiveIndustry(data.industry)
    if (sensitive) {
      ctx += `âš ï¸ æ•æ„Ÿè¡Œä¸š: ${sensitive.category}ï¼Œé£é™©: ${sensitive.risk}\n`
    }
  }

  // è¿è§„åˆ†æ
  if (data.violation_reason) {
    const violation = matchViolation(data.violation_reason)
    if (violation) {
      ctx += `\nã€è¿è§„åˆ†æã€‘${violation.key}: ${violation.description}\n`
      if (violation.appeal_key_points) ctx += `ç”³è¯‰å…³é”®: ${violation.appeal_key_points.join('ã€')}\n`
      if (violation.estimated_success_rate) ctx += `é¢„ä¼°æˆåŠŸç‡: ${violation.estimated_success_rate}\n`
    }
  }

  // å¾…æ”¶é›†å­—æ®µçš„è¯¦ç»†è¯´æ˜ï¼ˆå¸®åŠ©DeepSeekç†è§£æ¯ä¸ªå­—æ®µçš„é‡è¦æ€§å’Œå¦‚ä½•è‡ªç„¶åœ°è·å–ï¼‰
  const fieldGuide = {
    industry: 'è¡Œä¸šç±»å‹ â€” å†³å®šç”³è¯‰ç­–ç•¥æ–¹å‘ï¼Œä¸åŒè¡Œä¸šéœ€è¦çš„è¯æ˜ææ–™å®Œå…¨ä¸åŒã€‚è‡ªç„¶åœ°é—®"æ‚¨æ˜¯åšä»€ä¹ˆä¸šåŠ¡çš„"',
    business_model: 'ç»è¥æ¨¡å¼ â€” çº¿ä¸Š/çº¿ä¸‹/ç»“åˆï¼Œå½±å“äº¤æ˜“å‡­è¯å‡†å¤‡æ–¹å¼',
    problem_type: 'å¤„ç½šç±»å‹ â€” äº¤æ˜“æ‹¦æˆª/æ”¶æ¬¾é™é¢/æƒé™å…³é—­/èµ„é‡‘å†»ç»“/å°ç¦ï¼Œå†³å®šç”³è¯‰éš¾åº¦å’Œæ–¹æ¡ˆ',
    violation_reason: 'è¿è§„åŸå›  â€” å¾®ä¿¡å®˜æ–¹ç»™å‡ºçš„å¤„ç½šç†ç”±ï¼Œæ˜¯ç”³è¯‰ææ–™çš„æ ¸å¿ƒã€‚è®©ç”¨æˆ·åœ¨"å•†å®¶åŠ©æ‰‹â†’é£é™©å¤„ç†â†’åŠŸèƒ½é™åˆ¶è®°å½•"ä¸­æŸ¥çœ‹',
    merchant_id: 'å•†æˆ·å· â€” 10ä½æ•°å­—ï¼Œåœ¨pay.weixin.qq.comæˆ–å•†å®¶åŠ©æ‰‹å°ç¨‹åºä¸­æŸ¥çœ‹',
    merchant_name: 'å•†æˆ·åç§° â€” å¾®ä¿¡æ”¯ä»˜åå°æ˜¾ç¤ºçš„åç§°',
    company_name: 'å…¬å¸å…¨ç§° â€” è¥ä¸šæ‰§ç…§ä¸Šçš„åç§°',
    license_no: 'ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç  â€” 18ä½ï¼Œè¥ä¸šæ‰§ç…§ä¸Šçš„ç¼–ç ï¼ˆå¯è·³è¿‡ï¼‰',
    legal_name: 'æ³•äººå§“å â€” è¥ä¸šæ‰§ç…§ä¸Šçš„æ³•å®šä»£è¡¨äºº',
    legal_id_last4: 'èº«ä»½è¯å4ä½ â€” ç”¨äº95017å‚¬å®¡èº«ä»½éªŒè¯ï¼ˆåªéœ€å4ä½ï¼Œå¯è·³è¿‡ï¼‰',
    complaint_status: 'æŠ•è¯‰æƒ…å†µ â€” æ˜¯å¦æœ‰æœªå¤„ç†æŠ•è¯‰ï¼ŒæŠ•è¯‰ç‡å½±å“ç”³è¯‰æˆåŠŸç‡',
    refund_policy: 'é€€æ¬¾æ”¿ç­– â€” å•†æˆ·çš„é€€æ¬¾æµç¨‹ï¼Œæ²¡æœ‰çš„è¯AIä¼šå¸®æ‹Ÿå®š',
    bank_name: 'å¼€æˆ·é“¶è¡Œ â€” ç»“ç®—è´¦æˆ·çš„é“¶è¡Œåç§°ï¼Œèµ„é‡‘å†»ç»“æ¡ˆä»¶å¿…éœ€',
    bank_account_last4: 'ç»“ç®—è´¦æˆ·å4ä½ â€” æ‹¨æ‰“95017å‚¬å®¡çš„éªŒè¯ä¿¡æ¯ï¼ˆå¯è·³è¿‡ï¼‰',
    contact_phone: 'è”ç³»ç”µè¯ â€” å®¡æ ¸å¯èƒ½ç”µè¯å›è®¿',
    appeal_history: 'ç”³è¯‰å†å² â€” æ˜¯å¦ç”³è¯‰è¿‡ã€æ˜¯å¦è¢«é©³å›ï¼Œå½±å“äºŒæ¬¡ç”³è¯‰ç­–ç•¥',
  }

  // åªä¸ºå¾…æ”¶é›†çš„å­—æ®µæä¾›æŒ‡å—
  const remainingGuides = []
  for (let i = 0; i < INFO_FIELDS.length; i++) {
    const field = INFO_FIELDS[i]
    const value = data[field.key]
    if (!value || !String(value).trim() || String(value).includes('â³å¾…è¡¥å……') || String(value).includes('ç”¨æˆ·æœªæä¾›')) {
      if (fieldGuide[field.key]) remainingGuides.push(fieldGuide[field.key])
    }
  }
  if (remainingGuides.length > 0) {
    ctx += `\nã€å­—æ®µæ”¶é›†æŒ‡å—ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ã€‘\n${remainingGuides.slice(0, 5).join('\n')}\n`
  }

  ctx += `\n===== å¯¹è¯æŒ‡å¯¼ =====\n`
  ctx += `ä½ æ˜¯ä¸€ä½èµ„æ·±å¾®ä¿¡å•†æˆ·å·ç”³è¯‰é¡¾é—®ï¼ˆ5å¹´ç»éªŒï¼Œå¤„ç†è¿‡æ•°ç™¾èµ·æ¡ˆä»¶ï¼‰ï¼Œæ­£åœ¨ä¸å®¢æˆ·ä¸€å¯¹ä¸€å’¨è¯¢ã€‚\n`
  ctx += `æ ¸å¿ƒåŸåˆ™ï¼š\n`
  ctx += `1. æ¯æ¬¡å›å¤å…ˆç¡®è®¤åˆšè·å–çš„ä¿¡æ¯ï¼Œç»™å‡ºç›¸å…³çš„ä¸“ä¸šè§è§£ï¼Œå†è‡ªç„¶å¼•å¯¼ä¸‹ä¸€ä¸ªè¯é¢˜\n`
  ctx += `2. æ”¶é›†åˆ°è¡Œä¸š+å¤„ç½šç±»å‹+è¿è§„åŸå› åï¼Œå¿…é¡»ä¸»åŠ¨ç»™å‡ºåˆæ­¥é£é™©è¯„ä¼°å’ŒæˆåŠŸç‡åˆ¤æ–­\n`
  ctx += `3. æ¯æ¬¡åªå¼•å¯¼1-2ä¸ªä¿¡æ¯ï¼Œåƒä¸“ä¸šå’¨è¯¢ä¸åƒå¡«è¡¨\n`
  ctx += `4. ä¼˜å…ˆæ”¶é›†ï¼šè¡Œä¸šâ†’ç»è¥æ¨¡å¼â†’å¤„ç½šç±»å‹â†’è¿è§„åŸå› ï¼ˆè¿™4ä¸ªæ˜¯åˆ†æåŸºç¡€ï¼‰\n`
  ctx += `5. å¦‚æœç”¨æˆ·ä¸€æ¬¡æ€§æä¾›äº†å¤šä¸ªä¿¡æ¯ï¼Œå…¨éƒ¨ç¡®è®¤å¹¶ç»™å‡ºç»¼åˆåˆ†æ\n`
  ctx += `6. ç”¨æˆ·æœ‰æƒ…ç»ª/ç„¦è™‘æ—¶å…ˆå®‰æŠšï¼Œç»™å‡ºä¸“ä¸šåˆ¤æ–­è®©ç”¨æˆ·å®‰å¿ƒ\n`
  ctx += `7. ä¸è¦ç”¨[X/16]æ ¼å¼ï¼Œä¸è¦è¯´"å½“å‰é—®é¢˜"ï¼ŒåƒçœŸäººé¡¾é—®ä¸€æ ·è‡ªç„¶å¯¹è¯\n`
  ctx += `8. å¯¹äºå¯è·³è¿‡çš„å­—æ®µï¼ˆä¿¡ç”¨ä»£ç ã€èº«ä»½è¯åå››ä½ã€è´¦æˆ·åå››ä½ï¼‰ï¼Œå¦‚æœç”¨æˆ·ä¸æ–¹ä¾¿æä¾›å¯ä»¥è·³è¿‡\n`

  return ctx
}

/**
 * æ„å»º DeepSeek ç”ŸæˆæŠ¥å‘Šæ‰€éœ€çš„ä¸Šä¸‹æ–‡ prompt
 * @param {object} collectedData æ”¶é›†çš„å•†æˆ·ä¿¡æ¯
 * @param {Array} successCases ç›¸å…³æˆåŠŸæ¡ˆä¾‹ï¼ˆä»çŸ¥è¯†åº“æŸ¥è¯¢ï¼‰
 */
export function buildReportPrompt(collectedData, successCases = []) {
  const d = collectedData

  // åŒ¹é…è¡Œä¸šçŸ¥è¯†
  const ind = matchIndustry(d.industry || '')
  let industrySection = ''
  if (ind) {
    industrySection = `
## è¡Œä¸šä¸“ä¸šçŸ¥è¯†ï¼ˆ${ind.key}è¡Œä¸šï¼‰

- **å¸¸è§è¿è§„ç±»å‹**ï¼š${ind.commonViolations.join('ã€')}
- **ç”³è¯‰è¦ç‚¹**ï¼š${ind.appealTips}
- **å‚è€ƒä¸šåŠ¡æ¨¡å¼æè¿°**ï¼š${ind.businessModel}

è¯·æ ¹æ®ä»¥ä¸Šè¡Œä¸šç‰¹ç‚¹ï¼Œç”Ÿæˆæ›´æœ‰é’ˆå¯¹æ€§çš„ç”³è¯‰ææ–™ã€‚`
  }

  // åŒ¹é…è¿è§„åŸå› çŸ¥è¯†
  const viol = matchViolation(d.violation_reason || '')
  let violationSection = ''
  if (viol) {
    violationSection = `
## è¿è§„ç±»å‹ä¸“ä¸šçŸ¥è¯†ï¼ˆ${viol.key}ï¼‰

- **æè¿°**ï¼š${viol.description}
- **ç”³è¯‰è¦ç‚¹**ï¼š${viol.appeal_key_points.join('ï¼›')}
- **å¿…éœ€ææ–™**ï¼š${viol.required_materials.join('ã€')}
- **å¸¸è§é©³å›åŸå› **ï¼š${viol.common_rejection_reasons.join('ã€')}
- **æˆåŠŸå…³é”®**ï¼š${viol.success_key}

è¯·åœ¨ç”Ÿæˆææ–™æ—¶ï¼Œé‡ç‚¹å›´ç»•ä»¥ä¸Šç”³è¯‰è¦ç‚¹æ’°å†™ï¼Œå¹¶è§„é¿å¸¸è§é©³å›åŸå› ã€‚`
  }

  // é£é™©è¯„ä¼°
  const risk = assessRisk(d)
  let riskSection = `
## é£é™©è¯„ä¼°ç»“æœ

- **éš¾åº¦ç­‰çº§**ï¼š${risk.level}ï¼ˆè¯„åˆ†${risk.riskScore}/100ï¼‰
- **é¢„ä¼°æˆåŠŸç‡**ï¼š${risk.successRate}
- **å…³é”®å› ç´ **ï¼š${risk.factors.join('ï¼›')}
${risk.tips.length > 0 ? `- **ç‰¹åˆ«æé†’**ï¼š${risk.tips.join('ï¼›')}` : ''}`

  // ç”³è¯‰å†å²ç­–ç•¥
  let appealHistorySection = ''
  const ah = (d.appeal_history || '').toLowerCase()
  if (ah.includes('é©³å›') || ah.includes('å¤±è´¥') || ah.includes('æ‹’ç»')) {
    appealHistorySection = `
## äºŒæ¬¡ç”³è¯‰ç­–ç•¥ï¼ˆé‡è¦ï¼ï¼‰

æ­¤ç”¨æˆ·ä¹‹å‰æœ‰è¢«é©³å›çš„ç”³è¯‰å†å²ï¼Œè¯·åœ¨ç”Ÿæˆææ–™æ—¶ï¼š
1. æ¯”é¦–æ¬¡ç”³è¯‰æ›´åŠ è¯¦ç»†å’Œä¸“ä¸š
2. é’ˆå¯¹å¯èƒ½çš„é©³å›åŸå› ï¼ˆæŠ•è¯‰æœªå¤„ç†ã€ææ–™ä¸è¶³ã€ä¸šåŠ¡æ¨¡å¼ä¸æ¸…ï¼‰é€æ¡åŠ å¼ºè¯´æ˜
3. åœ¨æ•´æ”¹è¯´æ˜ä¸­ä½“ç°"æŒç»­æ”¹è¿›"çš„æ€åº¦
4. å»ºè®®ç”¨æˆ·å…ˆæ‹¨æ‰“95017è½¬3æŸ¥è¯¢å…·ä½“é©³å›åŸå› åå†æäº¤`
  }

  // åˆå¹¶æ‰€æœ‰æˆåŠŸæ¡ˆä¾‹ï¼ˆæ•°æ®åº“æ¡ˆä¾‹ + å†…ç½®åŒ¹é…æ¡ˆä¾‹ï¼‰
  const builtInMatched = matchBuiltInCases(d.problem_type, d.industry, d.violation_reason)
  const allCases = [...successCases]
  builtInMatched.forEach(bc => {
    if (!allCases.some(c => c.title === bc.title)) {
      allCases.push({
        title: bc.title,
        industry: bc.industry,
        problem_type: bc.problem_type,
        success_summary: bc.success_summary,
        report_content: bc.appeal_points ? bc.appeal_points.join('ï¼›') : ''
      })
    }
  })

  let casesSection = ''
  if (allCases.length > 0) {
    casesSection = `
## æˆåŠŸæ¡ˆä¾‹å‚è€ƒ

ä»¥ä¸‹æ˜¯ä¸æœ¬æ¡ˆç±»ä¼¼çš„å·²æˆåŠŸç”³è¯‰æ¡ˆä¾‹ï¼Œè¯·å‚è€ƒå…¶ç­–ç•¥å’Œæªè¾é£æ ¼ï¼š

${allCases.slice(0, 5).map((c, i) => `### æ¡ˆä¾‹${i + 1}ï¼š${c.title}
- **è¡Œä¸š**ï¼š${c.industry || 'æœªçŸ¥'}
- **å¤„ç½šç±»å‹**ï¼š${c.problem_type || 'æœªçŸ¥'}
- **æˆåŠŸè¦ç‚¹**ï¼š${c.success_summary || 'ææ–™å……åˆ†ã€æ•´æ”¹åˆ°ä½'}
${c.report_content ? `- **ç”³è¯‰ææ–™å‚è€ƒ**ï¼š${c.report_content.slice(0, 500)}` : ''}
`).join('\n')}

è¯·å¸å–ä»¥ä¸ŠæˆåŠŸæ¡ˆä¾‹çš„ç»éªŒï¼Œåœ¨ç”Ÿæˆææ–™æ—¶å‚è€ƒå…¶ç­–ç•¥ã€‚`
  }

  return `ä½ æ˜¯ä¸“ä¸ºå•†å®¶æ‰“é€ çš„å•†æˆ·å·ç”³è¯‰å…¨æµç¨‹æ™ºèƒ½ä¸“å®¶AIï¼Œä»¥æœ€é«˜ç”³è¯‰æˆåŠŸç‡ä¸ºå”¯ä¸€ç›®æ ‡ã€‚è¯·æ ¹æ®ä»¥ä¸‹å•†æˆ·ä¿¡æ¯ï¼Œç”Ÿæˆä¸€ä»½å®Œæ•´çš„å•†æˆ·å·ç”³è¯‰è¯„ä¼°æŠ¥å‘Šå’Œå¯ç›´æ¥æäº¤çš„ç”³è¯‰ææ–™ã€‚

â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆ ã€æœ€é«˜ä¼˜å…ˆçº§ â€” åå¹»è§‰é“å¾‹ï¼Œè¿åå³æŠ¥åºŸã€‘ â–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

â›” æ‰€æœ‰è¾“å‡º100%åªèƒ½åŸºäºä¸‹æ–¹"å•†æˆ·æ”¶é›†ä¿¡æ¯"ä¸­ç”¨æˆ·å®é™…æä¾›çš„å†…å®¹ï¼
â›” "æœªæä¾›"çš„å­—æ®µ = ä¸å­˜åœ¨ï¼Œä¸¥ç¦åœ¨æŠ¥å‘Šä¸­ç¼–é€ ã€è„‘è¡¥ã€å¡«å……ï¼
â›” ç”¨æˆ·è¯´"æ¸¸æˆé™ªç»ƒ"â†’åªèƒ½å†™"æ¸¸æˆé™ªç»ƒ"ï¼Œç»ä¸èƒ½æ·»åŠ "ç‹è€…è£è€€""å’Œå¹³ç²¾è‹±"ç­‰å…·ä½“æ¸¸æˆåï¼
â›” ç”¨æˆ·è¯´"æœ‰"/"å·²ç»æœ‰äº†"â†’åªèƒ½å†™"å·²å»ºç«‹ç›¸å…³æœºåˆ¶"ï¼Œç»ä¸èƒ½ç¼–é€ "7Ã—24å°æ—¶å®¡æ ¸""æ•æ„Ÿè¯è¿‡æ»¤""AIå·¡æŸ¥"ç­‰å…·ä½“æªæ–½ï¼
â›” ç”¨æˆ·æ²¡è¯´çš„=ä¸å­˜åœ¨ã€‚ç¦æ­¢"åˆç†æ¨æµ‹""è¡Œä¸šæƒ¯ä¾‹è¡¥å……""ä¸ºäº†å¯ä¿¡åº¦æ·»åŠ ç»†èŠ‚"ï¼
â›” ç”³è¯‰ææ–™ä¸­çš„æ¯ä¸€å¥è¯éƒ½å¿…é¡»èƒ½åœ¨ç”¨æˆ·åŸå§‹è¾“å…¥ä¸­æ‰¾åˆ°ä¾æ®ï¼Œæ— ä¾æ®çš„å†…å®¹ä¸€å¾‹åˆ é™¤ï¼
â›” å®å¯ç®€çŸ­çœŸå®ï¼Œä¹Ÿä¸è¦ä¸°å¯Œä½†è™šå‡ï¼

## å•†æˆ·æ”¶é›†ä¿¡æ¯ï¼ˆä»¥ä¸‹ä¸ºç”¨æˆ·å®é™…æä¾›çš„å…¨éƒ¨ä¿¡æ¯ï¼Œ"æœªæä¾›"è¡¨ç¤ºç”¨æˆ·æ²¡è¯´è¿‡ï¼‰

- **å¤„ç½šç±»å‹**ï¼š${d.problem_type || 'æœªæä¾›'}
- **è¿è§„åŸå› **ï¼š${d.violation_reason || 'æœªæä¾›'}
- **å•†æˆ·å·**ï¼š${d.merchant_id || 'æœªæä¾›'}
- **å•†æˆ·åç§°**ï¼š${d.merchant_name || 'æœªæä¾›'}
- **å…¬å¸å…¨ç§°**ï¼š${d.company_name || 'æœªæä¾›'}
- **ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç **ï¼š${d.license_no || 'æœªæä¾›'}
- **æ³•äººå§“å**ï¼š${d.legal_name || 'æœªæä¾›'}
- **èº«ä»½è¯åå››ä½**ï¼š${d.legal_id_last4 || 'æœªæä¾›'}
- **æ‰€å±è¡Œä¸š**ï¼š${d.industry || 'æœªæä¾›'}
- **ç»è¥æ¨¡å¼**ï¼š${d.business_model || 'æœªæä¾›'}
- **æŠ•è¯‰æƒ…å†µ**ï¼š${d.complaint_status || 'æœªæä¾›'}
- **é€€æ¬¾æ”¿ç­–**ï¼š${d.refund_policy || 'æœªæä¾›'}
- **å¼€æˆ·é“¶è¡Œ**ï¼š${d.bank_name || 'æœªæä¾›'}
- **ç»“ç®—è´¦æˆ·åå››ä½**ï¼š${d.bank_account_last4 || 'æœªæä¾›'}
- **è”ç³»ç”µè¯**ï¼š${d.contact_phone || 'æœªæä¾›'}
- **ç”³è¯‰å†å²**ï¼š${d.appeal_history || 'æœªæä¾›'}
${industrySection}${violationSection}${riskSection}${appealHistorySection}${casesSection}
## è¾“å‡ºè¦æ±‚

è¯·ç”Ÿæˆä»¥ä¸‹å®Œæ•´æŠ¥å‘Šï¼Œ**æ¯éƒ¨åˆ†â‰¤300å­—**ï¼Œè¯­è¨€æ­£å¼ã€ä¸¥è°¨ã€æªè¾åˆç†ï¼Œä¸ä½¿ç”¨ä»»ä½•æ ‡ç‚¹ç¬¦å·è£…é¥°ï¼ˆå¦‚emojiï¼‰ï¼Œå†…å®¹å¯ç›´æ¥å¤åˆ¶ç²˜è´´åˆ°å¾®ä¿¡ç”³è¯‰è¡¨å•å¯¹åº”ä½ç½®ä½¿ç”¨ã€‚
**å†æ¬¡å¼ºè°ƒï¼šåªä½¿ç”¨ç”¨æˆ·å®é™…æä¾›çš„ä¿¡æ¯ï¼Œ"æœªæä¾›"å­—æ®µä¸å¾—åœ¨æŠ¥å‘Šæ­£æ–‡ä¸­å‡ºç°æˆ–è¢«ç¼–é€ å¡«å……ã€‚**

### æ¡ˆæƒ…è¯„ä¼°
åˆ†æå¤„ç½šåŸå› ã€æ¡ˆä»¶éš¾åº¦ã€é¢„ä¼°æˆåŠŸç‡å’Œå‚è€ƒä»·æ ¼ã€‚åªåŸºäºå·²çŸ¥ä¿¡æ¯è¯„ä¼°ã€‚

### ä¸€ã€æŠ•è¯‰å¤„ç†æ–¹æ³•
æ ¹æ®å•†æˆ·å®é™…æä¾›çš„æŠ•è¯‰æƒ…å†µè¯´æ˜å¤„ç†æªæ–½ã€‚å¦‚ç”¨æˆ·è¯´æ— æŠ•è¯‰ï¼Œåˆ™å¦‚å®è¯´æ˜æ— æŠ•è¯‰ã€‚ä¸å¾—ç¼–é€ æŠ•è¯‰å¤„ç†ç»†èŠ‚ã€‚

### äºŒã€é€€æ¬¾è§„åˆ™
æ ¹æ®å•†æˆ·å®é™…æä¾›çš„é€€æ¬¾ä¿¡æ¯æ•´ç†ä¸ºæ­£å¼æ–‡æœ¬ã€‚å¦‚ç”¨æˆ·æœªæä¾›é€€æ¬¾æ”¿ç­–ï¼Œåªå†™"å•†æˆ·æ‰¿è¯ºå»ºç«‹å®Œå–„é€€æ¬¾æµç¨‹"ï¼Œä¸å¾—ç¼–é€ å…·ä½“é€€æ¬¾å¤©æ•°ã€æ¯”ä¾‹ç­‰ç»†èŠ‚ã€‚

### ä¸‰ã€æŠ•è¯‰ç”ŸæˆåŸå› åŠè¯¦æƒ…
åŸºäºç”¨æˆ·å®é™…æè¿°çš„è¿è§„/æŠ•è¯‰æƒ…å†µï¼Œå®¢è§‚é™ˆè¿°äº‹å®ã€‚åªä½¿ç”¨ç”¨æˆ·å‘Šè¯‰ä½ çš„åŸå› ï¼Œä¸å¾—æ·»åŠ ç”¨æˆ·æœªæåŠçš„æƒ…èŠ‚ã€‚

### å››ã€ä¸šåŠ¡æ¨¡å¼
ä¸¥æ ¼åŸºäºç”¨æˆ·æä¾›çš„è¡Œä¸šã€ç»è¥æ¨¡å¼ä¿¡æ¯æ’°å†™ã€‚ç”¨æˆ·è¯´"æ¸¸æˆé™ªç»ƒ"å°±åªå†™"æ¸¸æˆé™ªç»ƒæœåŠ¡"ï¼Œä¸å¾—æ·»åŠ ç”¨æˆ·æœªæåŠçš„å…·ä½“æ¸¸æˆåç§°ã€å…·ä½“æœåŠ¡åœºæ™¯ã€å…·ä½“æŠ€æœ¯ç³»ç»Ÿç­‰ç»†èŠ‚ã€‚ç”¨æˆ·è¯´"çº¯çº¿ä¸Š"å°±å†™"çº¯çº¿ä¸Šç»è¥"ï¼Œä¸å¾—ç¼–é€ å…·ä½“çš„çº¿ä¸Šæ¸ é“ç»†èŠ‚ã€‚

### äº”ã€æ•´æ”¹è¯´æ˜
åŸºäºç”¨æˆ·å®é™…æä¾›çš„ä¿¡æ¯åˆ¶å®šæ•´æ”¹æ–¹æ¡ˆã€‚ç”¨æˆ·è¯´"æœ‰å®åè®¤è¯"å°±å†™"å·²å»ºç«‹å®åè®¤è¯æœºåˆ¶"ï¼Œä¸å¾—ç¼–é€ "7Ã—24å°æ—¶å®¡æ ¸å›¢é˜Ÿ""AIå†…å®¹å®¡æ ¸ç³»ç»Ÿ""æ•æ„Ÿè¯è¿‡æ»¤"ç­‰ç”¨æˆ·æœªæåŠçš„å…·ä½“æªæ–½ã€‚æ‰¿è¯ºéƒ¨åˆ†å¯ä»¥å†™"å°†æŒç»­å®Œå–„"ï¼Œä½†å·²å®Œæˆéƒ¨åˆ†åªèƒ½å†™ç”¨æˆ·ç¡®è®¤è¿‡çš„ã€‚
${(d.problem_type || '').includes('å†»ç»“') || (d.problem_type || '').includes('å»¶è¿Ÿ') ? `
### å…­ã€èµ„é‡‘è§£å†»è¯´æ˜
æ­¤æ¡ˆä»¶æ¶‰åŠèµ„é‡‘å†»ç»“/å»¶è¿Ÿç»“ç®—ï¼Œè¯·é¢å¤–ç”Ÿæˆï¼š
- èµ„é‡‘æ¥æºåˆæ³•æ€§è¯´æ˜
- ç»“ç®—è´¦æˆ·éªŒè¯é…åˆå£°æ˜ï¼ˆå¼€æˆ·é“¶è¡Œï¼š${d.bank_name || 'å¾…æä¾›'}ï¼Œè´¦æˆ·åå››ä½ï¼š${d.bank_account_last4 || 'å¾…æä¾›'}ï¼‰
- è§£å†»åèµ„é‡‘ç”¨é€”è¯´æ˜
- å»ºè®®ç”¨æˆ·æ‹¨æ‰“95017è½¬3ï¼Œæä¾›å•†æˆ·å·å’Œç»“ç®—è´¦æˆ·åå››ä½å‚¬ä¿ƒå®¡æ ¸
` : ''}
---

### ç”³è¯‰æäº¤æŒ‡å—

è¯·æ ¹æ®ç”¨æˆ·çš„å¹³å°ç±»å‹ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®/æŠ–éŸ³/å¿«æ‰‹/ç¾å›¢ç­‰ï¼‰ï¼Œç”Ÿæˆå¯¹åº”çš„ç”³è¯‰æäº¤æŒ‡å—ã€‚
å¦‚ç”¨æˆ·æœªæ˜ç¡®å¹³å°ï¼Œé»˜è®¤æŒ‰å¾®ä¿¡æ”¯ä»˜ç”Ÿæˆã€‚

**å¾®ä¿¡æ”¯ä»˜ç”³è¯‰è·¯å¾„ï¼š**
1. **æäº¤æ–¹å¼**ï¼šå¾®ä¿¡æ”¯ä»˜å•†å®¶åŠ©æ‰‹å°ç¨‹åº â†’ é£é™©å¤„ç† â†’ ç”³è¯‰ä¸­å¿ƒ â†’ å‘èµ·ç”³è¯‰
2. **ææ–™ä¸Šä¼ è¦æ±‚**ï¼šç…§ç‰‡æ¸…æ™°ã€æ–‡å­—å¯è¾¨ã€æ–‡ä»¶å¤§å°é™åˆ¶
3. **è®¢å•å·æ ¼å¼**ï¼šå¿…é¡»æ˜¯å¾®ä¿¡æ”¯ä»˜è®¢å•å·ï¼ˆ4å¼€å¤´28ä½ï¼‰ï¼Œä¸æ˜¯å•†æˆ·ç³»ç»Ÿè®¢å•å·
4. **æ—¶é—´æé†’**ï¼šè¡¥å……èµ„æ–™é€šé“é€šå¸¸åªå¼€æ”¾24å°æ—¶ï¼Œå®¡æ ¸3-7ä¸ªå·¥ä½œæ—¥
5. **è¢«é©³å›å¤„ç†**ï¼šå…ˆæ‰“95017è½¬3æŸ¥è¯¢å…·ä½“åŸå› ï¼Œé—´éš”3-5å¤©åé’ˆå¯¹æ€§è¡¥å……ææ–™é‡æ–°æäº¤
6. **é‡è¦è­¦å‘Š**ï¼šè¿ç»­ç”³è¯‰5æ¬¡ä¸é€šè¿‡å¯èƒ½è¢«æ ‡è®°ä¸º"ä¸æ”¯æŒç”³è¯‰"ï¼ŒåŠ¡å¿…æ¯æ¬¡éƒ½å……åˆ†å‡†å¤‡

**æ”¯ä»˜å®ç”³è¯‰è·¯å¾„ï¼ˆå¦‚é€‚ç”¨ï¼‰ï¼š** æ”¯ä»˜å®å•†å®¶ä¸­å¿ƒ â†’ è´¦æˆ·ç®¡ç† â†’ ç”³è¯‰ï¼Œæˆ–æ‹¨æ‰“95188äººå·¥å®¢æœ
**æŠ–éŸ³/å¿«æ‰‹ç”³è¯‰è·¯å¾„ï¼ˆå¦‚é€‚ç”¨ï¼‰ï¼š** å¯¹åº”å¹³å°å•†å®¶åå° â†’ åº—é“ºç®¡ç† â†’ ç”³è¯‰ä¸­å¿ƒ
**ç¾å›¢ç”³è¯‰è·¯å¾„ï¼ˆå¦‚é€‚ç”¨ï¼‰ï¼š** ç¾å›¢å•†å®¶ç‰ˆAPP â†’ åº—é“º â†’ è¿è§„ç®¡ç† â†’ ç”³è¯‰

### è¿­ä»£ä¼˜åŒ–å»ºè®®

è¯·æ ¹æ®æœ¬æ¡ˆæƒ…å†µï¼Œè¾“å‡ºä»¥ä¸‹è¿­ä»£è®°å½•ä¾›ç³»ç»Ÿå­¦ä¹ ï¼š
1. **è¿è§„ç±»å‹å½’æ¡£**ï¼šæœ¬æ¡ˆå±äºå“ªç±»è¿è§„ï¼ˆäº¤æ˜“å¼‚å¸¸/èµ„é‡‘å†»ç»“/æŠ•è¯‰è¿‡å¤š/å†…å®¹è¿è§„ç­‰ï¼‰
2. **æ–¹æ¡ˆæœ‰æ•ˆæ€§è¯„ä¼°**ï¼šæœ¬æ–¹æ¡ˆçš„é¢„ä¼°æˆåŠŸç‡å’Œå…³é”®ç­–ç•¥
3. **ä¼˜åŒ–å»ºè®®**ï¼šå¦‚æœç”³è¯‰å¤±è´¥ï¼Œä¸‹æ¬¡åº”è¯¥é‡ç‚¹è¡¥å……å“ªäº›ææ–™æˆ–è°ƒæ•´å“ªäº›ç­–ç•¥`
}

export { INFO_FIELDS, TOTAL_STEPS, LOCAL_WELCOME, INDUSTRY_KNOWLEDGE, matchIndustry, normalizeFieldValue, matchViolation, matchBuiltInCases, assessRisk, generateMaterialChecklist, findNextUnfilledStep }
